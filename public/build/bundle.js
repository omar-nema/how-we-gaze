var app=function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function r(e){return e()}function i(){return Object.create(null)}function o(e){e.forEach(r)}function s(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let l;function c(e,t){return l||(l=document.createElement("a")),l.href=t,e===l.href}function u(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function h(e){let t;return u(e,(e=>t=e))(),t}function d(e,t,n){e.$$.on_destroy.push(u(t,n))}function f(e,t,n,r){if(e){const i=p(e,t,n,r);return e[0](i)}}function p(e,t,r,i){return e[1]&&i?n(r.ctx.slice(),e[1](i(t))):r.ctx}function g(e,t,n,r){if(e[2]&&r){const i=e[2](r(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|i[r];return e}return t.dirty|i}return t.dirty}function m(e,t,n,r,i,o){if(i){const s=p(t,n,r,o);e.p(s,i)}}function _(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function v(e,t,n){return e.set(n),t}const y="undefined"!=typeof window;let w=y?()=>window.performance.now():()=>Date.now(),b=y?e=>requestAnimationFrame(e):e;const C=new Set;function x(e){C.forEach((t=>{t.c(e)||(C.delete(t),t.f())})),0!==C.size&&b(x)}function k(e){let t;return 0===C.size&&b(x),{promise:new Promise((n=>{C.add(t={c:e,f:n})})),abort(){C.delete(t)}}}function I(e,t){e.appendChild(t)}function S(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function E(e){const t=$("style");return function(e,t){I(e.head||e,t)}(S(e),t),t}function T(e,t,n){e.insertBefore(t,n||null)}function N(e){e.parentNode.removeChild(e)}function M(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function $(e){return document.createElement(e)}function R(e){return document.createTextNode(e)}function P(){return R(" ")}function A(){return R("")}function L(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function O(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function D(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function F(e,t){e.value=null==t?"":t}function q(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}function j(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}e.selectedIndex=-1}function z(e,t,n){e.classList[n?"add":"remove"](t)}class B{constructor(){this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){this.e||(this.e=$(t.nodeName),this.t=t,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)T(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(N)}}const H=new Set;let U,W=0;function V(e,t,n,r,i,o,s,a=0){const l=16.666/r;let c="{\n";for(let e=0;e<=1;e+=l){const r=t+(n-t)*o(e);c+=100*e+`%{${s(r,1-r)}}\n`}const u=c+`100% {${s(n,1-n)}}\n}`,h=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${a}`,d=S(e);H.add(d);const f=d.__svelte_stylesheet||(d.__svelte_stylesheet=E(e).sheet),p=d.__svelte_rules||(d.__svelte_rules={});p[h]||(p[h]=!0,f.insertRule(`@keyframes ${h} ${u}`,f.cssRules.length));const g=e.style.animation||"";return e.style.animation=`${g?`${g}, `:""}${h} ${r}ms linear ${i}ms 1 both`,W+=1,h}function G(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),i=n.length-r.length;i&&(e.style.animation=r.join(", "),W-=i,W||b((()=>{W||(H.forEach((e=>{const t=e.__svelte_stylesheet;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.__svelte_rules={}})),H.clear())})))}function Y(e){U=e}function K(){if(!U)throw new Error("Function called outside component initialization");return U}function Z(e){K().$$.on_mount.push(e)}const Q=[],X=[],J=[],ee=[],te=Promise.resolve();let ne=!1;function re(e){J.push(e)}function ie(e){ee.push(e)}let oe=!1;const se=new Set;function ae(){if(!oe){oe=!0;do{for(let e=0;e<Q.length;e+=1){const t=Q[e];Y(t),le(t.$$)}for(Y(null),Q.length=0;X.length;)X.pop()();for(let e=0;e<J.length;e+=1){const t=J[e];se.has(t)||(se.add(t),t())}J.length=0}while(Q.length);for(;ee.length;)ee.pop()();ne=!1,oe=!1,se.clear()}}function le(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(re)}}let ce;function ue(e,t,n){e.dispatchEvent(function(e,t,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,!1,t),r}(`${t?"intro":"outro"}${n}`))}const he=new Set;let de;function fe(){de={r:0,c:[],p:de}}function pe(){de.r||o(de.c),de=de.p}function ge(e,t){e&&e.i&&(he.delete(e),e.i(t))}function me(e,t,n,r){if(e&&e.o){if(he.has(e))return;he.add(e),de.c.push((()=>{he.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}const _e={duration:0};function ve(n,r,i,a){let l=r(n,i),c=a?0:1,u=null,h=null,d=null;function f(){d&&G(n,d)}function p(e,t){const n=e.b-c;return t*=Math.abs(n),{a:c,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function g(r){const{delay:i=0,duration:s=300,easing:a=t,tick:g=e,css:m}=l||_e,_={start:w()+i,b:r};r||(_.group=de,de.r+=1),u||h?h=_:(m&&(f(),d=V(n,c,r,s,i,a,m)),r&&g(0,1),u=p(_,s),re((()=>ue(n,r,"start"))),k((e=>{if(h&&e>h.start&&(u=p(h,s),h=null,ue(n,u.b,"start"),m&&(f(),d=V(n,c,u.b,u.duration,0,a,l.css))),u)if(e>=u.end)g(c=u.b,1-c),ue(n,u.b,"end"),h||(u.b?f():--u.group.r||o(u.group.c)),u=null;else if(e>=u.start){const t=e-u.start;c=u.a+u.d*a(t/u.duration),g(c,1-c)}return!(!u&&!h)})))}return{run(e){s(l)?(ce||(ce=Promise.resolve(),ce.then((()=>{ce=null}))),ce).then((()=>{l=l(),g(e)})):g(e)},end(){f(),u=h=null}}}const ye="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function we(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function be(e){e&&e.c()}function Ce(e,t,n,i){const{fragment:a,on_mount:l,on_destroy:c,after_update:u}=e.$$;a&&a.m(t,n),i||re((()=>{const t=l.map(r).filter(s);c?c.push(...t):o(t),e.$$.on_mount=[]})),u.forEach(re)}function xe(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ke(e,t){-1===e.$$.dirty[0]&&(Q.push(e),ne||(ne=!0,te.then(ae)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ie(t,n,r,s,a,l,c,u=[-1]){const h=U;Y(t);const d=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:a,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(h?h.$$.context:[])),callbacks:i(),dirty:u,skip_bound:!1,root:n.target||h.$$.root};c&&c(d.root);let f=!1;if(d.ctx=r?r(t,n.props||{},((e,n,...r)=>{const i=r.length?r[0]:n;return d.ctx&&a(d.ctx[e],d.ctx[e]=i)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](i),f&&ke(t,e)),n})):[],d.update(),f=!0,o(d.before_update),d.fragment=!!s&&s(d.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);d.fragment&&d.fragment.l(e),e.forEach(N)}else d.fragment&&d.fragment.c();n.intro&&ge(t.$$.fragment),Ce(t,n.target,n.anchor,n.customElement),ae()}Y(h)}class Se{$destroy(){xe(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ee=[];function Te(t,n=e){let r;const i=new Set;function o(e){if(a(t,e)&&(t=e,r)){const e=!Ee.length;for(const e of i)e[1](),Ee.push(e,t);if(e){for(let e=0;e<Ee.length;e+=2)Ee[e][0](Ee[e+1]);Ee.length=0}}}return{set:o,update:function(e){o(e(t))},subscribe:function(s,a=e){const l=[s,a];return i.add(l),1===i.size&&(r=n(o)||e),s(t),()=>{i.delete(l),0===i.size&&(r(),r=null)}}}}let Ne=Te("gallery"),Me=Te("intro"),$e=Te(null),Re=Te(null),Pe=Te(null),Ae=Te("desktop"),Le=Te(null),Oe=Te(null),De=Te(null),Fe=Te(!1),qe=Te(null),je=Te(null),ze=Te(null),Be=Te(!1),He=Te(!1),Ue=Te({}),We=Te(null),Ve=Te([]),Ge=Te([]),Ye=Te([]),Ke=Te(!1),Ze=Te(!1),Qe=Te(!1),Xe=Te(0),Je=Te(null),et=Te(70),tt=Te(!0),nt=Te(null),rt=Te(null),it=function(e,t){return{subscribe:Te(e,t).subscribe}}(0);var ot=()=>{const e=window.innerWidth,t=window.innerHeight,n={mobile:e<640,sm:e>=640&&e<768,md:e>=768&&e<1024,lg:e>=1024&&e<1100,medLg:e>=1100&&e<1280,xl:e>=1280&&e<1536,"2xl":e>=1536},r=Object.keys(n).filter((e=>n[e]))[0];return{windowW:e,windowH:t,screens:n,screenSize:r}};function st(e){const t=e-1;return t*t*t+1}function at(e){return--e*e*e*e*e+1}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function lt(e,{delay:n=0,duration:r=400,easing:i=t}={}){const o=+getComputedStyle(e).opacity;return{delay:n,duration:r,easing:i,css:e=>"opacity: "+e*o}}function ct(e,{delay:t=0,duration:n=400,easing:r=st}={}){const i=getComputedStyle(e),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),c=parseFloat(i.marginTop),u=parseFloat(i.marginBottom),h=parseFloat(i.borderTopWidth),d=parseFloat(i.borderBottomWidth);return{delay:t,duration:n,easing:r,css:e=>`overflow: hidden;opacity: ${Math.min(20*e,1)*o};height: ${e*s}px;padding-top: ${e*a}px;padding-bottom: ${e*l}px;margin-top: ${e*c}px;margin-bottom: ${e*u}px;border-top-width: ${e*h}px;border-bottom-width: ${e*d}px;`}}function ut(e){var{fallback:t}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["fallback"]);const i=new Map,o=new Map;function a(e,i,o){return(a,l)=>(e.set(l.key,{rect:a.getBoundingClientRect()}),()=>{if(i.has(l.key)){const{rect:e}=i.get(l.key);return i.delete(l.key),function(e,t,i){const{delay:o=0,duration:a=(e=>30*Math.sqrt(e)),easing:l=st}=n(n({},r),i),c=t.getBoundingClientRect(),u=e.left-c.left,h=e.top-c.top,d=e.width/c.width,f=e.height/c.height,p=Math.sqrt(u*u+h*h),g=getComputedStyle(t),m="none"===g.transform?"":g.transform,_=+g.opacity;return{delay:o,duration:s(a)?a(p):a,easing:l,css:(e,t)=>`\n\t\t\t\topacity: ${e*_};\n\t\t\t\ttransform-origin: top left;\n\t\t\t\ttransform: ${m} translate(${t*u}px,${t*h}px) scale(${e+(1-e)*d}, ${e+(1-e)*f});\n\t\t\t`}}(e,a,l)}return e.delete(l.key),t&&t(a,l,o)})}return[a(o,i,!1),a(i,o,!0)]}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function ht(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))}function dt(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function ft(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function pt(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function gt(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const mt=!1,_t="${JSCORE_VERSION}",vt=function(e,t){if(!e)throw yt(t)},yt=function(e){return new Error("Firebase Database ("+_t+") INTERNAL ASSERT FAILED: "+e)},wt=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},bt={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],o=t+1<e.length,s=o?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,c=i>>2,u=(3&i)<<4|s>>4;let h=(15&s)<<2|l>>6,d=63&l;a||(d=64,o||(h=64)),r.push(n[c],n[u],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(wt(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){const o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{const o=e[n++],s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const s=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==o||null==s||null==a)throw Error();const l=i<<2|o>>4;if(r.push(l),64!==s){const e=o<<4&240|s>>2;if(r.push(e),64!==a){const e=s<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},Ct=function(e){try{return bt.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function xt(e){return kt(void 0,e)}function kt(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=kt(e[n],t[n]));return e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class It{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function St(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function Et(){return!0===mt}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Tt extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Tt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Nt.prototype.create)}}class Nt{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?function(e,t){return e.replace(Mt,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",s=`${this.serviceName}: ${o} (${r}).`;return new Tt(r,s,n)}}const Mt=/\{\$([^}]+)}/g;
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function $t(e){return JSON.parse(e)}function Rt(e){return JSON.stringify(e)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Pt=function(e){let t={},n={},r={},i="";try{const o=e.split(".");t=$t(Ct(o[0])||""),n=$t(Ct(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function At(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Lt(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Ot(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Dt(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function Ft(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],o=t[i];if(qt(n)&&qt(o)){if(!Ft(n,o))return!1}else if(n!==o)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function qt(e){return null!==e&&"object"==typeof e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class jt{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let r,i,o=this.chain_[0],s=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(r=l^s&(a^l),i=1518500249):(r=s^a^l,i=1859775393):e<60?(r=s&a|l&(s|a),i=2400959708):(r=s^a^l,i=3395469782);const t=(o<<5|o>>>27)+r+c+i+n[e]&4294967295;c=l,l=a,a=4294967295&(s<<30|s>>>2),s=o,o=t}this.chain_[0]=this.chain_[0]+o&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<t;){if(0===o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}function zt(e,t){return`${e} failed: ${t} argument `}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Bt=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Ht(e){return e&&e._delegate?e._delegate:e}var Ut=function(){function e(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return e.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},e.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},e.prototype.setServiceProps=function(e){return this.serviceProps=e,this},e.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},e}(),Wt="[DEFAULT]",Vt=function(){function e(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return e.prototype.get=function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new It;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise},e.prototype.getImmediate=function(e){var t,n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e))try{this.getOrInitializeService({instanceIdentifier:Wt})}catch(e){}try{for(var r=ft(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var o=pt(i.value,2),s=o[0],a=o[1],l=this.normalizeInstanceIdentifier(s);try{var c=this.getOrInitializeService({instanceIdentifier:l});a.resolve(c)}catch(e){}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},e.prototype.clearInstance=function(e){void 0===e&&(e=Wt),this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)},e.prototype.delete=function(){return ht(this,void 0,void 0,(function(){var e;return dt(this,(function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(gt(gt([],pt(e.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()})))),pt(e.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))))];case 1:return t.sent(),[2]}}))}))},e.prototype.isComponentSet=function(){return null!=this.component},e.prototype.isInitialized=function(e){return void 0===e&&(e=Wt),this.instances.has(e)},e.prototype.getOptions=function(e){return void 0===e&&(e=Wt),this.instancesOptions.get(e)||{}},e.prototype.initialize=function(e){var t,n;void 0===e&&(e={});var r=e.options,i=void 0===r?{}:r,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(this.name+"("+o+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var s=this.getOrInitializeService({instanceIdentifier:o,options:i});try{for(var a=ft(this.instancesDeferred.entries()),l=a.next();!l.done;l=a.next()){var c=pt(l.value,2),u=c[0],h=c[1];o===this.normalizeInstanceIdentifier(u)&&h.resolve(s)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return s},e.prototype.onInit=function(e,t){var n,r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);var o=this.instances.get(r);return o&&e(o,r),function(){i.delete(e)}},e.prototype.invokeOnInitCallbacks=function(e,t){var n,r,i=this.onInitCallbacks.get(t);if(i)try{for(var o=ft(i),s=o.next();!s.done;s=o.next()){var a=s.value;try{a(e,t)}catch(e){}}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype.getOrInitializeService=function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===Wt?void 0:t),options:i}),this.instances.set(n,o),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(o,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(e){}return o||null},e.prototype.normalizeInstanceIdentifier=function(e){return void 0===e&&(e=Wt),this.component?this.component.multipleInstances?e:Wt:e},e.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},e}();
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Gt,Yt=function(){function e(e){this.name=e,this.providers=new Map}return e.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},e.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},e.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new Vt(e,this);return this.providers.set(e,t),t},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e}();
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Gt||(Gt={}));const Kt={debug:Gt.DEBUG,verbose:Gt.VERBOSE,info:Gt.INFO,warn:Gt.WARN,error:Gt.ERROR,silent:Gt.SILENT},Zt=Gt.INFO,Qt={[Gt.DEBUG]:"log",[Gt.VERBOSE]:"log",[Gt.INFO]:"info",[Gt.WARN]:"warn",[Gt.ERROR]:"error"},Xt=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=Qt[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class Jt{constructor(e){this.name=e,this._logLevel=Zt,this._logHandler=Xt,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Gt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Kt[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Gt.DEBUG,...e),this._logHandler(this,Gt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Gt.VERBOSE,...e),this._logHandler(this,Gt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Gt.INFO,...e),this._logHandler(this,Gt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Gt.WARN,...e),this._logHandler(this,Gt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Gt.ERROR,...e),this._logHandler(this,Gt.ERROR,...e)}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class en{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const tn="@firebase/app",nn="0.7.4",rn=new Jt("@firebase/app"),on="[DEFAULT]",sn={[tn]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},an=new Map,ln=new Map;function cn(e,t){try{e.container.addComponent(t)}catch(n){rn.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function un(e){const t=e.name;if(ln.has(t))return rn.debug(`There were multiple attempts to register component ${t}.`),!1;ln.set(t,e);for(const t of an.values())cn(t,e);return!0}function hn(e,t){return e.container.getProvider(t)}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const dn=new Nt("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class fn{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Ut("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw dn.create("app-deleted",{appName:this._name})}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const pn="9.1.3";function gn(e="[DEFAULT]"){const t=an.get(e);if(!t)throw dn.create("no-app",{appName:e});return t}function mn(e,t,n){var r;let i=null!==(r=sn[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const o=i.match(/\s|\//),s=t.match(/\s|\//);if(o||s){const e=[`Unable to register library "${i}" with version "${t}":`];return o&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void rn.warn(e.join(" "))}un(new Ut(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var _n;_n="",un(new Ut("platform-logger",(e=>new en(e)),"PRIVATE")),mn(tn,nn,_n),mn(tn,nn,"esm2017"),mn("fire-js","");var vn;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
mn("firebase","9.1.3","app"),function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(vn||(vn={}));
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const yn="firebasestorage.googleapis.com";class wn extends Tt{constructor(e,t){super(bn(e),`Firebase Storage: ${t} (${bn(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,wn.prototype)}_codeEquals(e){return bn(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function bn(e){return"storage/"+e}function Cn(e){return new wn("invalid-argument",e)}function xn(){return new wn("app-deleted","The Firebase app was deleted.")}function kn(e){throw new wn("internal-error","Internal error: "+e)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class In{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=vn.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=vn.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=vn.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw kn("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const e in r)r.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,r[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw kn("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw kn("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponseText(){if(!this.sent_)throw kn("cannot .getResponseText() before sending");return this.xhr_.responseText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Sn{createConnection(){return new In}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class En{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=En.makeFromUrl(e,t)}catch(t){return new En(e,"")}if(""===n.path)return n;throw new wn("invalid-default-bucket","Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+r+"(/(.*))?$","i");function o(e){e.path_=decodeURIComponent(e.path)}const s=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${s}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:o},{regex:new RegExp(`^https?://${t===yn?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:o}];for(let t=0;t<a.length;t++){const r=a[t],i=r.regex.exec(e);if(i){const e=i[r.indices.bucket];let t=i[r.indices.path];t||(t=""),n=new En(e,t),r.postModify(n);break}}if(null==n)throw function(e){return new wn("invalid-url","Invalid URL '"+e+"'.")}(e);return n}}class Tn{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Nn(e,t,n,r){if(r<t)throw Cn(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw Cn(`Invalid value for '${e}'. Expected ${n} or less.`)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Mn{constructor(e,t,n,r,i,o,s,a,l,c,u){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=s,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=c,this.pool_=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new $n(!1,null,!0));const n=this.pool_.createConnection();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===vn.NO_ERROR,i=n.getStatus();if(!t||this.isRetryStatusCode_(i)){const t=n.getErrorCode()===vn.ABORT;return void e(!1,new $n(!1,null,t))}const o=-1!==this.successCodes_.indexOf(i);e(!0,new $n(o,n))}))},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponseText());void 0!==e?n(e):n()}catch(e){r(e)}else if(null!==i){const e=new wn("unknown","An unknown error occurred, please check the error payload for server response.");e.serverResponse=i.getResponseText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else if(t.canceled){r(this.appDelete_?xn():new wn("canceled","User canceled the upload/download."))}else{r(new wn("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}};this.canceled_?t(0,new $n(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,o=!1,s=0;function a(){return 2===s}let l=!1;function c(...e){l||(l=!0,t.apply(null,e))}function u(t){i=setTimeout((()=>{i=null,e(h,a())}),t)}function h(e,...t){if(l)return;if(e)return void c.call(null,e,...t);if(a()||o)return void c.call(null,e,...t);let n;r<64&&(r*=2),1===s?(s=2,n=0):n=1e3*(r+Math.random()),u(n)}let d=!1;function f(e){d||(d=!0,l||(null!==i?(e||(s=2),clearTimeout(i),u(0)):e||(s=1)))}return u(0),setTimeout((()=>{o=!0,f(!0)}),n),f}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const t=e>=500&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r}}class $n{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Rn(e,t,n,r,i,o){const s=function(e){const t=encodeURIComponent;let n="?";for(const r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n=n.slice(0,-1),n}(e.urlParams),a=e.url+s,l=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(l,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(l,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(l,o),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(l,r),new Mn(a,e.method,l,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Pn{constructor(e,t){this._service=e,this._location=t instanceof En?t:En.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Pn(e,t)}get root(){const e=new En(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new En(this._location.bucket,e);return new Pn(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new wn("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function An(e,t){const n=null==t?void 0:t.storageBucket;return null==n?null:En.makeFromBucketSpec(n,e)}class Ln{constructor(e,t,n,r,i,o){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._pool=r,this._url=i,this._firebaseVersion=o,this._bucket=null,this._host=yn,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?En.makeFromBucketSpec(i,this._host):An(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=En.makeFromBucketSpec(this._url,e):this._bucket=An(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Nn("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Nn("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Pn(this,e)}_makeRequest(e,t,n){if(this._deleted)return new Tn(xn());{const r=Rn(e,this._appId,t,n,this._pool,this._firebaseVersion);return this._requests.add(r),r.getPromise().then((()=>this._requests.delete(r)),(()=>this._requests.delete(r))),r}}async makeRequestWithTokens(e){const[t,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n)}}const On="@firebase/storage",Dn="0.8.4",Fn="storage";function qn(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new Ln(n,r,i,new Sn,t,pn)}un(new Ut(Fn,qn,"PUBLIC").setMultipleInstances(!0)),mn(On,Dn,""),mn(On,Dn,"esm2017");const jn="@firebase/database",zn="0.12.2";
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
let Bn="";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Hn{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Rt(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:$t(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Un{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return At(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Wn=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Hn(t)}}catch(e){}return new Un},Vn=Wn("localStorage"),Gn=Wn("sessionStorage"),Yn=new Jt("@firebase/database"),Kn=function(){let e=1;return function(){return e++}}(),Zn=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,vt(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new jt;n.update(t);const r=n.digest();return bt.encodeByteArray(r)},Qn=function(...e){let t="";for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=Qn.apply(null,r):t+="object"==typeof r?Rt(r):r,t+=" "}return t};let Xn=null,Jn=!0;const er=function(...e){var t,n;if(!0===Jn&&(Jn=!1,null===Xn&&!0===Gn.get("logging_enabled")&&(t=!0,vt(!n||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Yn.logLevel=Gt.VERBOSE,Xn=Yn.log.bind(Yn),n&&Gn.set("logging_enabled",!0)):"function"==typeof t?Xn=t:(Xn=null,Gn.remove("logging_enabled")))),Xn){const t=Qn.apply(null,e);Xn(t)}},tr=function(e){return function(...t){er(e,...t)}},nr=function(...e){const t="FIREBASE INTERNAL ERROR: "+Qn(...e);Yn.error(t)},rr=function(...e){const t=`FIREBASE FATAL ERROR: ${Qn(...e)}`;throw Yn.error(t),new Error(t)},ir=function(...e){const t="FIREBASE WARNING: "+Qn(...e);Yn.warn(t)},or=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},sr="[MIN_NAME]",ar="[MAX_NAME]",lr=function(e,t){if(e===t)return 0;if(e===sr||t===ar)return-1;if(t===sr||e===ar)return 1;{const n=mr(e),r=mr(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},cr=function(e,t){return e===t?0:e<t?-1:1},ur=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Rt(t))},hr=function(e){if("object"!=typeof e||null===e)return Rt(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=Rt(t[r]),n+=":",n+=hr(e[t[r]]);return n+="}",n},dr=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function fr(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const pr=function(e){vt(!or(e),"Invalid JSON number");const t=1023;let n,r,i,o,s;0===e?(r=0,i=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=o+t,i=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(r=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(s=52;s;s-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const l=a.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(l.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()},gr=new RegExp("^-?(0*)\\d{1,10}$"),mr=function(e){if(gr.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},_r=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw ir("Exception was thrown by user callback.",t),e}),Math.floor(0))}},vr=function(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n};
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class yr{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){ir(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class wr{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(er("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ir(e)}}class br{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}br.OWNER="owner";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Cr=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,xr="websocket",kr="long_polling";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Ir{constructor(e,t,n,r,i=!1,o="",s=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Vn.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Vn.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Sr(e,t,n){let r;if(vt("string"==typeof t,"typeof type must == string"),vt("object"==typeof n,"typeof params must == object"),t===xr)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==kr)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const i=[];return fr(n,((e,t)=>{i.push(e+"="+t)})),r+i.join("&")}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Er{constructor(){this.counters_={}}incrementCounter(e,t=1){At(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return xt(this.counters_)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Tr={},Nr={};function Mr(e){const t=e.toString();return Tr[t]||(Tr[t]=new Er),Tr[t]}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class $r{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&_r((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Rr="start";class Pr{constructor(e,t,n,r,i,o,s){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=tr(e),this.stats_=Mr(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Sr(t,kr,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new $r(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ar(((...e)=>{const[t,n,r,i,o]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===Rr)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={start:"t"};e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Cr.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Pr.forceAllow_=!0}static forceDisallow(){Pr.forceDisallow_=!0}static isAvailable(){return!!Pr.forceAllow_||!(Pr.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Rt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=function(e){const t=wt(e);return bt.encodeByteArray(t,!0)}(t),r=dr(n,1840);for(let e=0;e<r.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Rt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Ar{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Kn(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Ar.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)){n='<script>document.domain="'+document.domain+'";<\/script>'}const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){er("frame writing exception"),e.stack&&er(e.stack),er(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||er("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(r),n()}))}addTag(e,t){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{er("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let Lr=null;"undefined"!=typeof MozWebSocket?Lr=MozWebSocket:"undefined"!=typeof WebSocket&&(Lr=WebSocket);class Or{constructor(e,t,n,r,i,o,s){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=tr(this.connId),this.stats_=Mr(t),this.connURL=Or.connectionURL_(t,o,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&Cr.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),Sr(e,xr,i)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Vn.set("previous_websocket_failure",!0);try{if(Et());else{const e={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new Lr(this.connURL,[],e)}}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Or.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Lr&&!Or.forceDisallow_}static previouslyFailed(){return Vn.isInMemoryStorage||!0===Vn.get("previous_websocket_failure")}markConnectionHealthy(){Vn.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=$t(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(vt(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Rt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=dr(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Or.responsesRequiredToBeHealthy=2,Or.healthyTimeout=3e4;
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Dr{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Pr,Or]}initTransports_(e){const t=Or&&Or.isAvailable();let n=t&&!Or.previouslyFailed();if(e.webSocketOnly&&(t||ir("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Or];else{const e=this.transports_=[];for(const t of Dr.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Fr{constructor(e,t,n,r,i,o,s,a,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=tr("c:"+this.id+":"),this.transportManager_=new Dr(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=vr((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=ur("t",e),n=ur("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=ur("t",e),n=ur("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=ur("t",e);if("d"in e){const n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?nr("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):nr("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&ir("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),vr((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):vr((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Vn.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qr{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class jr{constructor(e){this.allowedEvents_=e,this.listeners_={},vt(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(e){vt(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class zr extends jr{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||St()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new zr}getInitialEvent(e){return vt("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Br{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Hr(){return new Br("")}function Ur(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Wr(e){return e.pieces_.length-e.pieceNum_}function Vr(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Br(e.pieces_,t)}function Gr(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Yr(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Kr(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Br(t,0)}function Zr(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof Br)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new Br(n,0)}function Qr(e){return e.pieceNum_>=e.pieces_.length}function Xr(e,t){const n=Ur(e),r=Ur(t);if(null===n)return t;if(n===r)return Xr(Vr(e),Vr(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Jr(e,t){if(Wr(e)!==Wr(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function ei(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(Wr(e)>Wr(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class ti{constructor(e,t){this.errorPrefix_=t,this.parts_=Yr(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=Bt(this.parts_[e]);ni(this)}}function ni(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+ri(e))}function ri(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ii extends jr{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new ii}getInitialEvent(e){return vt("visible"===e,"Unknown event type: "+e),[this.visible_]}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const oi=1e3;class si extends qr{constructor(e,t,n,r,i,o,s,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=s,this.authOverride_=a,this.id=si.nextPersistentConnectionId_++,this.log_=tr("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=oi,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!Et())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ii.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&zr.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Rt(i)),vt(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new It,n={p:e._path.toString(),q:e._queryObject},r={action:"g",request:n,onComplete:e=>{const r=e.d;"ok"===e.s?(this.onDataUpdate_(n.p,r,!1,null),t.resolve(r)):t.reject(r)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_||setTimeout((()=>{const e=this.outstandingGets_[i];void 0!==e&&r===e&&(delete this.outstandingGets_[i],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+i+" timed out on connection"),t.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),vt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),vt(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const s={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,(i=>{const o=i.d,s=i.s;si.warnOnListenWarnings_(o,t);(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==s&&this.removeListen_(n,r),e.onComplete&&e.onComplete(s,o))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&At(e,"w")){const n=Lt(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();ir(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Pt(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Pt(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),vt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(e=>{r&&setTimeout((()=>{r(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Rt(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):nr("Unrecognized action received from server: "+Rt(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){vt(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=oi,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=oi,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=oi),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+si.nextConnectionId_++,i=this.lastSessionId;let o=!1,s=null;const a=function(){s?s.close():(o=!0,n())},l=function(e){vt(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(e)};this.realtime_={close:a,sendRequest:l};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,l]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);o?er("getToken() completed but was canceled"):(er("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=l&&l.token,s=new Fr(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{ir(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),i))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&ir(e),a())}}}interrupt(e){er("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){er("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ot(this.interruptReasons_)&&(this.reconnectDelay_=oi,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>hr(e))).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new Br(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){er("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){er("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+Bn.replace(/\./g,"-")]=1,St()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=zr.getInstance().currentlyOnline();return Ot(this.interruptReasons_)&&e}}si.nextPersistentConnectionId_=0,si.nextConnectionId_=0;
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class ai{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new ai(e,t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class li{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new ai(sr,e),r=new ai(sr,t);return 0!==this.compare(n,r)}minPost(){return ai.MIN}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let ci;class ui extends li{static get __EMPTY_NODE(){return ci}static set __EMPTY_NODE(e){ci=e}compare(e,t){return lr(e.name,t.name)}isDefinedOn(e){throw yt("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ai.MIN}maxPost(){return new ai(ar,ci)}makePost(e,t){return vt("string"==typeof e,"KeyIndex indexValue must always be a string."),new ai(e,ci)}toString(){return".key"}}const hi=new ui;
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class di{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class fi{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:fi.RED,this.left=null!=r?r:pi.EMPTY_NODE,this.right=null!=i?i:pi.EMPTY_NODE}copy(e,t,n,r,i){return new fi(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return pi.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return pi.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,fi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,fi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}fi.RED=!0,fi.BLACK=!1;class pi{constructor(e,t=pi.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new pi(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,fi.BLACK,null,null))}remove(e){return new pi(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,fi.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new di(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new di(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new di(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new di(this.root_,null,this.comparator_,!0,e)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function gi(e,t){return lr(e.name,t.name)}function mi(e,t){return lr(e,t)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let _i;pi.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new fi(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const vi=function(e){return"number"==typeof e?"number:"+pr(e):"string:"+e},yi=function(e){if(e.isLeafNode()){const t=e.val();vt("string"==typeof t||"number"==typeof t||"object"==typeof t&&At(t,".sv"),"Priority must be a string or number.")}else vt(e===_i||e.isEmpty(),"priority of unexpected type.");vt(e===_i||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
let wi,bi,Ci;class xi{constructor(e,t=xi.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,vt(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),yi(this.priorityNode_)}static set __childrenNodeConstructor(e){wi=e}static get __childrenNodeConstructor(){return wi}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new xi(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:xi.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Qr(e)?this:".priority"===Ur(e)?this.priorityNode_:xi.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:xi.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=Ur(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(vt(".priority"!==n||1===Wr(e),".priority must be the last token in a path"),this.updateImmediateChild(n,xi.__childrenNodeConstructor.EMPTY_NODE.updateChild(Vr(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+vi(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?pr(this.value_):this.value_,this.lazyHash_=Zn(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===xi.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof xi.__childrenNodeConstructor?-1:(vt(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=xi.VALUE_TYPE_ORDER.indexOf(t),i=xi.VALUE_TYPE_ORDER.indexOf(n);return vt(r>=0,"Unknown leaf type: "+t),vt(i>=0,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}xi.VALUE_TYPE_ORDER=["object","boolean","number","string"];const ki=new class extends li{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?lr(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ai.MIN}maxPost(){return new ai(ar,new xi("[PRIORITY-POST]",Ci))}makePost(e,t){const n=bi(e);return new ai(t,new xi("[PRIORITY-POST]",n))}toString(){return".priority"}},Ii=Math.log(2);
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Si{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Ii,10)),this.current_=this.count-1;const n=(r=this.count,parseInt(Array(r+1).join("1"),2));var r;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ei=function(e,t,n,r){e.sort(t);const i=function(t,r){const o=r-t;let s,a;if(0===o)return null;if(1===o)return s=e[t],a=n?n(s):s,new fi(a,s.node,fi.BLACK,null,null);{const l=parseInt(o/2,10)+t,c=i(t,l),u=i(l+1,r);return s=e[l],a=n?n(s):s,new fi(a,s.node,fi.BLACK,c,u)}},o=function(t){let r=null,o=null,s=e.length;const a=function(t,r){const o=s-t,a=s;s-=t;const c=i(o+1,a),u=e[o],h=n?n(u):u;l(new fi(h,u.node,r,null,c))},l=function(e){r?(r.left=e,r=e):(o=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,fi.BLACK):(a(r,fi.BLACK),a(r,fi.RED))}return o}(new Si(e.length));return new pi(r||t,o)};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let Ti;const Ni={};class Mi{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return vt(Ni&&ki,"ChildrenNode.ts has not been loaded"),Ti=Ti||new Mi({".priority":Ni},{".priority":ki}),Ti}get(e){const t=Lt(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof pi?t:null}hasIndex(e){return At(this.indexSet_,e.toString())}addIndex(e,t){vt(e!==hi,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(ai.Wrap);let o,s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();o=r?Ei(n,e.getCompare()):Ni;const a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;const c=Object.assign({},this.indexes_);return c[a]=o,new Mi(c,l)}addToIndexes(e,t){const n=Dt(this.indexes_,((n,r)=>{const i=Lt(this.indexSet_,r);if(vt(i,"Missing index implementation for "+r),n===Ni){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(ai.Wrap);let o=r.getNext();for(;o;)o.name!==e.name&&n.push(o),o=r.getNext();return n.push(e),Ei(n,i.getCompare())}return Ni}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new ai(e.name,r))),i.insert(e,e.node)}}));return new Mi(n,this.indexSet_)}removeFromIndexes(e,t){const n=Dt(this.indexes_,(n=>{if(n===Ni)return n;{const r=t.get(e.name);return r?n.remove(new ai(e.name,r)):n}}));return new Mi(n,this.indexSet_)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let $i;class Ri{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&yi(this.priorityNode_),this.children_.isEmpty()&&vt(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return $i||($i=new Ri(new pi(mi),null,Mi.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||$i}updatePriority(e){return this.children_.isEmpty()?this:new Ri(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?$i:t}}getChild(e){const t=Ur(e);return null===t?this:this.getImmediateChild(t).getChild(Vr(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(vt(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new ai(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(n,this.children_));const o=r.isEmpty()?$i:this.priorityNode_;return new Ri(r,o,i)}}updateChild(e,t){const n=Ur(e);if(null===n)return t;{vt(".priority"!==Ur(e)||1===Wr(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(Vr(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,i=!0;if(this.forEachChild(ki,((o,s)=>{t[o]=s.val(e),n++,i&&Ri.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1})),!e&&i&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+vi(this.getPriority().val())+":"),this.forEachChild(ki,((t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":Zn(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new ai(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new ai(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new ai(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,ai.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,ai.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Pi?-1:0}withIndex(e){if(e===hi||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Ri(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===hi||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(ki),n=t.getIterator(ki);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===hi?null:this.indexMap_.get(e.toString())}}Ri.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Pi=new class extends Ri{constructor(){super(new pi(mi),Ri.EMPTY_NODE,Mi.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ri.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(ai,{MIN:{value:new ai(sr,Ri.EMPTY_NODE)},MAX:{value:new ai(ar,Pi)}}),ui.__EMPTY_NODE=Ri.EMPTY_NODE,xi.__childrenNodeConstructor=Ri,_i=Pi,function(e){Ci=e}(Pi);function Ai(e,t=null){if(null===e)return Ri.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),vt(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new xi(e,Ai(t))}if(e instanceof Array){let n=Ri.EMPTY_NODE;return fr(e,((t,r)=>{if(At(e,t)&&"."!==t.substring(0,1)){const e=Ai(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(Ai(t))}{const n=[];let r=!1;if(fr(e,((e,t)=>{if("."!==e.substring(0,1)){const i=Ai(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new ai(e,i)))}})),0===n.length)return Ri.EMPTY_NODE;const i=Ei(n,gi,(e=>e.name),mi);if(r){const e=Ei(n,ki.getCompare());return new Ri(i,Ai(t),new Mi({".priority":e},{".priority":ki}))}return new Ri(i,Ai(t),Mi.Default)}}!function(e){bi=e}(Ai);
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Li extends li{constructor(e){super(),this.indexPath_=e,vt(!Qr(e)&&".priority"!==Ur(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?lr(e.name,t.name):i}makePost(e,t){const n=Ai(e),r=Ri.EMPTY_NODE.updateChild(this.indexPath_,n);return new ai(t,r)}maxPost(){const e=Ri.EMPTY_NODE.updateChild(this.indexPath_,Pi);return new ai(ar,e)}toString(){return Yr(this.indexPath_,0).join("/")}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Oi=new class extends li{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?lr(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ai.MIN}maxPost(){return ai.MAX}makePost(e,t){const n=Ai(e);return new ai(t,n)}toString(){return".value"}};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Di(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Fi(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function qi(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class ji{constructor(e){this.index_=e}updateChild(e,t,n,r,i,o){vt(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const s=e.getImmediateChild(t);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Fi(t,s)):vt(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(Di(t,n)):o.trackChildChange(qi(t,n,s))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(ki,((e,r)=>{t.hasChild(e)||n.trackChildChange(Fi(e,r))})),t.isLeafNode()||t.forEachChild(ki,((t,r)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(qi(t,r,i))}else n.trackChildChange(Di(t,r))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Ri.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class zi{constructor(e){this.indexedFilter_=new ji(e.getIndex()),this.index_=e.getIndex(),this.startPost_=zi.getStartPost_(e),this.endPost_=zi.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,r,i,o){return this.matches(new ai(t,n))||(n=Ri.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=Ri.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(Ri.EMPTY_NODE);const i=this;return t.forEachChild(ki,((e,t)=>{i.matches(new ai(e,t))||(r=r.updateImmediateChild(e,Ri.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Bi{constructor(e){this.rangedFilter_=new zi(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,r,i,o){return this.rangedFilter_.matches(new ai(t,n))||(n=Ri.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=Ri.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=Ri.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();let i;if(i=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),t)<=0:this.index_.compare(t,this.rangedFilter_.getEndPost())<=0,!i)break;r=r.updateImmediateChild(t.name,t.node),n++}}else{let e,n,i,o;if(r=t.withIndex(this.index_),r=r.updatePriority(Ri.EMPTY_NODE),this.reverse_){o=r.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),n=this.rangedFilter_.getStartPost();const t=this.index_.getCompare();i=(e,n)=>t(n,e)}else o=r.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),n=this.rangedFilter_.getEndPost(),i=this.index_.getCompare();let s=0,a=!1;for(;o.hasNext();){const t=o.getNext();!a&&i(e,t)<=0&&(a=!0);a&&s<this.limit_&&i(t,n)<=0?s++:r=r.updateImmediateChild(t.name,Ri.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const s=e;vt(s.numChildren()===this.limit_,"");const a=new ai(t,n),l=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),c=this.rangedFilter_.matches(a);if(s.hasChild(t)){const e=s.getImmediateChild(t);let u=r.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=u&&(u.name===t||s.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);const h=null==u?1:o(u,a);if(c&&!n.isEmpty()&&h>=0)return null!=i&&i.trackChildChange(qi(t,n,e)),s.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(Fi(t,e));const n=s.updateImmediateChild(t,Ri.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=i&&i.trackChildChange(Di(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:c&&o(l,a)>=0?(null!=i&&(i.trackChildChange(Fi(l.name,l.node)),i.trackChildChange(Di(t,n))),s.updateImmediateChild(t,n).updateImmediateChild(l.name,Ri.EMPTY_NODE)):e}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Hi{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ki}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return vt(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return vt(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:sr}hasEnd(){return this.endSet_}getIndexEndValue(){return vt(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return vt(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ar}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return vt(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ki}copy(){const e=new Hi;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Ui(e){const t={};if(e.isDefault())return t;let n;return e.index_===ki?n="$priority":e.index_===Oi?n="$value":e.index_===hi?n="$key":(vt(e.index_ instanceof Li,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Rt(n),e.startSet_&&(t.startAt=Rt(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+Rt(e.indexStartName_))),e.endSet_&&(t.endAt=Rt(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+Rt(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Wi(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==ki&&(t.i=e.index_.toString()),t}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Vi extends qr{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=tr("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(vt(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Vi.getListenId_(e,n),s={};this.listens_[o]=s;const a=Ui(e._queryParams);this.restRequest_(i+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),Lt(this.listens_,o)===s){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}}))}unlisten(e,t){const n=Vi.getListenId_(e,t);delete this.listens_[n]}get(e){const t=Ui(e._queryParams),n=e._path.toString(),r=new It;return this.restRequest_(n+".json",t,((e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))})),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+o);const s=new XMLHttpRequest;s.onreadystatechange=()=>{if(n&&4===s.readyState){this.log_("REST Response for "+o+" received. status:",s.status,"response:",s.responseText);let e=null;if(s.status>=200&&s.status<300){try{e=$t(s.responseText)}catch(e){ir("Failed to parse JSON response for "+o+": "+s.responseText)}n(null,e)}else 401!==s.status&&404!==s.status&&ir("Got unsuccessful REST response for "+o+" Status: "+s.status),n(s.status);n=null}},s.open("GET",o,!0),s.send()}))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Gi{constructor(){this.rootNode_=Ri.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Yi(){return{value:null,children:new Map}}function Ki(e,t,n){if(Qr(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=Ur(t);e.children.has(r)||e.children.set(r,Yi());Ki(e.children.get(r),t=Vr(t),n)}}function Zi(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e,((e,r)=>{Zi(r,new Br(t.toString()+"/"+e),n)}))}class Qi{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&fr(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Xi{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Qi(e);const n=1e4+2e4*Math.random();vr(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;fr(e,((e,r)=>{r>0&&At(this.statsToReport_,e)&&(t[e]=r,n=!0)})),n&&this.server_.reportStats(t),vr(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Ji;function eo(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Ji||(Ji={}));class to{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Ji.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Qr(this.path)){if(null!=this.affectedTree.value)return vt(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Br(e));return new to(Hr(),t,this.revert)}}return vt(Ur(this.path)===e,"operationForChild called for unrelated child."),new to(Vr(this.path),this.affectedTree,this.revert)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class no{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Ji.OVERWRITE}operationForChild(e){return Qr(this.path)?new no(this.source,Hr(),this.snap.getImmediateChild(e)):new no(this.source,Vr(this.path),this.snap)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ro{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Ji.MERGE}operationForChild(e){if(Qr(this.path)){const t=this.children.subtree(new Br(e));return t.isEmpty()?null:t.value?new no(this.source,Hr(),t.value):new ro(this.source,Hr(),t)}return vt(Ur(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ro(this.source,Vr(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class io{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Qr(e))return this.isFullyInitialized()&&!this.filtered_;const t=Ur(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class oo{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function so(e,t,n,r,i,o){const s=r.filter((e=>e.type===n));s.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw yt("Should only compare child_ events.");const r=new ai(t.childName,t.snapshotNode),i=new ai(n.childName,n.snapshotNode);return e.index_.compare(r,i)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e,t,n))),s.forEach((n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);i.forEach((i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}function ao(e,t){return{eventCache:e,serverCache:t}}function lo(e,t,n,r){return ao(new io(t,n,r),e.serverCache)}function co(e,t,n,r){return ao(e.eventCache,new io(t,n,r))}function uo(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function ho(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let fo;class po{constructor(e,t=(()=>(fo||(fo=new pi(cr)),fo))()){this.value=e,this.children=t}static fromObject(e){let t=new po(null);return fr(e,((e,n)=>{t=t.set(new Br(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Hr(),value:this.value};if(Qr(e))return null;{const n=Ur(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(Vr(e),t);if(null!=i){return{path:Zr(new Br(n),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Qr(e))return this;{const t=Ur(e),n=this.children.get(t);return null!==n?n.subtree(Vr(e)):new po(null)}}set(e,t){if(Qr(e))return new po(t,this.children);{const n=Ur(e),r=(this.children.get(n)||new po(null)).set(Vr(e),t),i=this.children.insert(n,r);return new po(this.value,i)}}remove(e){if(Qr(e))return this.children.isEmpty()?new po(null):new po(null,this.children);{const t=Ur(e),n=this.children.get(t);if(n){const r=n.remove(Vr(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new po(null):new po(this.value,i)}return this}}get(e){if(Qr(e))return this.value;{const t=Ur(e),n=this.children.get(t);return n?n.get(Vr(e)):null}}setTree(e,t){if(Qr(e))return t;{const n=Ur(e),r=(this.children.get(n)||new po(null)).setTree(Vr(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new po(this.value,i)}}fold(e){return this.fold_(Hr(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((r,i)=>{n[r]=i.fold_(Zr(e,r),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Hr(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(Qr(e))return null;{const r=Ur(e),i=this.children.get(r);return i?i.findOnPath_(Vr(e),Zr(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Hr(),t)}foreachOnPath_(e,t,n){if(Qr(e))return this;{this.value&&n(t,this.value);const r=Ur(e),i=this.children.get(r);return i?i.foreachOnPath_(Vr(e),Zr(t,r),n):new po(null)}}foreach(e){this.foreach_(Hr(),e)}foreach_(e,t){this.children.inorderTraversal(((n,r)=>{r.foreach_(Zr(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class go{constructor(e){this.writeTree_=e}static empty(){return new go(new po(null))}}function mo(e,t,n){if(Qr(t))return new go(new po(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let o=r.value;const s=Xr(i,t);return o=o.updateChild(s,n),new go(e.writeTree_.set(i,o))}{const r=new po(n),i=e.writeTree_.setTree(t,r);return new go(i)}}}function _o(e,t,n){let r=e;return fr(n,((e,n)=>{r=mo(r,Zr(t,e),n)})),r}function vo(e,t){if(Qr(t))return go.empty();{const n=e.writeTree_.setTree(t,new po(null));return new go(n)}}function yo(e,t){return null!=wo(e,t)}function wo(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Xr(n.path,t)):null}function bo(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(ki,((e,n)=>{t.push(new ai(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new ai(e,n.value))})),t}function Co(e,t){if(Qr(t))return e;{const n=wo(e,t);return new go(null!=n?new po(n):e.writeTree_.subtree(t))}}function xo(e){return e.writeTree_.isEmpty()}function ko(e,t){return Io(Hr(),e.writeTree_,t)}function Io(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,i)=>{".priority"===t?(vt(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=Io(Zr(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(Zr(e,".priority"),r)),n}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function So(e,t){return qo(t,e)}function Eo(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));vt(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,o=!1,s=e.allWrites.length-1;for(;i&&s>=0;){const t=e.allWrites[s];t.visible&&(s>=n&&To(t,r.path)?i=!1:ei(r.path,t.path)&&(o=!0)),s--}if(i){if(o)return function(e){e.visibleWrites=Mo(e.allWrites,No,Hr()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(r.snap)e.visibleWrites=vo(e.visibleWrites,r.path);else{fr(r.children,(t=>{e.visibleWrites=vo(e.visibleWrites,Zr(r.path,t))}))}return!0}return!1}function To(e,t){if(e.snap)return ei(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&ei(Zr(e.path,n),t))return!0;return!1}function No(e){return e.visible}function Mo(e,t,n){let r=go.empty();for(let i=0;i<e.length;++i){const o=e[i];if(t(o)){const e=o.path;let t;if(o.snap)ei(n,e)?(t=Xr(n,e),r=mo(r,t,o.snap)):ei(e,n)&&(t=Xr(e,n),r=mo(r,Hr(),o.snap.getChild(t)));else{if(!o.children)throw yt("WriteRecord should have .snap or .children");if(ei(n,e))t=Xr(n,e),r=_o(r,t,o.children);else if(ei(e,n))if(t=Xr(e,n),Qr(t))r=_o(r,Hr(),o.children);else{const e=Lt(o.children,Ur(t));if(e){const n=e.getChild(Vr(t));r=mo(r,Hr(),n)}}}}}return r}function $o(e,t,n,r,i){if(r||i){const o=Co(e.visibleWrites,t);if(!i&&xo(o))return n;if(i||null!=n||yo(o,Hr())){const o=function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(ei(e.path,t)||ei(t,e.path))};return ko(Mo(e.allWrites,o,t),n||Ri.EMPTY_NODE)}return null}{const r=wo(e.visibleWrites,t);if(null!=r)return r;{const r=Co(e.visibleWrites,t);if(xo(r))return n;if(null!=n||yo(r,Hr())){return ko(r,n||Ri.EMPTY_NODE)}return null}}}function Ro(e,t,n,r){return $o(e.writeTree,e.treePath,t,n,r)}function Po(e,t){return function(e,t,n){let r=Ri.EMPTY_NODE;const i=wo(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(ki,((e,t)=>{r=r.updateImmediateChild(e,t)})),r;if(n){const i=Co(e.visibleWrites,t);return n.forEachChild(ki,((e,t)=>{const n=ko(Co(i,new Br(e)),t);r=r.updateImmediateChild(e,n)})),bo(i).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}return bo(Co(e.visibleWrites,t)).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function Ao(e,t,n,r){return function(e,t,n,r,i){vt(r||i,"Either existingEventSnap or existingServerSnap must exist");const o=Zr(t,n);if(yo(e.visibleWrites,o))return null;{const t=Co(e.visibleWrites,o);return xo(t)?i.getChild(n):ko(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function Lo(e,t){return function(e,t){return wo(e.visibleWrites,t)}(e.writeTree,Zr(e.treePath,t))}function Oo(e,t,n,r,i,o){return function(e,t,n,r,i,o,s){let a;const l=Co(e.visibleWrites,t),c=wo(l,Hr());if(null!=c)a=c;else{if(null==n)return[];a=ko(l,n)}if(a=a.withIndex(s),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=s.getCompare(),n=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s);let l=n.getNext();for(;l&&e.length<i;)0!==t(l,r)&&e.push(l),l=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,o)}function Do(e,t,n){return function(e,t,n,r){const i=Zr(t,n),o=wo(e.visibleWrites,i);if(null!=o)return o;if(r.isCompleteForChild(n))return ko(Co(e.visibleWrites,i),r.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function Fo(e,t){return qo(Zr(e.treePath,t),e.writeTree)}function qo(e,t){return{treePath:e,writeTree:t}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class jo{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;vt("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),vt(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,qi(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Fi(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Di(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw yt("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,qi(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const zo=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Bo{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new io(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Do(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:ho(this.viewCache_),i=Oo(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Ho(e,t,n,r,i){const o=new jo;let s,a;if(n.type===Ji.OVERWRITE){const l=n;l.source.fromUser?s=Vo(e,t,l.path,l.snap,r,i,o):(vt(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!Qr(l.path),s=Wo(e,t,l.path,l.snap,r,i,a,o))}else if(n.type===Ji.MERGE){const l=n;l.source.fromUser?s=function(e,t,n,r,i,o,s){let a=t;return r.foreach(((r,l)=>{const c=Zr(n,r);Go(t,Ur(c))&&(a=Vo(e,a,c,l,i,o,s))})),r.foreach(((r,l)=>{const c=Zr(n,r);Go(t,Ur(c))||(a=Vo(e,a,c,l,i,o,s))})),a}(e,t,l.path,l.children,r,i,o):(vt(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),s=Ko(e,t,l.path,l.children,r,i,a,o))}else if(n.type===Ji.ACK_USER_WRITE){const a=n;s=a.revert?function(e,t,n,r,i,o){let s;if(null!=Lo(r,n))return t;{const a=new Bo(r,t,i),l=t.eventCache.getNode();let c;if(Qr(n)||".priority"===Ur(n)){let n;if(t.serverCache.isFullyInitialized())n=Ro(r,ho(t));else{const e=t.serverCache.getNode();vt(e instanceof Ri,"serverChildren would be complete if leaf node"),n=Po(r,e)}n=n,c=e.filter.updateFullNode(l,n,o)}else{const i=Ur(n);let u=Do(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=l.getImmediateChild(i)),c=null!=u?e.filter.updateChild(l,i,u,Vr(n),a,o):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,Ri.EMPTY_NODE,Vr(n),a,o):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(s=Ro(r,ho(t)),s.isLeafNode()&&(c=e.filter.updateFullNode(c,s,o)))}return s=t.serverCache.isFullyInitialized()||null!=Lo(r,Hr()),lo(t,c,s,e.filter.filtersNodes())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e,t,a.path,r,i,o):function(e,t,n,r,i,o,s){if(null!=Lo(i,n))return t;const a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value){if(Qr(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return Wo(e,t,n,l.getNode().getChild(n),i,o,a,s);if(Qr(n)){let r=new po(null);return l.getNode().forEachChild(hi,((e,t)=>{r=r.set(new Br(e),t)})),Ko(e,t,n,r,i,o,a,s)}return t}{let c=new po(null);return r.foreach(((e,t)=>{const r=Zr(n,e);l.isCompleteForPath(r)&&(c=c.set(e,l.getNode().getChild(r)))})),Ko(e,t,n,c,i,o,a,s)}}(e,t,a.path,a.affectedTree,r,i,o)}else{if(n.type!==Ji.LISTEN_COMPLETE)throw yt("Unknown operation type: "+n.type);s=function(e,t,n,r,i){const o=t.serverCache,s=co(t,o.getNode(),o.isFullyInitialized()||Qr(n),o.isFiltered());return Uo(e,s,n,r,zo,i)}(e,t,n.path,r,o)}const l=o.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=uo(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push({type:"value",snapshotNode:uo(t)})}}(t,s,l),{viewCache:s,changes:l}}function Uo(e,t,n,r,i,o){const s=t.eventCache;if(null!=Lo(r,n))return t;{let a,l;if(Qr(n))if(vt(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=ho(t),i=Po(r,n instanceof Ri?n:Ri.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,o)}else{const n=Ro(r,ho(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const c=Ur(n);if(".priority"===c){vt(1===Wr(n),"Can't have a priority with additional path components");const i=s.getNode();l=t.serverCache.getNode();const o=Ao(r,n,i,l);a=null!=o?e.filter.updatePriority(i,o):s.getNode()}else{const u=Vr(n);let h;if(s.isCompleteForChild(c)){l=t.serverCache.getNode();const e=Ao(r,n,s.getNode(),l);h=null!=e?s.getNode().getImmediateChild(c).updateChild(u,e):s.getNode().getImmediateChild(c)}else h=Do(r,c,t.serverCache);a=null!=h?e.filter.updateChild(s.getNode(),c,h,u,i,o):s.getNode()}}return lo(t,a,s.isFullyInitialized()||Qr(n),e.filter.filtersNodes())}}function Wo(e,t,n,r,i,o,s,a){const l=t.serverCache;let c;const u=s?e.filter:e.filter.getIndexedFilter();if(Qr(n))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(n,r);c=u.updateFullNode(l.getNode(),e,null)}else{const e=Ur(n);if(!l.isCompleteForPath(n)&&Wr(n)>1)return t;const i=Vr(n),o=l.getNode().getImmediateChild(e).updateChild(i,r);c=".priority"===e?u.updatePriority(l.getNode(),o):u.updateChild(l.getNode(),e,o,i,zo,null)}const h=co(t,c,l.isFullyInitialized()||Qr(n),u.filtersNodes());return Uo(e,h,n,i,new Bo(i,h,o),a)}function Vo(e,t,n,r,i,o,s){const a=t.eventCache;let l,c;const u=new Bo(i,t,o);if(Qr(n))c=e.filter.updateFullNode(t.eventCache.getNode(),r,s),l=lo(t,c,!0,e.filter.filtersNodes());else{const i=Ur(n);if(".priority"===i)c=e.filter.updatePriority(t.eventCache.getNode(),r),l=lo(t,c,a.isFullyInitialized(),a.isFiltered());else{const o=Vr(n),c=a.getNode().getImmediateChild(i);let h;if(Qr(o))h=r;else{const e=u.getCompleteChild(i);h=null!=e?".priority"===Gr(o)&&e.getChild(Kr(o)).isEmpty()?e:e.updateChild(o,r):Ri.EMPTY_NODE}if(c.equals(h))l=t;else{l=lo(t,e.filter.updateChild(a.getNode(),i,h,o,u,s),a.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function Go(e,t){return e.eventCache.isCompleteForChild(t)}function Yo(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Ko(e,t,n,r,i,o,s,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=Qr(n)?r:new po(null).setTree(n,r);const u=t.serverCache.getNode();return l.children.inorderTraversal(((n,r)=>{if(u.hasChild(n)){const l=Yo(0,t.serverCache.getNode().getImmediateChild(n),r);c=Wo(e,c,new Br(n),l,i,o,s,a)}})),l.children.inorderTraversal(((n,r)=>{const l=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!u.hasChild(n)&&!l){const l=Yo(0,t.serverCache.getNode().getImmediateChild(n),r);c=Wo(e,c,new Br(n),l,i,o,s,a)}})),c}class Zo{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new ji(n.getIndex()),i=(o=n).loadsAllData()?new ji(o.getIndex()):o.hasLimit()?new Bi(o):new zi(o);var o;this.processor_=function(e){return{filter:e}}(i);const s=t.serverCache,a=t.eventCache,l=r.updateFullNode(Ri.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(Ri.EMPTY_NODE,a.getNode(),null),u=new io(l,s.isFullyInitialized(),r.filtersNodes()),h=new io(c,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=ao(h,u),this.eventGenerator_=new oo(this.query_)}get query(){return this.query_}}function Qo(e,t){const n=ho(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Qr(t)&&!n.getImmediateChild(Ur(t)).isEmpty())?n.getChild(t):null}function Xo(e,t,n,r){t.type===Ji.MERGE&&null!==t.source.queryId&&(vt(ho(e.viewCache_),"We should always have a full cache before handling merges"),vt(uo(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,o=Ho(e.processor_,i,t,n,r);var s,a;return s=e.processor_,a=o.viewCache,vt(a.eventCache.getNode().isIndexed(s.filter.getIndex()),"Event snap not indexed"),vt(a.serverCache.getNode().isIndexed(s.filter.getIndex()),"Server snap not indexed"),vt(o.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,function(e,t,n,r){const i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){const i=[],o=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),so(e,i,"child_removed",t,r,n),so(e,i,"child_added",t,r,n),so(e,i,"child_moved",o,r,n),so(e,i,"child_changed",t,r,n),so(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e,o.changes,o.viewCache.eventCache.getNode(),null)}let Jo,es;class ts{constructor(){this.views=new Map}}function ns(e,t,n,r){const i=t.source.queryId;if(null!==i){const o=e.views.get(i);return vt(null!=o,"SyncTree gave us an op for an invalid query."),Xo(o,t,n,r)}{let i=[];for(const o of e.views.values())i=i.concat(Xo(o,t,n,r));return i}}function rs(e,t){let n=null;for(const r of e.views.values())n=n||Qo(r,t);return n}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class is{constructor(e){this.listenProvider_=e,this.syncPointTree_=new po(null),this.pendingWriteTree_={visibleWrites:go.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function os(e,t,n,r,i){return function(e,t,n,r,i){vt(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=mo(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?us(e,new no({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function ss(e,t,n=!1){const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(Eo(e.pendingWriteTree_,t)){let t=new po(null);return null!=r.snap?t=t.set(Hr(),!0):fr(r.children,(e=>{t=t.set(new Br(e),!0)})),us(e,new to(r.path,t,n))}return[]}function as(e,t,n){return us(e,new no({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function ls(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,((e,n)=>{const r=rs(n,Xr(e,t));if(r)return r}));return $o(r,t,i,n,!0)}function cs(e,t){const n=t._path;let r=null;e.syncPointTree_.foreachOnPath(n,((e,t)=>{const i=Xr(e,n);r=r||rs(t,i)}));let i=e.syncPointTree_.get(n);i?r=r||rs(i,Hr()):(i=new ts,e.syncPointTree_=e.syncPointTree_.set(n,i));const o=null!=r,s=o?new io(r,!0,!1):null,a=function(e,t,n,r,i){const o=t._queryIdentifier,s=e.views.get(o);if(!s){let e=Ro(n,i?r:null),o=!1;e?o=!0:r instanceof Ri?(e=Po(n,r),o=!1):(e=Ri.EMPTY_NODE,o=!1);const s=ao(new io(e,o,!1),new io(r,i,!1));return new Zo(t,s)}return s}(i,t,So(e.pendingWriteTree_,t._path),o?s.getNode():Ri.EMPTY_NODE,o);return function(e){return uo(e.viewCache_)}(a)}function us(e,t){return hs(t,e.syncPointTree_,null,So(e.pendingWriteTree_,Hr()))}function hs(e,t,n,r){if(Qr(e.path))return ds(e,t,n,r);{const i=t.get(Hr());null==n&&null!=i&&(n=rs(i,Hr()));let o=[];const s=Ur(e.path),a=e.operationForChild(s),l=t.children.get(s);if(l&&a){const e=n?n.getImmediateChild(s):null,t=Fo(r,s);o=o.concat(hs(a,l,e,t))}return i&&(o=o.concat(ns(i,e,r,n))),o}}function ds(e,t,n,r){const i=t.get(Hr());null==n&&null!=i&&(n=rs(i,Hr()));let o=[];return t.children.inorderTraversal(((t,i)=>{const s=n?n.getImmediateChild(t):null,a=Fo(r,t),l=e.operationForChild(t);l&&(o=o.concat(ds(l,i,s,a)))})),i&&(o=o.concat(ns(i,e,r,n))),o}function fs(e,t){return e.tagToQueryMap.get(t)}function ps(e){const t=e.indexOf("$");return vt(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Br(e.substr(0,t))}}function gs(e,t,n){const r=e.syncPointTree_.get(t);vt(r,"Missing sync point for query tag that we're tracking");return ns(r,n,So(e.pendingWriteTree_,t),null)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ms{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ms(t)}node(){return this.node_}}class _s{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Zr(this.path_,e);return new _s(this.syncTree_,t)}node(){return ls(this.syncTree_,this.path_)}}const vs=function(e,t,n){return e&&"object"==typeof e?(vt(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?ys(e[".sv"],t,n):"object"==typeof e[".sv"]?ws(e[".sv"],t):void vt(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},ys=function(e,t,n){if("timestamp"===e)return n.timestamp;vt(!1,"Unexpected server value: "+e)},ws=function(e,t,n){e.hasOwnProperty("increment")||vt(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&vt(!1,"Unexpected increment value: "+r);const i=t.node();if(vt(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const o=i.getValue();return"number"!=typeof o?r:o+r},bs=function(e,t,n){return Cs(e,new ms(t),n)};function Cs(e,t,n){const r=e.getPriority().val(),i=vs(r,t.getImmediateChild(".priority"),n);let o;if(e.isLeafNode()){const r=e,o=vs(r.getValue(),t,n);return o!==r.getValue()||i!==r.getPriority().val()?new xi(o,Ai(i)):e}{const r=e;return o=r,i!==r.getPriority().val()&&(o=o.updatePriority(new xi(i))),r.forEachChild(ki,((e,r)=>{const i=Cs(r,t.getImmediateChild(e),n);i!==r&&(o=o.updateImmediateChild(e,i))})),o}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class xs{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function ks(e,t){let n=t instanceof Br?t:new Br(t),r=e,i=Ur(n);for(;null!==i;){const e=Lt(r.node.children,i)||{children:{},childCount:0};r=new xs(i,r,e),n=Vr(n),i=Ur(n)}return r}function Is(e){return e.node.value}function Ss(e,t){e.node.value=t,$s(e)}function Es(e){return e.node.childCount>0}function Ts(e,t){fr(e.node.children,((n,r)=>{t(new xs(n,e,r))}))}function Ns(e,t,n,r){n&&!r&&t(e),Ts(e,(e=>{Ns(e,t,!0,r)})),n&&r&&t(e)}function Ms(e){return new Br(null===e.parent?e.name:Ms(e.parent)+"/"+e.name)}function $s(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===Is(e)&&!Es(e)}(n),i=At(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,$s(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,$s(e))}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e.parent,e.name,e)}const Rs=/[\[\].#$\/\u0000-\u001F\u007F]/,Ps=/[\[\].#$\u0000-\u001F\u007F]/,As=10485760,Ls=function(e){return"string"==typeof e&&0!==e.length&&!Rs.test(e)},Os=function(e){return"string"==typeof e&&0!==e.length&&!Ps.test(e)},Ds=function(e,t,n){const r=n instanceof Br?new ti(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+ri(r));if("function"==typeof t)throw new Error(e+"contains a function "+ri(r)+" with contents = "+t.toString());if(or(t))throw new Error(e+"contains "+t.toString()+" "+ri(r));if("string"==typeof t&&t.length>As/3&&Bt(t)>As)throw new Error(e+"contains a string greater than "+"10485760 utf8 bytes "+ri(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(fr(t,((t,o)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!Ls(t)))throw new Error(e+" contains an invalid key ("+t+") "+ri(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=Bt(t),ni(e)}(r,t),Ds(e,o,r),function(e){const t=e.parts_.pop();e.byteLength_-=Bt(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)})),n&&i)throw new Error(e+' contains ".value" child '+ri(r)+" in addition to actual children.")}},Fs=function(e,t,n,r){if(!(r&&void 0===n||Os(n)))throw new Error(zt(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},qs=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Ls(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Os(e)}(n))throw new Error(zt(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class js{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function zs(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],o=i.getPath();null===n||Jr(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&e.eventLists_.push(n)}function Bs(e,t,n){zs(e,n),Hs(e,(e=>ei(e,t)||ei(t,e)))}function Hs(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];if(i){t(i.path)?(Us(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function Us(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();Xn&&er("event: "+n.toString()),_r(r)}}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ws{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new js,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Yi(),this.transactionQueueTree_=new xs,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Vs(e,t,n){if(e.stats_=Mr(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Vi(e.repoInfo_,((t,n,r,i)=>{Ks(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Zs(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Rt(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new si(e.repoInfo_,t,((t,n,r,i)=>{Ks(e,t,n,r,i)}),(t=>{Zs(e,t)}),(t=>{!function(e,t){fr(t,((t,n)=>{Qs(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return Nr[n]||(Nr[n]=t()),Nr[n]}(e.repoInfo_,(()=>new Xi(e.stats_,e.server_))),e.infoData_=new Gi,e.infoSyncTree_=new is({startListening:(t,n,r,i)=>{let o=[];const s=e.infoData_.getNode(t._path);return s.isEmpty()||(o=as(e.infoSyncTree_,t._path,s),setTimeout((()=>{i("ok")}),0)),o},stopListening:()=>{}}),Qs(e,"connected",!1),e.serverSyncTree_=new is({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,((n,r)=>{const o=i(n,r);Bs(e.eventQueue_,t._path,o)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function Gs(e){const t=e.infoData_.getNode(new Br(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Ys(e){return(t=(t={timestamp:Gs(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function Ks(e,t,n,r,i){e.dataUpdateCount++;const o=new Br(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let s=[];if(i)if(r){const t=Dt(n,(e=>Ai(e)));s=function(e,t,n,r){const i=fs(e,r);if(i){const r=ps(i),o=r.path,s=r.queryId,a=Xr(o,t),l=po.fromObject(n);return gs(e,o,new ro(eo(s),a,l))}return[]}(e.serverSyncTree_,o,t,i)}else{const t=Ai(n);s=function(e,t,n,r){const i=fs(e,r);if(null!=i){const r=ps(i),o=r.path,s=r.queryId,a=Xr(o,t);return gs(e,o,new no(eo(s),a,n))}return[]}(e.serverSyncTree_,o,t,i)}else if(r){const t=Dt(n,(e=>Ai(e)));s=function(e,t,n){const r=po.fromObject(n);return us(e,new ro({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,o,t)}else{const t=Ai(n);s=as(e.serverSyncTree_,o,t)}let a=o;s.length>0&&(a=ia(e,o)),Bs(e.eventQueue_,a,s)}function Zs(e,t){Qs(e,"connected",t),!1===t&&function(e){ta(e,"onDisconnectEvents");const t=Ys(e),n=Yi();Zi(e.onDisconnect_,Hr(),((r,i)=>{const o=function(e,t,n,r){return Cs(t,new _s(n,e),r)}(r,i,e.serverSyncTree_,t);Ki(n,r,o)}));let r=[];Zi(n,Hr(),((t,n)=>{r=r.concat(as(e.serverSyncTree_,t,n));const i=ca(e,t);ia(e,i)})),e.onDisconnect_=Yi(),Bs(e.eventQueue_,Hr(),r)}(e)}function Qs(e,t,n){const r=new Br("/.info/"+t),i=Ai(n);e.infoData_.updateSnapshot(r,i);const o=as(e.infoSyncTree_,r,i);Bs(e.eventQueue_,r,o)}function Xs(e){return e.nextWriteId_++}function Js(e,t){const n=cs(e.serverSyncTree_,t);return null!=n?Promise.resolve(n):e.server_.get(t).then((n=>{const r=Ai(n).withIndex(t._queryParams.getIndex()),i=as(e.serverSyncTree_,t._path,r);var o,s;return o=e.eventQueue_,s=t._path,zs(o,i),Hs(o,(e=>Jr(e,s))),Promise.resolve(r)}),(n=>(ta(e,"get for query "+Rt(t)+" failed: "+n),Promise.reject(new Error(n)))))}function ea(e,t,n,r,i){ta(e,"set",{path:t.toString(),value:n,priority:r});const o=Ys(e),s=Ai(n,r),a=ls(e.serverSyncTree_,t),l=bs(s,a,o),c=Xs(e),u=os(e.serverSyncTree_,t,l,c,!0);zs(e.eventQueue_,u),e.server_.put(t.toString(),s.val(!0),((n,r)=>{const o="ok"===n;o||ir("set at "+t+" failed: "+n);const s=ss(e.serverSyncTree_,c,!o);Bs(e.eventQueue_,t,s),function(e,t,n,r){t&&_r((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const o=new Error(i);o.code=e,t(o)}}))}(0,i,n,r)}));const h=ca(e,t);ia(e,h),Bs(e.eventQueue_,h,[])}function ta(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),er(n,...t)}function na(e,t,n){return ls(e.serverSyncTree_,t,n)||Ri.EMPTY_NODE}function ra(e,t=e.transactionQueueTree_){if(t||la(e,t),Is(t)){const n=sa(e,t);vt(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,t,n){const r=n.map((e=>e.currentWriteId)),i=na(e,t,r);let o=i;const s=i.hash();for(let e=0;e<n.length;e++){const r=n[e];vt(0===r.status,"tryToSendTransactionQueue_: items in queue should all be run."),r.status=1,r.retryCount++;const i=Xr(t,r.path);o=o.updateChild(i,r.currentOutputSnapshotRaw)}const a=o.val(!0),l=t;e.server_.put(l.toString(),a,(r=>{ta(e,"transaction put response",{path:l.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(ss(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();la(e,ks(e.transactionQueueTree_,t)),ra(e,e.transactionQueueTree_),Bs(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)_r(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{ir("transaction at "+l.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}ia(e,t)}}),s)}(e,Ms(t),n)}else Es(t)&&Ts(t,(t=>{ra(e,t)}))}function ia(e,t){const n=oa(e,t),r=Ms(n);return function(e,t,n){if(0===t.length)return;const r=[];let i=[];const o=t.filter((e=>0===e.status)).map((e=>e.currentWriteId));for(let a=0;a<t.length;a++){const l=t[a],c=Xr(n,l.path);let u,h=!1;if(vt(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)h=!0,u=l.abortReason,i=i.concat(ss(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=25)h=!0,u="maxretry",i=i.concat(ss(e.serverSyncTree_,l.currentWriteId,!0));else{const n=na(e,l.path,o);l.currentInputSnapshot=n;const r=t[a].update(n.val());if(void 0!==r){Ds("transaction failed: Data returned ",r,l.path);let t=Ai(r);"object"==typeof r&&null!=r&&At(r,".priority")||(t=t.updatePriority(n.getPriority()));const s=l.currentWriteId,a=Ys(e),c=bs(t,n,a);l.currentOutputSnapshotRaw=t,l.currentOutputSnapshotResolved=c,l.currentWriteId=Xs(e),o.splice(o.indexOf(s),1),i=i.concat(os(e.serverSyncTree_,l.path,c,l.currentWriteId,l.applyLocally)),i=i.concat(ss(e.serverSyncTree_,s,!0))}else h=!0,u="nodata",i=i.concat(ss(e.serverSyncTree_,l.currentWriteId,!0))}Bs(e.eventQueue_,n,i),i=[],h&&(t[a].status=2,s=t[a].unwatcher,setTimeout(s,Math.floor(0)),t[a].onComplete&&("nodata"===u?r.push((()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot))):r.push((()=>t[a].onComplete(new Error(u),!1,null)))))}var s;la(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)_r(r[e]);ra(e,e.transactionQueueTree_)}(e,sa(e,n),r),r}function oa(e,t){let n,r=e.transactionQueueTree_;for(n=Ur(t);null!==n&&void 0===Is(r);)r=ks(r,n),n=Ur(t=Vr(t));return r}function sa(e,t){const n=[];return aa(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function aa(e,t,n){const r=Is(t);if(r)for(let e=0;e<r.length;e++)n.push(r[e]);Ts(t,(t=>{aa(e,t,n)}))}function la(e,t){const n=Is(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Ss(t,n.length>0?n:void 0)}Ts(t,(t=>{la(e,t)}))}function ca(e,t){const n=Ms(oa(e,t)),r=ks(e.transactionQueueTree_,t);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,(t=>{ua(e,t)})),ua(e,r),Ns(r,(t=>{ua(e,t)})),n}function ua(e,t){const n=Is(t);if(n){const r=[];let i=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(vt(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):(vt(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(ss(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Ss(t,void 0):n.length=o+1,Bs(e.eventQueue_,Ms(t),i);for(let e=0;e<r.length;e++)_r(r[e])}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const ha=function(e,t){const n=da(e),r=n.namespace;"firebase.com"===n.domain&&rr(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||rr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ir("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Ir(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new Br(n.pathString)}},da=function(e){let t="",n="",r="",i="",o="",s=!0,a="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(i=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(u,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):ir(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,h)));c=t.indexOf(":"),c>=0?(s="https"===a||"wss"===a,l=parseInt(t.substring(c+1),10)):c=t.length;const f=t.slice(0,c);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),o=r}"ns"in d&&(o=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:s,scheme:a,pathString:i,namespace:o}};
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class fa{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return Qr(this._path)?null:Gr(this._path)}get ref(){return new pa(this._repo,this._path)}get _queryIdentifier(){const e=Wi(this._queryParams),t=hr(e);return"{}"===t?"default":t}get _queryObject(){return Wi(this._queryParams)}isEqual(e){if(!((e=Ht(e))instanceof fa))return!1;const t=this._repo===e._repo,n=Jr(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class pa extends fa{constructor(e,t){super(e,t,new Hi,!1)}get parent(){const e=Kr(this._path);return null===e?null:new pa(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ga{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Br(e),n=_a(this.ref,e);return new ga(this._node.getChild(t),n,ki)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new ga(n,_a(this.ref,t),ki))))}hasChild(e){const t=new Br(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ma(e,t){return(e=Ht(e))._checkNotDeleted("ref"),void 0!==t?_a(e._root,t):e._root}function _a(e,t){var n,r,i,o;return null===Ur((e=Ht(e))._path)?(n="child",r="path",o=!1,(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),Fs(n,r,i,o)):Fs("child","path",t,!1),new pa(e._repo,Zr(e._path,t))}function va(e,t){(function(e,t){if(".info"===Ur(t))throw new Error(e+" failed = Can't modify data under /.info/")})("set",(e=Ht(e))._path),function(e,t,n,r){r&&void 0===t||Ds(zt(e,"value"),t,n)}("set",t,e._path,!1);const n=new It;return ea(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}!function(e){vt(!Jo,"__referenceConstructor has already been defined"),Jo=e}(pa),function(e){vt(!es,"__referenceConstructor has already been defined"),es=e}(pa);
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const ya={};function wa(e,t,n,r,i){let o=r||e.options.databaseURL;void 0===o&&(e.options.projectId||rr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),er("Using default host for project ",e.options.projectId),o=`${e.options.projectId}-default-rtdb.firebaseio.com`);let s,a,l=ha(o,i),c=l.repoInfo;"undefined"!=typeof process&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(s=!0,o=`http://${a}?ns=${c.namespace}`,l=ha(o,i),c=l.repoInfo):s=!l.repoInfo.secure;const u=i&&s?new br(br.OWNER):new wr(e.name,e.options,t);qs("Invalid Firebase Database URL",l),Qr(l.path)||rr("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(e,t,n,r){let i=ya[t.name];i||(i={},ya[t.name]=i);let o=i[e.toURLString()];o&&rr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return o=new Ws(e,false,n,r),i[e.toURLString()]=o,o}(c,e,u,new yr(e.name,n));return new ba(h,e)}class ba{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Vs(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new pa(this._repo,Hr())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=ya[t];n&&n[e.key]===e||rr(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&rr("Cannot call "+e+" on a deleted database.")}}si.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},si.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e){!function(e){Bn=e}(pn),un(new Ut("database",((e,{instanceIdentifier:t})=>wa(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),mn(jn,zn,e),mn(jn,zn,"esm2017")}();const Ca=function(e,t={}){if("object"!=typeof t){t={name:t}}const n=Object.assign({name:on,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw dn.create("bad-app-name",{appName:String(r)});const i=an.get(r);if(i){if(Ft(e,i.options)&&Ft(n,i.config))return i;throw dn.create("duplicate-app",{appName:r})}const o=new Yt(r);for(const e of ln.values())o.addComponent(e);const s=new fn(e,n,o);return an.set(r,s),s}({apiKey:"AIzaSyCFE8TqTBWCDSBee0CuT9HXLnNNRtSA4S8",authDomain:"eye-tracking-8adeb.firebaseapp.com",databaseURL:"https://eye-tracking-8adeb-default-rtdb.firebaseio.com",projectId:"eye-tracking-8adeb",storageBucket:"eye-tracking-8adeb.appspot.com",messagingSenderId:"214459503975",appId:"1:214459503975:web:ff62018ff95cb21cfe8bc2",measurementId:"G-55T3T75PPR"}),xa=function(e=gn(),t){return hn(e,"database").getImmediate({identifier:t})}(Ca);async function ka(e){try{let n=await(t=_a(ma(xa),e),Js((t=Ht(t))._repo,t).then((e=>new ga(e,new pa(t._repo,t._path),t._queryParams.getIndex()))));return n.exists()?n.val():null}catch(e){console.error(e)}var t}async function Ia(e){let t=h(He);if("works"==e)return t?h(Ue).works:ka(e);if(e.includes("sessionData")){let t=e.split("sessionData/")[1];return t?h(Ue).sessionData[t]:ka(e)}if(e.includes("reactions")){let t=e.split("reactions/")[1];return t?h(Ue).reactions[t]:null}}async function Sa(e,t){try{return await va(ma(xa,e),t),"db write done"}catch(e){console.error(e)}}function Ea(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ta(e){let t=e,n=e,r=e;function i(e,t,i=0,o=e.length){if(i<o){if(0!==n(t,t))return o;do{const n=i+o>>>1;r(e[n],t)<0?i=n+1:o=n}while(i<o)}return i}return 2!==e.length&&(t=(t,n)=>e(t)-n,n=Ea,r=(t,n)=>Ea(e(t),n)),{left:i,center:function(e,n,r=0,o=e.length){const s=i(e,n,r,o-1);return s>r&&t(e[s-1],n)>-t(e[s],n)?s-1:s},right:function(e,t,i=0,o=e.length){if(i<o){if(0!==n(t,t))return o;do{const n=i+o>>>1;r(e[n],t)<=0?i=n+1:o=n}while(i<o)}return i}}}!function(e=gn(),t){hn(e=Ht(e),Fn).getImmediate({identifier:t})}(Ca);const Na=Ta(Ea).right;Ta((function(e){return null===e?NaN:+e})).center;var Ma=Na;class $a{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],o=e+i,s=Math.abs(e)<Math.abs(i)?e-(o-i):i-(o-e);s&&(t[n++]=s),e=o}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,r,i=this._n,o=0;if(i>0){for(o=e[--i];i>0&&(t=o,n=e[--i],o=t+n,r=n-(o-t),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(n=2*r,t=o+n,n==t-o&&(o=t))}return o}}var Ra=Math.sqrt(50),Pa=Math.sqrt(10),Aa=Math.sqrt(2);function La(e,t,n){var r,i,o,s,a=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(s=Oa(e,t,n))||!isFinite(s))return[];if(s>0){let n=Math.round(e/s),r=Math.round(t/s);for(n*s<e&&++n,r*s>t&&--r,o=new Array(i=r-n+1);++a<i;)o[a]=(n+a)*s}else{s=-s;let n=Math.round(e*s),r=Math.round(t*s);for(n/s<e&&++n,r/s>t&&--r,o=new Array(i=r-n+1);++a<i;)o[a]=(n+a)/s}return r&&o.reverse(),o}function Oa(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=Ra?10:o>=Pa?5:o>=Aa?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=Ra?10:o>=Pa?5:o>=Aa?2:1)}function Da(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=Ra?i*=10:o>=Pa?i*=5:o>=Aa&&(i*=2),t<e?-i:i}function Fa(e){return Math.ceil(Math.log(function(e,t){let n=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&++n;else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(i=+i)>=i&&++n}return n}(e))/Math.LN2)+1}function qa(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}var ja={value:()=>{}};function za(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new Ba(r)}function Ba(e){this._=e}function Ha(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function Ua(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function Wa(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=ja,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}Ba.prototype=za.prototype={constructor:Ba,on:function(e,t){var n,r=this._,i=Ha(e+"",r),o=-1,s=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++o<s;)if(n=(e=i[o]).type)r[n]=Wa(r[n],e.name,t);else if(null==t)for(n in r)r[n]=Wa(r[n],e.name,null);return this}for(;++o<s;)if((n=(e=i[o]).type)&&(n=Ua(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ba(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=0,n=(r=this._[e]).length;o<n;++o)r[o].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,o=r.length;i<o;++i)r[i].value.apply(t,n)}};var Va="http://www.w3.org/1999/xhtml",Ga={svg:"http://www.w3.org/2000/svg",xhtml:Va,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ya(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Ga.hasOwnProperty(t)?{space:Ga[t],local:e}:e}function Ka(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Va&&t.documentElement.namespaceURI===Va?t.createElement(e):t.createElementNS(n,e)}}function Za(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Qa(e){var t=Ya(e);return(t.local?Za:Ka)(t)}function Xa(){}function Ja(e){return null==e?Xa:function(){return this.querySelector(e)}}function el(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}function tl(){return[]}function nl(e){return null==e?tl:function(){return this.querySelectorAll(e)}}function rl(e){return function(){return this.matches(e)}}function il(e){return function(t){return t.matches(e)}}var ol=Array.prototype.find;function sl(){return this.firstElementChild}var al=Array.prototype.filter;function ll(){return Array.from(this.children)}function cl(e){return new Array(e.length)}function ul(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function hl(e){return function(){return e}}function dl(e,t,n,r,i,o){for(var s,a=0,l=t.length,c=o.length;a<c;++a)(s=t[a])?(s.__data__=o[a],r[a]=s):n[a]=new ul(e,o[a]);for(;a<l;++a)(s=t[a])&&(i[a]=s)}function fl(e,t,n,r,i,o,s){var a,l,c,u=new Map,h=t.length,d=o.length,f=new Array(h);for(a=0;a<h;++a)(l=t[a])&&(f[a]=c=s.call(l,l.__data__,a,t)+"",u.has(c)?i[a]=l:u.set(c,l));for(a=0;a<d;++a)c=s.call(e,o[a],a,o)+"",(l=u.get(c))?(r[a]=l,l.__data__=o[a],u.delete(c)):n[a]=new ul(e,o[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(f[a])===l&&(i[a]=l)}function pl(e){return e.__data__}function gl(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function ml(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function _l(e){return function(){this.removeAttribute(e)}}function vl(e){return function(){this.removeAttributeNS(e.space,e.local)}}function yl(e,t){return function(){this.setAttribute(e,t)}}function wl(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function bl(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function Cl(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function xl(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function kl(e){return function(){this.style.removeProperty(e)}}function Il(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Sl(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function El(e,t){return e.style.getPropertyValue(t)||xl(e).getComputedStyle(e,null).getPropertyValue(t)}function Tl(e){return function(){delete this[e]}}function Nl(e,t){return function(){this[e]=t}}function Ml(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function $l(e){return e.trim().split(/^|\s+/)}function Rl(e){return e.classList||new Pl(e)}function Pl(e){this._node=e,this._names=$l(e.getAttribute("class")||"")}function Al(e,t){for(var n=Rl(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function Ll(e,t){for(var n=Rl(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function Ol(e){return function(){Al(this,e)}}function Dl(e){return function(){Ll(this,e)}}function Fl(e,t){return function(){(t.apply(this,arguments)?Al:Ll)(this,e)}}function ql(){this.textContent=""}function jl(e){return function(){this.textContent=e}}function zl(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function Bl(){this.innerHTML=""}function Hl(e){return function(){this.innerHTML=e}}function Ul(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function Wl(){this.nextSibling&&this.parentNode.appendChild(this)}function Vl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Gl(){return null}function Yl(){var e=this.parentNode;e&&e.removeChild(this)}function Kl(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Zl(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Ql(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}function Xl(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,o=t.length;r<o;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function Jl(e,t,n){return function(){var r,i=this.__on,o=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var s=0,a=i.length;s<a;++s)if((r=i[s]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),void(r.value=t);this.addEventListener(e.type,o,n),r={type:e.type,name:e.name,value:t,listener:o,options:n},i?i.push(r):this.__on=[r]}}function ec(e,t,n){var r=xl(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function tc(e,t){return function(){return ec(this,e,t)}}function nc(e,t){return function(){return ec(this,e,t.apply(this,arguments))}}ul.prototype={constructor:ul,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},Pl.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var rc=[null];function ic(e,t){this._groups=e,this._parents=t}function oc(){return new ic([[document.documentElement]],rc)}function sc(e){return"string"==typeof e?new ic([[document.querySelector(e)]],[document.documentElement]):new ic([[e]],rc)}function ac(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function lc(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function cc(){}ic.prototype=oc.prototype={constructor:ic,select:function(e){"function"!=typeof e&&(e=Ja(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o,s,a=t[i],l=a.length,c=r[i]=new Array(l),u=0;u<l;++u)(o=a[u])&&(s=e.call(o,o.__data__,u,a))&&("__data__"in o&&(s.__data__=o.__data__),c[u]=s);return new ic(r,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){return el(e.apply(this,arguments))}}(e):nl(e);for(var t=this._groups,n=t.length,r=[],i=[],o=0;o<n;++o)for(var s,a=t[o],l=a.length,c=0;c<l;++c)(s=a[c])&&(r.push(e.call(s,s.__data__,c,a)),i.push(s));return new ic(r,i)},selectChild:function(e){return this.select(null==e?sl:function(e){return function(){return ol.call(this.children,e)}}("function"==typeof e?e:il(e)))},selectChildren:function(e){return this.selectAll(null==e?ll:function(e){return function(){return al.call(this.children,e)}}("function"==typeof e?e:il(e)))},filter:function(e){"function"!=typeof e&&(e=rl(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o,s=t[i],a=s.length,l=r[i]=[],c=0;c<a;++c)(o=s[c])&&e.call(o,o.__data__,c,s)&&l.push(o);return new ic(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,pl);var n=t?fl:dl,r=this._parents,i=this._groups;"function"!=typeof e&&(e=hl(e));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=r[c],h=i[c],d=h.length,f=gl(e.call(u,u&&u.__data__,c,r)),p=f.length,g=a[c]=new Array(p),m=s[c]=new Array(p),_=l[c]=new Array(d);n(u,h,g,m,_,f,t);for(var v,y,w=0,b=0;w<p;++w)if(v=g[w]){for(w>=b&&(b=w+1);!(y=m[b])&&++b<p;);v._next=y||null}}return(s=new ic(s,r))._enter=a,s._exit=l,s},enter:function(){return new ic(this._enter||this._groups.map(cl),this._parents)},exit:function(){return new ic(this._exit||this._groups.map(cl),this._parents)},join:function(e,t,n){var r=this.enter(),i=this,o=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?o.remove():n(o),r&&i?r.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,o=r.length,s=Math.min(i,o),a=new Array(i),l=0;l<s;++l)for(var c,u=n[l],h=r[l],d=u.length,f=a[l]=new Array(d),p=0;p<d;++p)(c=u[p]||h[p])&&(f[p]=c);for(;l<i;++l)a[l]=n[l];return new ic(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],o=i.length-1,s=i[o];--o>=0;)(r=i[o])&&(s&&4^r.compareDocumentPosition(s)&&s.parentNode.insertBefore(r,s),s=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=ml);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var s,a=n[o],l=a.length,c=i[o]=new Array(l),u=0;u<l;++u)(s=a[u])&&(c[u]=s);c.sort(t)}return new ic(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,o=r.length;i<o;++i){var s=r[i];if(s)return s}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,o=t[n],s=0,a=o.length;s<a;++s)(i=o[s])&&e.call(i,i.__data__,s,o);return this},attr:function(e,t){var n=Ya(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?vl:_l:"function"==typeof t?n.local?Cl:bl:n.local?wl:yl)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?kl:"function"==typeof t?Sl:Il)(e,t,null==n?"":n)):El(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?Tl:"function"==typeof t?Ml:Nl)(e,t)):this.node()[e]},classed:function(e,t){var n=$l(e+"");if(arguments.length<2){for(var r=Rl(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?Fl:t?Ol:Dl)(n,t))},text:function(e){return arguments.length?this.each(null==e?ql:("function"==typeof e?zl:jl)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?Bl:("function"==typeof e?Ul:Hl)(e)):this.node().innerHTML},raise:function(){return this.each(Wl)},lower:function(){return this.each(Vl)},append:function(e){var t="function"==typeof e?e:Qa(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:Qa(e),r=null==t?Gl:"function"==typeof t?t:Ja(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Yl)},clone:function(e){return this.select(e?Zl:Kl)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,o=Ql(e+""),s=o.length;if(!(arguments.length<2)){for(a=t?Jl:Xl,r=0;r<s;++r)this.each(a(o[r],t,n));return this}var a=this.node().__on;if(a)for(var l,c=0,u=a.length;c<u;++c)for(r=0,l=a[c];r<s;++r)if((i=o[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?nc:tc)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,i=e[t],o=0,s=i.length;o<s;++o)(r=i[o])&&(yield r)}};var uc=.7,hc=1/uc,dc="\\s*([+-]?\\d+)\\s*",fc="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",pc="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gc=/^#([0-9a-f]{3,8})$/,mc=new RegExp("^rgb\\("+[dc,dc,dc]+"\\)$"),_c=new RegExp("^rgb\\("+[pc,pc,pc]+"\\)$"),vc=new RegExp("^rgba\\("+[dc,dc,dc,fc]+"\\)$"),yc=new RegExp("^rgba\\("+[pc,pc,pc,fc]+"\\)$"),wc=new RegExp("^hsl\\("+[fc,pc,pc]+"\\)$"),bc=new RegExp("^hsla\\("+[fc,pc,pc,fc]+"\\)$"),Cc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function xc(){return this.rgb().formatHex()}function kc(){return this.rgb().formatRgb()}function Ic(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=gc.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Sc(t):3===n?new Mc(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Ec(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Ec(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=mc.exec(e))?new Mc(t[1],t[2],t[3],1):(t=_c.exec(e))?new Mc(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=vc.exec(e))?Ec(t[1],t[2],t[3],t[4]):(t=yc.exec(e))?Ec(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=wc.exec(e))?Ac(t[1],t[2]/100,t[3]/100,1):(t=bc.exec(e))?Ac(t[1],t[2]/100,t[3]/100,t[4]):Cc.hasOwnProperty(e)?Sc(Cc[e]):"transparent"===e?new Mc(NaN,NaN,NaN,0):null}function Sc(e){return new Mc(e>>16&255,e>>8&255,255&e,1)}function Ec(e,t,n,r){return r<=0&&(e=t=n=NaN),new Mc(e,t,n,r)}function Tc(e){return e instanceof cc||(e=Ic(e)),e?new Mc((e=e.rgb()).r,e.g,e.b,e.opacity):new Mc}function Nc(e,t,n,r){return 1===arguments.length?Tc(e):new Mc(e,t,n,null==r?1:r)}function Mc(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function $c(){return"#"+Pc(this.r)+Pc(this.g)+Pc(this.b)}function Rc(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Pc(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Ac(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Oc(e,t,n,r)}function Lc(e){if(e instanceof Oc)return new Oc(e.h,e.s,e.l,e.opacity);if(e instanceof cc||(e=Ic(e)),!e)return new Oc;if(e instanceof Oc)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),s=NaN,a=o-i,l=(o+i)/2;return a?(s=t===o?(n-r)/a+6*(n<r):n===o?(r-t)/a+2:(t-n)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new Oc(s,a,l,e.opacity)}function Oc(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Dc(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}ac(cc,Ic,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:xc,formatHex:xc,formatHsl:function(){return Lc(this).formatHsl()},formatRgb:kc,toString:kc}),ac(Mc,Nc,lc(cc,{brighter:function(e){return e=null==e?hc:Math.pow(hc,e),new Mc(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?uc:Math.pow(uc,e),new Mc(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$c,formatHex:$c,formatRgb:Rc,toString:Rc})),ac(Oc,(function(e,t,n,r){return 1===arguments.length?Lc(e):new Oc(e,t,n,null==r?1:r)}),lc(cc,{brighter:function(e){return e=null==e?hc:Math.pow(hc,e),new Oc(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?uc:Math.pow(uc,e),new Oc(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Mc(Dc(e>=240?e-240:e+120,i,r),Dc(e,i,r),Dc(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var Fc=e=>()=>e;function qc(e){return 1==(e=+e)?jc:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Fc(isNaN(t)?n:t)}}function jc(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):Fc(isNaN(e)?t:e)}var zc=function e(t){var n=qc(t);function r(e,t){var r=n((e=Nc(e)).r,(t=Nc(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),s=jc(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=s(t),e+""}}return r.gamma=e,r}(1);function Bc(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function Hc(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),s=new Array(r);for(n=0;n<i;++n)o[n]=Zc(e[n],t[n]);for(;n<r;++n)s[n]=t[n];return function(e){for(n=0;n<i;++n)s[n]=o[n](e);return s}}function Uc(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Wc(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Vc(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Zc(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var Gc=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yc=new RegExp(Gc.source,"g");function Kc(e,t){var n,r,i,o=Gc.lastIndex=Yc.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(n=Gc.exec(e))&&(r=Yc.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),a[s]?a[s]+=i:a[++s]=i),(n=n[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,l.push({i:s,x:Wc(n,r)})),o=Yc.lastIndex;return o<t.length&&(i=t.slice(o),a[s]?a[s]+=i:a[++s]=i),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)a[(n=l[r]).i]=n.x(e);return a.join("")})}function Zc(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?Fc(t):("number"===i?Wc:"string"===i?(n=Ic(t))?(t=n,zc):Kc:t instanceof Ic?zc:t instanceof Date?Uc:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?Hc:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Vc:Wc:Bc))(e,t)}function Qc(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var Xc,Jc=180/Math.PI,eu={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function tu(e,t,n,r,i,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),e*r<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(t,e)*Jc,skewX:Math.atan(l)*Jc,scaleX:s,scaleY:a}}function nu(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(o,s){var a=[],l=[];return o=e(o),s=e(s),function(e,r,i,o,s,a){if(e!==i||r!==o){var l=s.push("translate(",null,t,null,n);a.push({i:l-4,x:Wc(e,i)},{i:l-2,x:Wc(r,o)})}else(i||o)&&s.push("translate("+i+t+o+n)}(o.translateX,o.translateY,s.translateX,s.translateY,a,l),function(e,t,n,o){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Wc(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(o.rotate,s.rotate,a,l),function(e,t,n,o){e!==t?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Wc(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(o.skewX,s.skewX,a,l),function(e,t,n,r,o,s){if(e!==n||t!==r){var a=o.push(i(o)+"scale(",null,",",null,")");s.push({i:a-4,x:Wc(e,n)},{i:a-2,x:Wc(t,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,s.scaleX,s.scaleY,a,l),o=s=null,function(e){for(var t,n=-1,r=l.length;++n<r;)a[(t=l[n]).i]=t.x(e);return a.join("")}}}var ru,iu,ou=nu((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?eu:tu(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),su=nu((function(e){return null==e?eu:(Xc||(Xc=document.createElementNS("http://www.w3.org/2000/svg","g")),Xc.setAttribute("transform",e),(e=Xc.transform.baseVal.consolidate())?tu((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):eu)}),", ",")",")"),au=0,lu=0,cu=0,uu=0,hu=0,du=0,fu="object"==typeof performance&&performance.now?performance:Date,pu="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function gu(){return hu||(pu(mu),hu=fu.now()+du)}function mu(){hu=0}function _u(){this._call=this._time=this._next=null}function vu(e,t,n){var r=new _u;return r.restart(e,t,n),r}function yu(){hu=(uu=fu.now())+du,au=lu=0;try{!function(){gu(),++au;for(var e,t=ru;t;)(e=hu-t._time)>=0&&t._call.call(void 0,e),t=t._next;--au}()}finally{au=0,function(){var e,t,n=ru,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:ru=t);iu=e,bu(r)}(),hu=0}}function wu(){var e=fu.now(),t=e-uu;t>1e3&&(du-=t,uu=e)}function bu(e){au||(lu&&(lu=clearTimeout(lu)),e-hu>24?(e<1/0&&(lu=setTimeout(yu,e-fu.now()-du)),cu&&(cu=clearInterval(cu))):(cu||(uu=fu.now(),cu=setInterval(wu,1e3)),au=1,pu(yu)))}function Cu(e,t,n){var r=new _u;return t=null==t?0:+t,r.restart((n=>{r.stop(),e(n+t)}),t,n),r}_u.prototype=vu.prototype={constructor:_u,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?gu():+n)+(null==t?0:+t),this._next||iu===this||(iu?iu._next=this:ru=this,iu=this),this._call=e,this._time=n,bu()},stop:function(){this._call&&(this._call=null,this._time=1/0,bu())}};var xu=za("start","end","cancel","interrupt"),ku=[];function Iu(e,t,n,r,i,o){var s=e.__transition;if(s){if(n in s)return}else e.__transition={};!function(e,t,n){var r,i=e.__transition;function o(e){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=e&&s(e-n.delay)}function s(o){var c,u,h,d;if(1!==n.state)return l();for(c in i)if((d=i[c]).name===n.name){if(3===d.state)return Cu(s);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete i[c]):+c<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete i[c])}if(Cu((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(o))})),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(d=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(r[++u]=d);r.length=u+1}}function a(t){for(var i=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(l),n.state=5,1),o=-1,s=r.length;++o<s;)r[o].call(e,i);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){for(var r in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=vu(o,0,n.time)}(e,n,{name:t,index:r,group:i,on:xu,tween:ku,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function Su(e,t){var n=Tu(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Eu(e,t){var n=Tu(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Tu(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Nu(e,t){var n,r;return function(){var i=Eu(this,e),o=i.tween;if(o!==n)for(var s=0,a=(r=n=o).length;s<a;++s)if(r[s].name===t){(r=r.slice()).splice(s,1);break}i.tween=r}}function Mu(e,t,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var o=Eu(this,e),s=o.tween;if(s!==r){i=(r=s).slice();for(var a={name:t,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=a;break}l===c&&i.push(a)}o.tween=i}}function $u(e,t,n){var r=e._id;return e.each((function(){var e=Eu(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)})),function(e){return Tu(e,r).value[t]}}function Ru(e,t){var n;return("number"==typeof t?Wc:t instanceof Ic?zc:(n=Ic(t))?(t=n,zc):Kc)(e,t)}function Pu(e){return function(){this.removeAttribute(e)}}function Au(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Lu(e,t,n){var r,i,o=n+"";return function(){var s=this.getAttribute(e);return s===o?null:s===r?i:i=t(r=s,n)}}function Ou(e,t,n){var r,i,o=n+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===r?i:i=t(r=s,n)}}function Du(e,t,n){var r,i,o;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttribute(e))===(a=l+"")?null:s===r&&a===i?o:(i=a,o=t(r=s,l));this.removeAttribute(e)}}function Fu(e,t,n){var r,i,o;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:s===r&&a===i?o:(i=a,o=t(r=s,l));this.removeAttributeNS(e.space,e.local)}}function qu(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function ju(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function zu(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&ju(e,i)),n}return i._value=t,i}function Bu(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&qu(e,i)),n}return i._value=t,i}function Hu(e,t){return function(){Su(this,e).delay=+t.apply(this,arguments)}}function Uu(e,t){return t=+t,function(){Su(this,e).delay=t}}function Wu(e,t){return function(){Eu(this,e).duration=+t.apply(this,arguments)}}function Vu(e,t){return t=+t,function(){Eu(this,e).duration=t}}function Gu(e,t){if("function"!=typeof t)throw new Error;return function(){Eu(this,e).ease=t}}function Yu(e,t,n){var r,i,o=function(e){return(e+"").trim().split(/^|\s+/).every((function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e}))}(t)?Su:Eu;return function(){var s=o(this,e),a=s.on;a!==r&&(i=(r=a).copy()).on(t,n),s.on=i}}var Ku=oc.prototype.constructor;function Zu(e){return function(){this.style.removeProperty(e)}}function Qu(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function Xu(e,t,n){var r,i;function o(){var o=t.apply(this,arguments);return o!==i&&(r=(i=o)&&Qu(e,o,n)),r}return o._value=t,o}function Ju(e){return function(t){this.textContent=e.call(this,t)}}function eh(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Ju(r)),t}return r._value=e,r}var th=0;function nh(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function rh(){return++th}var ih=oc.prototype;nh.prototype={constructor:nh,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=Ja(e));for(var r=this._groups,i=r.length,o=new Array(i),s=0;s<i;++s)for(var a,l,c=r[s],u=c.length,h=o[s]=new Array(u),d=0;d<u;++d)(a=c[d])&&(l=e.call(a,a.__data__,d,c))&&("__data__"in a&&(l.__data__=a.__data__),h[d]=l,Iu(h[d],t,n,d,h,Tu(a,n)));return new nh(o,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=nl(e));for(var r=this._groups,i=r.length,o=[],s=[],a=0;a<i;++a)for(var l,c=r[a],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var d,f=e.call(l,l.__data__,h,c),p=Tu(l,n),g=0,m=f.length;g<m;++g)(d=f[g])&&Iu(d,t,n,g,f,p);o.push(f),s.push(l)}return new nh(o,s,t,n)},selectChild:ih.selectChild,selectChildren:ih.selectChildren,filter:function(e){"function"!=typeof e&&(e=rl(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o,s=t[i],a=s.length,l=r[i]=[],c=0;c<a;++c)(o=s[c])&&e.call(o,o.__data__,c,s)&&l.push(o);return new nh(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,o=Math.min(r,i),s=new Array(r),a=0;a<o;++a)for(var l,c=t[a],u=n[a],h=c.length,d=s[a]=new Array(h),f=0;f<h;++f)(l=c[f]||u[f])&&(d[f]=l);for(;a<r;++a)s[a]=t[a];return new nh(s,this._parents,this._name,this._id)},selection:function(){return new Ku(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=rh(),r=this._groups,i=r.length,o=0;o<i;++o)for(var s,a=r[o],l=a.length,c=0;c<l;++c)if(s=a[c]){var u=Tu(s,t);Iu(s,e,n,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new nh(r,this._parents,e,n)},call:ih.call,nodes:ih.nodes,node:ih.node,size:ih.size,empty:ih.empty,each:ih.each,on:function(e,t){var n=this._id;return arguments.length<2?Tu(this.node(),n).on.on(e):this.each(Yu(n,e,t))},attr:function(e,t){var n=Ya(e),r="transform"===n?su:Ru;return this.attrTween(e,"function"==typeof t?(n.local?Fu:Du)(n,r,$u(this,"attr."+e,t)):null==t?(n.local?Au:Pu)(n):(n.local?Ou:Lu)(n,r,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var r=Ya(e);return this.tween(n,(r.local?zu:Bu)(r,t))},style:function(e,t,n){var r="transform"==(e+="")?ou:Ru;return null==t?this.styleTween(e,function(e,t){var n,r,i;return function(){var o=El(this,e),s=(this.style.removeProperty(e),El(this,e));return o===s?null:o===n&&s===r?i:i=t(n=o,r=s)}}(e,r)).on("end.style."+e,Zu(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var r,i,o;return function(){var s=El(this,e),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(e),l=a=El(this,e)),s===l?null:s===r&&l===i?o:(i=l,o=t(r=s,a))}}(e,r,$u(this,"style."+e,t))).each(function(e,t){var n,r,i,o,s="style."+t,a="end."+s;return function(){var l=Eu(this,e),c=l.on,u=null==l.value[s]?o||(o=Zu(t)):void 0;c===n&&i===u||(r=(n=c).copy()).on(a,i=u),l.on=r}}(this._id,e)):this.styleTween(e,function(e,t,n){var r,i,o=n+"";return function(){var s=El(this,e);return s===o?null:s===r?i:i=t(r=s,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,Xu(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}($u(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,eh(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,i=Tu(this.node(),n).tween,o=0,s=i.length;o<s;++o)if((r=i[o]).name===e)return r.value;return null}return this.each((null==t?Nu:Mu)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?Hu:Uu)(t,e)):Tu(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?Wu:Vu)(t,e)):Tu(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(Gu(t,e)):Tu(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Eu(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,r=n._id,i=n.size();return new Promise((function(o,s){var a={value:s},l={value:function(){0==--i&&o()}};n.each((function(){var n=Eu(this,r),i=n.on;i!==e&&((t=(e=i).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),n.on=t})),0===i&&o()}))},[Symbol.iterator]:ih[Symbol.iterator]};var oh={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function sh(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}oc.prototype.interrupt=function(e){return this.each((function(){!function(e,t){var n,r,i,o=e.__transition,s=!0;if(o){for(i in t=null==t?null:t+"",o)(n=o[i]).name===t?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete o[i]):s=!1;s&&delete e.__transition}}(this,e)}))},oc.prototype.transition=function(e){var t,n;e instanceof nh?(t=e._id,e=e._name):(t=rh(),(n=oh).time=gu(),e=null==e?null:e+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var s,a=r[o],l=a.length,c=0;c<l;++c)(s=a[c])&&Iu(s,e,t,c,a,n||sh(s,t));return new nh(r,this._parents,e,t)};var ah=Array.prototype.slice;function lh(e,t){return e-t}var ch=e=>()=>e;function uh(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=hh(e,t[r]))return n;return 0}function hh(e,t){for(var n=t[0],r=t[1],i=-1,o=0,s=e.length,a=s-1;o<s;a=o++){var l=e[o],c=l[0],u=l[1],h=e[a],d=h[0],f=h[1];if(dh(l,h,t))return 0;u>r!=f>r&&n<(d-c)*(r-u)/(f-u)+c&&(i=-i)}return i}function dh(e,t,n){var r,i,o,s;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(i=e[r=+(e[0]===t[0])],o=n[r],s=t[r],i<=o&&o<=s||s<=o&&o<=i)}function fh(){}var ph=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function gh(){var e=1,t=1,n=Fa,r=a;function i(e){var t=n(e);if(Array.isArray(t))t=t.slice().sort(lh);else{const n=function(e,t){let n,r;if(void 0===t)for(const t of e)null!=t&&(void 0===n?t>=t&&(n=r=t):(n>t&&(n=t),r<t&&(r=t)));else{let i=-1;for(let o of e)null!=(o=t(o,++i,e))&&(void 0===n?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}(e),r=Da(n[0],n[1],t);t=La(Math.floor(n[0]/r)*r,Math.floor(n[1]/r-1)*r,t)}return t.map((t=>o(e,t)))}function o(n,i){var o=[],a=[];return function(n,r,i){var o,a,l,c,u,h,d=new Array,f=new Array;o=a=-1,c=n[0]>=r,ph[c<<1].forEach(p);for(;++o<e-1;)l=c,c=n[o+1]>=r,ph[l|c<<1].forEach(p);ph[c<<0].forEach(p);for(;++a<t-1;){for(o=-1,c=n[a*e+e]>=r,u=n[a*e]>=r,ph[c<<1|u<<2].forEach(p);++o<e-1;)l=c,c=n[a*e+e+o+1]>=r,h=u,u=n[a*e+o+1]>=r,ph[l|c<<1|u<<2|h<<3].forEach(p);ph[c|u<<3].forEach(p)}o=-1,u=n[a*e]>=r,ph[u<<2].forEach(p);for(;++o<e-1;)h=u,u=n[a*e+o+1]>=r,ph[u<<2|h<<3].forEach(p);function p(e){var t,n,r=[e[0][0]+o,e[0][1]+a],l=[e[1][0]+o,e[1][1]+a],c=s(r),u=s(l);(t=f[c])?(n=d[u])?(delete f[t.end],delete d[n.start],t===n?(t.ring.push(l),i(t.ring)):d[t.start]=f[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete f[t.end],t.ring.push(l),f[t.end=u]=t):(t=d[u])?(n=f[c])?(delete d[t.start],delete f[n.end],t===n?(t.ring.push(l),i(t.ring)):d[n.start]=f[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete d[t.start],t.ring.unshift(r),d[t.start=c]=t):d[c]=f[u]={start:c,end:u,ring:[r,l]}}ph[u<<3].forEach(p)}(n,i,(function(e){r(e,n,i),function(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?o.push([e]):a.push(e)})),a.forEach((function(e){for(var t,n=0,r=o.length;n<r;++n)if(-1!==uh((t=o[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:i,coordinates:o}}function s(t){return 2*t[0]+t[1]*(e+1)*4}function a(n,r,i){n.forEach((function(n){var o,s=n[0],a=n[1],l=0|s,c=0|a,u=r[c*e+l];s>0&&s<e&&l===s&&(o=r[c*e+l-1],n[0]=s+(i-o)/(u-o)-.5),a>0&&a<t&&c===a&&(o=r[(c-1)*e+l],n[1]=a+(i-o)/(u-o)-.5)}))}return i.contour=o,i.size=function(n){if(!arguments.length)return[e,t];var r=Math.floor(n[0]),o=Math.floor(n[1]);if(!(r>=0&&o>=0))throw new Error("invalid size");return e=r,t=o,i},i.thresholds=function(e){return arguments.length?(n="function"==typeof e?e:Array.isArray(e)?ch(ah.call(e)):ch(e),i):n},i.smooth=function(e){return arguments.length?(r=e?a:fh,i):r===a},i}function mh(e,t,n){for(var r=e.width,i=e.height,o=1+(n<<1),s=0;s<i;++s)for(var a=0,l=0;a<r+n;++a)a<r&&(l+=e.data[a+s*r]),a>=n&&(a>=o&&(l-=e.data[a-o+s*r]),t.data[a-n+s*r]=l/Math.min(a+1,r-1+o-a,o))}function _h(e,t,n){for(var r=e.width,i=e.height,o=1+(n<<1),s=0;s<r;++s)for(var a=0,l=0;a<i+n;++a)a<i&&(l+=e.data[s+a*r]),a>=n&&(a>=o&&(l-=e.data[s+(a-o)*r]),t.data[s+(a-n)*r]=l/Math.min(a+1,i-1+o-a,o))}function vh(e){return e[0]}function yh(e){return e[1]}function wh(){return 1}function bh(){var e=vh,t=yh,n=wh,r=960,i=500,o=20,s=2,a=3*o,l=r+2*a>>s,c=i+2*a>>s,u=ch(20);function h(r){var i=new Float32Array(l*c),h=new Float32Array(l*c),f=Math.pow(2,-s);r.forEach((function(r,o,s){var u=(e(r,o,s)+a)*f,h=(t(r,o,s)+a)*f,d=+n(r,o,s);if(u>=0&&u<l&&h>=0&&h<c){var p=Math.floor(u),g=Math.floor(h),m=u-p-.5,_=h-g-.5;i[p+g*l]+=(1-m)*(1-_)*d,i[p+1+g*l]+=m*(1-_)*d,i[p+1+(g+1)*l]+=m*_*d,i[p+(g+1)*l]+=(1-m)*_*d}})),mh({width:l,height:c,data:i},{width:l,height:c,data:h},o>>s),_h({width:l,height:c,data:h},{width:l,height:c,data:i},o>>s),mh({width:l,height:c,data:i},{width:l,height:c,data:h},o>>s),_h({width:l,height:c,data:h},{width:l,height:c,data:i},o>>s),mh({width:l,height:c,data:i},{width:l,height:c,data:h},o>>s),_h({width:l,height:c,data:h},{width:l,height:c,data:i},o>>s);var p=u(i);if(!Array.isArray(p)){var g=qa(i);p=Da(0,g,p),p=function(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),o=new Array(i);++r<i;)o[r]=e+r*n;return o}(0,Math.floor(g/p)*p,p),p.shift()}return gh().thresholds(p).size([l,c])(i).map(d)}function d(e){return e.value*=Math.pow(2,-2*s),e.coordinates.forEach(f),e}function f(e){e.forEach(p)}function p(e){e.forEach(g)}function g(e){e[0]=e[0]*Math.pow(2,s)-a,e[1]=e[1]*Math.pow(2,s)-a}function m(){return l=r+2*(a=3*o)>>s,c=i+2*a>>s,h}return h.x=function(t){return arguments.length?(e="function"==typeof t?t:ch(+t),h):e},h.y=function(e){return arguments.length?(t="function"==typeof e?e:ch(+e),h):t},h.weight=function(e){return arguments.length?(n="function"==typeof e?e:ch(+e),h):n},h.size=function(e){if(!arguments.length)return[r,i];var t=+e[0],n=+e[1];if(!(t>=0&&n>=0))throw new Error("invalid size");return r=t,i=n,m()},h.cellSize=function(e){if(!arguments.length)return 1<<s;if(!((e=+e)>=1))throw new Error("invalid cell size");return s=Math.floor(Math.log(e)/Math.LN2),m()},h.thresholds=function(e){return arguments.length?(u="function"==typeof e?e:Array.isArray(e)?ch(ah.call(e)):ch(e),h):u},h.bandwidth=function(e){if(!arguments.length)return Math.sqrt(o*(o+1));if(!((e=+e)>=0))throw new Error("invalid bandwidth");return o=Math.round((Math.sqrt(4*e*e+1)-1)/2),m()},h}function Ch(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function xh(e){return(e=Ch(Math.abs(e)))?e[1]:NaN}var kh,Ih=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Sh(e){if(!(t=Ih.exec(e)))throw new Error("invalid format: "+e);var t;return new Eh({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Eh(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Th(e,t){var n=Ch(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Sh.prototype=Eh.prototype,Eh.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Nh={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Th(100*e,t),r:Th,s:function(e,t){var n=Ch(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(kh=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=r.length;return o===s?r:o>s?r+new Array(o-s+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Ch(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Mh(e){return e}var $h,Rh,Ph,Ah=Array.prototype.map,Lh=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Oh(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Mh:(t=Ah.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],s=0,a=t[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),o.push(e.substring(i-=a,i+a)),!((l+=a+1)>r));)a=t[s=(s+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?Mh:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Ah.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=Sh(e)).fill,n=e.align,h=e.sign,d=e.symbol,f=e.zero,p=e.width,g=e.comma,m=e.precision,_=e.trim,v=e.type;"n"===v?(g=!0,v="g"):Nh[v]||(void 0===m&&(m=12),_=!0,v="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var y="$"===d?i:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",w="$"===d?o:/[%p]/.test(v)?l:"",b=Nh[v],C=/[defgprs%]/.test(v);function x(e){var i,o,l,d=y,x=w;if("c"===v)x=b(e)+x,e="";else{var k=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:b(Math.abs(e),m),_&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),k&&0==+e&&"+"!==h&&(k=!1),d=(k?"("===h?h:c:"-"===h||"("===h?"":h)+d,x=("s"===v?Lh[8+kh/3]:"")+x+(k&&"("===h?")":""),C)for(i=-1,o=e.length;++i<o;)if(48>(l=e.charCodeAt(i))||l>57){x=(46===l?s+e.slice(i+1):e.slice(i))+x,e=e.slice(0,i);break}}g&&!f&&(e=r(e,1/0));var I=d.length+e.length+x.length,S=I<p?new Array(p-I+1).join(t):"";switch(g&&f&&(e=r(S+e,S.length?p-x.length:1/0),S=""),n){case"<":e=d+e+x+S;break;case"=":e=d+S+e+x;break;case"^":e=S.slice(0,I=S.length>>1)+d+e+x+S.slice(I);break;default:e=S+d+e+x}return a(e)}return m=void 0===m?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),x.toString=function(){return e+""},x}return{format:h,formatPrefix:function(e,t){var n=h(((e=Sh(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(xh(t)/3))),i=Math.pow(10,-r),o=Lh[8+r/3];return function(e){return n(i*e)+o}}}}$h=Oh({thousands:",",grouping:[3],currency:["$",""]}),Rh=$h.format,Ph=$h.formatPrefix;var Dh=2*Math.PI,Fh=Math.abs,qh=Math.sqrt;function jh(){}function zh(e,t){e&&Hh.hasOwnProperty(e.type)&&Hh[e.type](e,t)}var Bh={Feature:function(e,t){zh(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)zh(n[r].geometry,t)}},Hh={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Uh(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Uh(n[r],t,0)},Polygon:function(e,t){Wh(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Wh(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)zh(n[r],t)}};function Uh(e,t,n){var r,i=-1,o=e.length-n;for(t.lineStart();++i<o;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function Wh(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Uh(e[n],t,1);t.polygonEnd()}function Vh(e,t){e&&Bh.hasOwnProperty(e.type)?Bh[e.type](e,t):zh(e,t)}var Gh,Yh,Kh,Zh,Qh=e=>e,Xh=new $a,Jh=new $a,ed={point:jh,lineStart:jh,lineEnd:jh,polygonStart:function(){ed.lineStart=td,ed.lineEnd=id},polygonEnd:function(){ed.lineStart=ed.lineEnd=ed.point=jh,Xh.add(Fh(Jh)),Jh=new $a},result:function(){var e=Xh/2;return Xh=new $a,e}};function td(){ed.point=nd}function nd(e,t){ed.point=rd,Gh=Kh=e,Yh=Zh=t}function rd(e,t){Jh.add(Zh*e-Kh*t),Kh=e,Zh=t}function id(){rd(Gh,Yh)}var od=ed,sd=1/0,ad=sd,ld=-sd,cd=ld;var ud,hd,dd,fd,pd={point:function(e,t){e<sd&&(sd=e);e>ld&&(ld=e);t<ad&&(ad=t);t>cd&&(cd=t)},lineStart:jh,lineEnd:jh,polygonStart:jh,polygonEnd:jh,result:function(){var e=[[sd,ad],[ld,cd]];return ld=cd=-(ad=sd=1/0),e}},gd=0,md=0,_d=0,vd=0,yd=0,wd=0,bd=0,Cd=0,xd=0,kd={point:Id,lineStart:Sd,lineEnd:Nd,polygonStart:function(){kd.lineStart=Md,kd.lineEnd=$d},polygonEnd:function(){kd.point=Id,kd.lineStart=Sd,kd.lineEnd=Nd},result:function(){var e=xd?[bd/xd,Cd/xd]:wd?[vd/wd,yd/wd]:_d?[gd/_d,md/_d]:[NaN,NaN];return gd=md=_d=vd=yd=wd=bd=Cd=xd=0,e}};function Id(e,t){gd+=e,md+=t,++_d}function Sd(){kd.point=Ed}function Ed(e,t){kd.point=Td,Id(dd=e,fd=t)}function Td(e,t){var n=e-dd,r=t-fd,i=qh(n*n+r*r);vd+=i*(dd+e)/2,yd+=i*(fd+t)/2,wd+=i,Id(dd=e,fd=t)}function Nd(){kd.point=Id}function Md(){kd.point=Rd}function $d(){Pd(ud,hd)}function Rd(e,t){kd.point=Pd,Id(ud=dd=e,hd=fd=t)}function Pd(e,t){var n=e-dd,r=t-fd,i=qh(n*n+r*r);vd+=i*(dd+e)/2,yd+=i*(fd+t)/2,wd+=i,bd+=(i=fd*e-dd*t)*(dd+e),Cd+=i*(fd+t),xd+=3*i,Id(dd=e,fd=t)}var Ad=kd;function Ld(e){this._context=e}Ld.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Dh)}},result:jh};var Od,Dd,Fd,qd,jd,zd=new $a,Bd={point:jh,lineStart:function(){Bd.point=Hd},lineEnd:function(){Od&&Ud(Dd,Fd),Bd.point=jh},polygonStart:function(){Od=!0},polygonEnd:function(){Od=null},result:function(){var e=+zd;return zd=new $a,e}};function Hd(e,t){Bd.point=Ud,Dd=qd=e,Fd=jd=t}function Ud(e,t){qd-=e,jd-=t,zd.add(qh(qd*qd+jd*jd)),qd=e,jd=t}var Wd=Bd;function Vd(){this._string=[]}function Gd(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Yd(e,t){var n,r,i=4.5;function o(e){return e&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),Vh(e,n(r))),r.result()}return o.area=function(e){return Vh(e,n(od)),od.result()},o.measure=function(e){return Vh(e,n(Wd)),Wd.result()},o.bounds=function(e){return Vh(e,n(pd)),pd.result()},o.centroid=function(e){return Vh(e,n(Ad)),Ad.result()},o.projection=function(t){return arguments.length?(n=null==t?(e=null,Qh):(e=t).stream,o):e},o.context=function(e){return arguments.length?(r=null==e?(t=null,new Vd):new Ld(t=e),"function"!=typeof i&&r.pointRadius(i),o):t},o.pointRadius=function(e){return arguments.length?(i="function"==typeof e?e:(r.pointRadius(+e),+e),o):i},o.projection(e).context(t)}function Kd(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Zd(e){return+e}Vd.prototype={_radius:4.5,_circle:Gd(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=Gd(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var Qd=[0,1];function Xd(e){return e}function Jd(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function ef(e,t,n){var r=e[0],i=e[1],o=t[0],s=t[1];return i<r?(r=Jd(i,r),o=n(s,o)):(r=Jd(r,i),o=n(o,s)),function(e){return o(r(e))}}function tf(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),s=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<r;)i[s]=Jd(e[s],e[s+1]),o[s]=n(t[s],t[s+1]);return function(t){var n=Ma(e,t,1,r)-1;return o[n](i[n](t))}}function nf(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function rf(){var e,t,n,r,i,o,s=Qd,a=Qd,l=Zc,c=Xd;function u(){var e,t,n,l=Math.min(s.length,a.length);return c!==Xd&&(e=s[0],t=s[l-1],e>t&&(n=e,e=t,t=n),c=function(n){return Math.max(e,Math.min(t,n))}),r=l>2?tf:ef,i=o=null,h}function h(t){return null==t||isNaN(t=+t)?n:(i||(i=r(s.map(e),a,l)))(e(c(t)))}return h.invert=function(n){return c(t((o||(o=r(a,s.map(e),Wc)))(n)))},h.domain=function(e){return arguments.length?(s=Array.from(e,Zd),u()):s.slice()},h.range=function(e){return arguments.length?(a=Array.from(e),u()):a.slice()},h.rangeRound=function(e){return a=Array.from(e),l=Qc,u()},h.clamp=function(e){return arguments.length?(c=!!e||Xd,u()):c!==Xd},h.interpolate=function(e){return arguments.length?(l=e,u()):l},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,u()}}function of(){return rf()(Xd,Xd)}function sf(e,t,n,r){var i,o=Da(e,t,n);switch((r=Sh(null==r?",f":r)).type){case"s":var s=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(xh(t)/3)))-xh(Math.abs(e)))}(o,s))||(r.precision=i),Ph(r,s);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,xh(t)-xh(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-xh(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return Rh(r)}function af(e){var t=e.domain;return e.ticks=function(e){var n=t();return La(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return sf(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,o=t(),s=0,a=o.length-1,l=o[s],c=o[a],u=10;for(c<l&&(i=l,l=c,c=i,i=s,s=a,a=i);u-- >0;){if((i=Oa(l,c,n))===r)return o[s]=l,o[a]=c,t(o);if(i>0)l=Math.floor(l/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,c=Math.floor(c*i)/i}r=i}return e},e}function lf(){var e=of();return e.copy=function(){return nf(e,lf())},Kd.apply(e,arguments),af(e)}function cf(t){let n,r;return{c(){n=$("div"),r=R(t[2]),O(n,"class","tooltip svelte-5pu51w"),q(n,"top",t[0]+20+"px"),q(n,"left",t[1]+"px")},m(e,t){T(e,n,t),I(n,r)},p(e,[t]){4&t&&D(r,e[2]),1&t&&q(n,"top",e[0]+20+"px"),2&t&&q(n,"left",e[1]+"px")},i:e,o:e,d(e){e&&N(n)}}}function uf(e,t,n){let r,i,o;return d(e,ze,(e=>n(0,r=e))),d(e,je,(e=>n(1,i=e))),d(e,qe,(e=>n(2,o=e))),[r,i,o]}class hf extends Se{constructor(e){super(),Ie(this,e,uf,cf,a,{})}}function df(e,t,n){n||e||t?(Be.set(!0),je.set(e),ze.set(t),n&&qe.set(n)):Be.set(!1)}function ff(e){let t,n,r=e[1].outerHTML+"";return{c(){t=new B,n=A(),t.a=n},m(e,i){t.m(r,e,i),T(e,n,i)},p(e,n){2&n&&r!==(r=e[1].outerHTML+"")&&t.p(r)},d(e){e&&N(n),e&&t.d()}}}function pf(e){let t,n,r,i,o,s,a,l=e[1]&&e[2]&&ff(e);return{c(){t=$("div"),n=$("div"),n.innerHTML='<span class="material-icons-round svelte-1xr5p2b">close</span>',r=P(),l&&l.c(),O(n,"class","minimize clickable btn svelte-1xr5p2b"),O(t,"class","overlay svelte-1xr5p2b")},m(i,c){T(i,t,c),I(t,n),I(t,r),l&&l.m(t,null),o=!0,s||(a=L(n,"click",e[4]),s=!0)},p(e,[n]){e[1]&&e[2]?l?l.p(e,n):(l=ff(e),l.c(),l.m(t,null)):l&&(l.d(1),l=null)},i(e){o||(re((()=>{i||(i=ve(t,lt,{duration:100},!0)),i.run(1)})),o=!0)},o(e){i||(i=ve(t,lt,{duration:100},!1)),i.run(0),o=!1},d(e){e&&N(t),l&&l.d(),e&&i&&i.end(),s=!1,a()}}}function gf(e,t,n){let{imgHolder:r,width:i,fullScreen:o}=t,s=!1;i.includes("px")?(r.classList.add("widthAugment"),s=!0):(r.classList.add("htAugment"),s=!0),console.log("i aint there");return e.$$set=e=>{"imgHolder"in e&&n(1,r=e.imgHolder),"width"in e&&n(3,i=e.width),"fullScreen"in e&&n(0,o=e.fullScreen)},[o,r,s,i,()=>{n(0,o=!1)}]}class mf extends Se{constructor(e){super(),Ie(this,e,gf,pf,a,{imgHolder:1,width:3,fullScreen:0})}}function _f(e,t,n){const r=e.slice();return r[35]=t[n],r}function vf(e,t,n){const r=e.slice();return r[38]=t[n],r}function yf(e){let t,n,r,i;return n=new hf({}),{c(){t=$("div"),be(n.$$.fragment)},m(e,r){T(e,t,r),Ce(n,t,null),i=!0},i(e){i||(ge(n.$$.fragment,e),re((()=>{r||(r=ve(t,lt,{duration:50},!0)),r.run(1)})),i=!0)},o(e){me(n.$$.fragment,e),r||(r=ve(t,lt,{duration:50},!1)),r.run(0),i=!1},d(e){e&&N(t),xe(n),e&&r&&r.end()}}}function wf(e){let t,n,r;function i(t){e[20](t)}let o={width:e[13],imgHolder:e[2]};return void 0!==e[11]&&(o.fullScreen=e[11]),t=new mf({props:o}),X.push((()=>we(t,"fullScreen",i))),{c(){be(t.$$.fragment)},m(e,n){Ce(t,e,n),r=!0},p(e,r){const i={};8192&r[0]&&(i.width=e[13]),4&r[0]&&(i.imgHolder=e[2]),!n&&2048&r[0]&&(n=!0,i.fullScreen=e[11],ie((()=>n=!1))),t.$set(i)},i(e){r||(ge(t.$$.fragment,e),r=!0)},o(e){me(t.$$.fragment,e),r=!1},d(e){xe(t,e)}}}function bf(t){let n,r,i,o,s;return{c(){n=$("div"),n.innerHTML='<span class="material-icons-round svelte-jnjmt8">open_in_full</span>',O(n,"class","full-screen clickable btn svelte-jnjmt8")},m(e,r){T(e,n,r),i=!0,o||(s=L(n,"click",t[21]),o=!0)},p:e,i(e){i||(re((()=>{r||(r=ve(n,lt,{},!0)),r.run(1)})),i=!0)},o(e){r||(r=ve(n,lt,{},!1)),r.run(0),i=!1},d(e){e&&N(n),e&&r&&r.end(),o=!1,s()}}}function Cf(e){let t,n,r=e[10],i=[];for(let t=0;t<r.length;t+=1)i[t]=If(vf(e,r,t));const o=e=>me(i[e],1,1,(()=>{i[e]=null}));return{c(){for(let e=0;e<i.length;e+=1)i[e].c();t=A()},m(e,r){for(let t=0;t<i.length;t+=1)i[t].m(e,r);T(e,t,r),n=!0},p(e,n){if(1024&n[0]){let s;for(r=e[10],s=0;s<r.length;s+=1){const o=vf(e,r,s);i[s]?(i[s].p(o,n),ge(i[s],1)):(i[s]=If(o),i[s].c(),ge(i[s],1),i[s].m(t.parentNode,t))}for(fe(),s=r.length;s<i.length;s+=1)o(s);pe()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)ge(i[e]);n=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)me(i[e]);n=!1},d(e){M(i,e),e&&N(t)}}}function xf(e){let t;return{c(){t=R("comment")},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function kf(e){let t;return{c(){t=R("emoji_emotions")},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function If(e){let t,n,r,i,s,a,l,c;function u(e,t){return e[38].emoji?kf:e[38].text?xf:void 0}let h=u(e),d=h&&h(e);function f(...t){return e[22](e[38],...t)}return{c(){t=$("div"),n=$("div"),r=$("span"),d&&d.c(),i=P(),O(r,"class","material-icons-round md-18 nav"),q(r,"font-size","20px"),q(r,"color","white"),O(n,"class","reaction-pin-inner"),O(t,"class","reaction-pin svelte-jnjmt8"),q(t,"left",100*e[38].xPct+"%"),q(t,"top",100*e[38].yPct+"%")},m(o,s){T(o,t,s),I(t,n),I(n,r),d&&d.m(r,null),I(t,i),a=!0,l||(c=[L(t,"mouseover",f),L(t,"mousemove",e[23]),L(t,"mouseleave",e[24])],l=!0)},p(n,i){h!==(h=u(e=n))&&(d&&d.d(1),d=h&&h(e),d&&(d.c(),d.m(r,null))),(!a||1024&i[0])&&q(t,"left",100*e[38].xPct+"%"),(!a||1024&i[0])&&q(t,"top",100*e[38].yPct+"%")},i(e){a||(re((()=>{s||(s=ve(t,lt,{duration:300},!0)),s.run(1)})),a=!0)},o(e){s||(s=ve(t,lt,{duration:300},!1)),s.run(0),a=!1},d(e){e&&N(t),d&&d.d(),e&&s&&s.end(),l=!1,o(c)}}}function Sf(e){let t,n,r,i,s,a,l,c;return{c(){t=$("div"),t.innerHTML='<span class="material-icons-round svelte-jnjmt8">arrow_left</span>',r=P(),i=$("div"),i.innerHTML='<span class="material-icons-round svelte-jnjmt8">arrow_right</span>',O(t,"class","personToggle prev clickable svelte-jnjmt8"),z(t,"disabled",0==e[1]),O(i,"class","personToggle next clickable svelte-jnjmt8"),z(i,"disabled",e[1]==e[8]-1)},m(n,o){T(n,t,o),T(n,r,o),T(n,i,o),a=!0,l||(c=[L(t,"click",e[25]),L(i,"click",e[26])],l=!0)},p(e,n){2&n[0]&&z(t,"disabled",0==e[1]),258&n[0]&&z(i,"disabled",e[1]==e[8]-1)},i(e){a||(re((()=>{n||(n=ve(t,lt,{},!0)),n.run(1)})),re((()=>{s||(s=ve(i,lt,{},!0)),s.run(1)})),a=!0)},o(e){n||(n=ve(t,lt,{},!1)),n.run(0),s||(s=ve(i,lt,{},!1)),s.run(0),a=!1},d(e){e&&N(t),e&&n&&n.end(),e&&N(r),e&&N(i),e&&s&&s.end(),l=!1,o(c)}}}function Ef(e){let t,n=e[7],r=[];for(let t=0;t<n.length;t+=1)r[t]=Tf(_f(e,n,t));return{c(){t=$("div");for(let e=0;e<r.length;e+=1)r[e].c()},m(n,i){T(n,t,i);for(let e=0;e<r.length;e+=1)r[e].m(t,null);e[29](t)},p(e,i){if(160&i[0]){let o;for(n=e[7],o=0;o<n.length;o+=1){const s=_f(e,n,o);r[o]?r[o].p(s,i):(r[o]=Tf(s),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(n){n&&N(t),M(r,n),e[29](null)}}}function Tf(e){let t,n;return{c(){t=$("img"),O(t,"class","clip svelte-jnjmt8"),q(t,"clip-path","circle("+e[35].r+"% at "+e[35].ctrx+"% "+e[35].ctry+"%)"),q(t,"filter","blur("+e[35].blur+"px)"),q(t,"opacity","$"+e[35].opacity),c(t.src,n=e[5].url)||O(t,"src",n)},m(e,n){T(e,t,n)},p(e,r){128&r[0]&&q(t,"clip-path","circle("+e[35].r+"% at "+e[35].ctrx+"% "+e[35].ctry+"%)"),128&r[0]&&q(t,"filter","blur("+e[35].blur+"px)"),128&r[0]&&q(t,"opacity","$"+e[35].opacity),32&r[0]&&!c(t.src,n=e[5].url)&&O(t,"src",n)},d(e){e&&N(t)}}}function Nf(e){let t,n,r,i,o,s,a,l,u,h,d,f,p,g,m,_=e[16]&&yf(),v=e[11]&&wf(e),y="aggregate"==e[6]&&bf(e),w=e[10]&&e[9]&&Cf(e),b=!e[12]&&"original"!==e[6]&&Sf(e),C="slice"==e[6]&&Ef(e);return{c(){_&&_.c(),t=P(),v&&v.c(),n=P(),r=$("div"),y&&y.c(),i=P(),w&&w.c(),o=P(),b&&b.c(),s=P(),a=$("img"),u=P(),h=function(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}("svg"),f=P(),C&&C.c(),c(a.src,l=e[5].url)||O(a,"src",l),O(a,"style",e[15]),O(a,"class","main svelte-jnjmt8"),z(a,"slice","slice"==e[6]),z(a,"agg","aggregate"==e[6]),O(h,"class","contour svelte-jnjmt8"),O(h,"id",d=e[5].key+"-contour"),q(h,"width","100%"),q(h,"height","100%"),q(h,"position","absolute"),q(h,"top","0"),q(h,"left","0"),q(h,"z-index","10"),z(h,"active","aggregate"==e[6]||"point"==e[6]),O(r,"class","img-holder swipe-holder svelte-jnjmt8"),q(r,"width",e[13]),q(r,"height",e[14]),q(r,"max-width",e[5].width+"px"),q(r,"max-height",e[5].height+"px")},m(l,c){_&&_.m(l,c),T(l,t,c),v&&v.m(l,c),T(l,n,c),T(l,r,c),y&&y.m(r,null),I(r,i),w&&w.m(r,null),I(r,o),b&&b.m(r,null),I(r,s),I(r,a),I(r,u),I(r,h),e[28](h),I(r,f),C&&C.m(r,null),e[30](r),p=!0,g||(m=L(a,"load",e[27]),g=!0)},p(e,u){e[16]?_?65536&u[0]&&ge(_,1):(_=yf(),_.c(),ge(_,1),_.m(t.parentNode,t)):_&&(fe(),me(_,1,1,(()=>{_=null})),pe()),e[11]?v?(v.p(e,u),2048&u[0]&&ge(v,1)):(v=wf(e),v.c(),ge(v,1),v.m(n.parentNode,n)):v&&(fe(),me(v,1,1,(()=>{v=null})),pe()),"aggregate"==e[6]?y?(y.p(e,u),64&u[0]&&ge(y,1)):(y=bf(e),y.c(),ge(y,1),y.m(r,i)):y&&(fe(),me(y,1,1,(()=>{y=null})),pe()),e[10]&&e[9]?w?(w.p(e,u),1536&u[0]&&ge(w,1)):(w=Cf(e),w.c(),ge(w,1),w.m(r,o)):w&&(fe(),me(w,1,1,(()=>{w=null})),pe()),e[12]||"original"===e[6]?b&&(fe(),me(b,1,1,(()=>{b=null})),pe()):b?(b.p(e,u),4160&u[0]&&ge(b,1)):(b=Sf(e),b.c(),ge(b,1),b.m(r,s)),(!p||32&u[0]&&!c(a.src,l=e[5].url))&&O(a,"src",l),(!p||32768&u[0])&&O(a,"style",e[15]),64&u[0]&&z(a,"slice","slice"==e[6]),64&u[0]&&z(a,"agg","aggregate"==e[6]),(!p||32&u[0]&&d!==(d=e[5].key+"-contour"))&&O(h,"id",d),64&u[0]&&z(h,"active","aggregate"==e[6]||"point"==e[6]),"slice"==e[6]?C?C.p(e,u):(C=Ef(e),C.c(),C.m(r,null)):C&&(C.d(1),C=null),(!p||8192&u[0])&&q(r,"width",e[13]),(!p||16384&u[0])&&q(r,"height",e[14]),(!p||32&u[0])&&q(r,"max-width",e[5].width+"px"),(!p||32&u[0])&&q(r,"max-height",e[5].height+"px")},i(e){p||(ge(_),ge(v),ge(y),ge(w),ge(b),p=!0)},o(e){me(_),me(v),me(y),me(w),me(b),p=!1},d(i){_&&_.d(i),i&&N(t),v&&v.d(i),i&&N(n),i&&N(r),y&&y.d(),w&&w.d(),b&&b.d(),e[28](null),C&&C.d(),e[30](null),g=!1,m()}}}function Mf(e,t,n){let r,i,o;d(e,Pe,(e=>n(31,r=e))),d(e,Re,(e=>n(19,i=e))),d(e,Be,(e=>n(16,o=e)));let{data:s}=t,{visViewMode:a}=t,{clips:l,clipHolder:c}=t,{imgFrame:u}=t,{sessionIndex:h,personLength:f}=t,{visViewReactions:p}=t,{sessionReactions:g}=t,{imgHolder:m}=t,{svgHolder:_}=t,{imgLoaded:v=!1}=t,y=!1,w=!1,b=s.width/s.height,C=Math.min(i,1050),x=r-180,k="auto",I="auto",S="";return e.$$set=e=>{"data"in e&&n(5,s=e.data),"visViewMode"in e&&n(6,a=e.visViewMode),"clips"in e&&n(7,l=e.clips),"clipHolder"in e&&n(0,c=e.clipHolder),"imgFrame"in e&&n(17,u=e.imgFrame),"sessionIndex"in e&&n(1,h=e.sessionIndex),"personLength"in e&&n(8,f=e.personLength),"visViewReactions"in e&&n(9,p=e.visViewReactions),"sessionReactions"in e&&n(10,g=e.sessionReactions),"imgHolder"in e&&n(2,m=e.imgHolder),"svgHolder"in e&&n(3,_=e.svgHolder),"imgLoaded"in e&&n(4,v=e.imgLoaded)},e.$$.update=()=>{524288&e.$$.dirty[0]&&i<=800&&n(12,w=!0),e.$$.dirty[0],393248&e.$$.dirty[0]&&u&&(n(18,C=Math.min(C,u.getBoundingClientRect().width)),b<1?(n(14,I=Math.min(x,s.height/s.width*C)+"px"),n(15,S="height: 100%")):(n(13,k=Math.min(C,x*(s.width/s.height))+"px"),n(15,S="width: 100%")))},[c,h,m,_,v,s,a,l,f,p,g,y,w,k,I,S,o,u,C,i,function(e){y=e,n(11,y)},()=>{n(11,y=!0)},(e,t)=>{let n="";n=e.text?e.text:e.emoji.toString().replace(","," "),df(t.x,t.y,n)},e=>{df(e.x,e.y)},e=>{df()},()=>{n(1,h--,h)},()=>{n(1,h++,h)},()=>{n(4,v=!0)},function(e){X[e?"unshift":"push"]((()=>{_=e,n(3,_)}))},function(e){X[e?"unshift":"push"]((()=>{c=e,n(0,c)}))},function(e){X[e?"unshift":"push"]((()=>{m=e,n(2,m)}))}]}class $f extends Se{constructor(e){super(),Ie(this,e,Mf,Nf,a,{data:5,visViewMode:6,clips:7,clipHolder:0,imgFrame:17,sessionIndex:1,personLength:8,visViewReactions:9,sessionReactions:10,imgHolder:2,svgHolder:3,imgLoaded:4},null,[-1,-1])}}var Rf="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Pf(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.')}
/*!
        localForage -- Offline Storage, Improved
        Version 1.10.0
        https://localforage.github.io/localForage
        (c) 2013-2017 Mozilla, Apache License 2.0
    */var Af,Lf,Of=(Af=function(e,t){e.exports=function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){if(!a&&Pf)return Pf(s);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,(function(e){var n=t[s][1][e];return i(n||e)}),c,c.exports,e,t,n,r)}return n[s].exports}for(var o=Pf,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){(function(e){var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,s=new i(u),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;r=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}r=!1}function h(e){1!==c.push(e)||r||n()}t.exports=h}).call(this,void 0!==Rf?Rf:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function i(){}var o={},s=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return o.reject(e,t)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function i(t){n||(n=!0,o.resolve(e,t))}function s(){t(i,r)}var a=p(s);"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function g(e){return e instanceof this?e:o.resolve(new this(i),e)}function m(e){var t=new this(i);return o.reject(t,e)}function _(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var s=new Array(n),a=0,l=-1,c=new this(i);++l<n;)u(e[l],l);return c;function u(e,i){function l(e){s[i]=e,++a!==n||r||(r=!0,o.resolve(c,s))}t.resolve(e).then(l,(function(e){r||(r=!0,o.reject(c,e))}))}}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var s=-1,a=new this(i);++s<n;)l(e[s]);return a;function l(e){t.resolve(e).then((function(e){r||(r=!0,o.resolve(a,e))}),(function(e){r||(r=!0,o.reject(a,e))}))}}t.exports=c,c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var n=new this.constructor(i);return this.state!==l?h(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(d,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=s,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},c.resolve=g,c.reject=m,c.all=_,c.race=v},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==Rf?Rf:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var s=o();function a(){try{if(!s||!s.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function l(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var c=Promise;function u(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function h(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function d(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",g=void 0,m={},_=Object.prototype.toString,v="readonly",y="readwrite";function w(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function b(e){return new c((function(t){var n=e.transaction(p,y),r=l([""]);n.objectStore(p).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function C(e){return"boolean"==typeof g?c.resolve(g):b(e).then((function(e){return g=e}))}function x(e){var t=m[e.name],n={};n.promise=new c((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function k(e){var t=m[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function I(e,t){var n=m[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function S(e,t){return new c((function(n,r){if(m[e.name]=m[e.name]||O(),e.db){if(!t)return n(e.db);x(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var o=s.open.apply(s,i);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(p)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),r(o.error)},o.onsuccess=function(){var t=o.result;t.onversionchange=function(e){e.target.close()},n(t),k(e)}}))}function E(e){return S(e,!1)}function T(e){return S(e,!0)}function N(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function M(e){return new c((function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)}))}function $(e){return l([w(atob(e.data))],{type:e.type})}function R(e){return e&&e.__local_forage_encoded_blob}function P(e){var t=this,n=t._initReady().then((function(){var e=m[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return h(n,e,e),n}function A(e){x(e);for(var t=m[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,E(e).then((function(t){return e.db=t,N(e)?T(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw I(e,t),t}))}function L(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return c.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),T(e)})).then((function(){return A(e).then((function(){L(e,t,n,r-1)}))})).catch(n);n(i)}}function O(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function D(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=m[n.name];i||(i=O(),m[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=P);var o=[];function s(){return c.resolve()}for(var a=0;a<i.forages.length;a++){var l=i.forages[a];l!==t&&o.push(l._initReady().catch(s))}var u=i.forages.slice(0);return c.all(o).then((function(){return n.db=i.db,E(n)})).then((function(e){return n.db=e,N(n,t._defaultConfig.version)?T(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var o=u[r];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))}function F(e,t){var n=this;e=d(e);var r=new c((function(t,r){n.ready().then((function(){L(n._dbInfo,v,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).get(e);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),R(e)&&(e=$(e)),t(e)},s.onerror=function(){r(s.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function q(e,t){var n=this,r=new c((function(t,r){n.ready().then((function(){L(n._dbInfo,v,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).openCursor(),a=1;s.onsuccess=function(){var n=s.result;if(n){var r=n.value;R(r)&&(r=$(r));var i=e(r,n.key,a++);void 0!==i?t(i):n.continue()}else t()},s.onerror=function(){r(s.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function j(e,t,n){var r=this;e=d(e);var i=new c((function(n,i){var o;r.ready().then((function(){return o=r._dbInfo,"[object Blob]"===_.call(t)?C(o.db).then((function(e){return e?t:M(t)})):t})).then((function(t){L(r._dbInfo,y,(function(o,s){if(o)return i(o);try{var a=s.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var l=a.put(t,e);s.oncomplete=function(){void 0===t&&(t=null),n(t)},s.onabort=s.onerror=function(){var e=l.error?l.error:l.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return u(i,n),i}function z(e,t){var n=this;e=d(e);var r=new c((function(t,r){n.ready().then((function(){L(n._dbInfo,y,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){r(s.error)},o.onabort=function(){var e=s.error?s.error:s.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function B(e){var t=this,n=new c((function(e,n){t.ready().then((function(){L(t._dbInfo,y,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function H(e){var t=this,n=new c((function(e,n){t.ready().then((function(){L(t._dbInfo,v,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function U(e,t){var n=this,r=new c((function(t,r){e<0?t(null):n.ready().then((function(){L(n._dbInfo,v,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName),a=!1,l=s.openKeyCursor();l.onsuccess=function(){var n=l.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},l.onerror=function(){r(l.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function W(e){var t=this,n=new c((function(e,n){t.ready().then((function(){L(t._dbInfo,v,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).openKeyCursor(),s=[];o.onsuccess=function(){var t=o.result;t?(s.push(t.key),t.continue()):e(s)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function V(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;if(e.name){var o=e.name===n.name&&i._dbInfo.db?c.resolve(i._dbInfo.db):E(e).then((function(t){var n=m[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));r=e.storeName?o.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;x(e);var r=m[e.name],i=r.forages;t.close();for(var o=0;o<i.length;o++){var a=i[o];a._dbInfo.db=null,a._dbInfo.version=n}var l=new c((function(t,r){var i=s.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}));return l.then((function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,k(n._dbInfo)}})).catch((function(t){throw(I(e,t)||c.resolve()).catch((function(){})),t}))}})):o.then((function(t){x(e);var n=m[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;var o=new c((function(t,n){var r=s.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}));return o.then((function(e){n.db=e;for(var t=0;t<r.length;t++)k(r[t]._dbInfo)})).catch((function(t){throw(I(e,t)||c.resolve()).catch((function(){})),t}))}))}else r=c.reject("Invalid arguments");return u(r,t),r}var G={_driver:"asyncStorage",_initStorage:D,_support:a(),iterate:q,getItem:F,setItem:j,removeItem:z,clear:B,length:H,key:U,keys:W,dropInstance:V};function Y(){return"function"==typeof openDatabase}var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Z="~~local_forage_type~",Q=/^~~local_forage_type~([^~]+)~/,X="__lfsc__:",J=X.length,ee="arbf",te="blob",ne="si08",re="ui08",ie="uic8",oe="si16",se="si32",ae="ur16",le="ui32",ce="fl32",ue="fl64",he=J+ee.length,de=Object.prototype.toString;function fe(e){var t,n,r,i,o,s=.75*e.length,a=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var c=new ArrayBuffer(s),u=new Uint8Array(c);for(t=0;t<a;t+=4)n=K.indexOf(e[t]),r=K.indexOf(e[t+1]),i=K.indexOf(e[t+2]),o=K.indexOf(e[t+3]),u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|i>>2,u[l++]=(3&i)<<6|63&o;return c}function pe(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=K[n[t]>>2],r+=K[(3&n[t])<<4|n[t+1]>>4],r+=K[(15&n[t+1])<<2|n[t+2]>>6],r+=K[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function ge(e,t){var n="";if(e&&(n=de.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===de.call(e.buffer))){var r,i=X;e instanceof ArrayBuffer?(r=e,i+=ee):(r=e.buffer,"[object Int8Array]"===n?i+=ne:"[object Uint8Array]"===n?i+=re:"[object Uint8ClampedArray]"===n?i+=ie:"[object Int16Array]"===n?i+=oe:"[object Uint16Array]"===n?i+=ae:"[object Int32Array]"===n?i+=se:"[object Uint32Array]"===n?i+=le:"[object Float32Array]"===n?i+=ce:"[object Float64Array]"===n?i+=ue:t(new Error("Failed to get type for BinaryArray"))),t(i+pe(r))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n=Z+e.type+"~"+pe(this.result);t(X+te+n)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function me(e){if(e.substring(0,J)!==X)return JSON.parse(e);var t,n=e.substring(he),r=e.substring(J,he);if(r===te&&Q.test(n)){var i=n.match(Q);t=i[1],n=n.substring(i[0].length)}var o=fe(n);switch(r){case ee:return o;case te:return l([o],{type:t});case ne:return new Int8Array(o);case re:return new Uint8Array(o);case ie:return new Uint8ClampedArray(o);case oe:return new Int16Array(o);case ae:return new Uint16Array(o);case se:return new Int32Array(o);case le:return new Uint32Array(o);case ce:return new Float32Array(o);case ue:return new Float64Array(o);default:throw new Error("Unkown type: "+r)}}var _e={serialize:ge,deserialize:me,stringToBuffer:fe,bufferToString:pe};function ve(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function ye(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new c((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){ve(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=_e,i}function we(e,t,n,r,i,o){e.executeSql(n,r,i,(function(e,s){s.code===s.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?o(e,s):ve(e,t,(function(){e.executeSql(n,r,i,o)}),o)}),o):o(e,s)}),o)}function be(e,t){var n=this;e=d(e);var r=new c((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){we(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Ce(e,t){var n=this,r=new c((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){we(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var o=r.rows,s=o.length,a=0;a<s;a++){var l=o.item(a),c=l.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=e(c,l.key,a+1)))return void t(c)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function xe(e,t,n,r){var i=this;e=d(e);var o=new c((function(o,s){i.ready().then((function(){void 0===t&&(t=null);var a=t,l=i._dbInfo;l.serializer.serialize(t,(function(t,c){c?s(c):l.db.transaction((function(n){we(n,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(a)}),(function(e,t){s(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void o(xe.apply(i,[e,a,n,r-1]));s(t)}}))}))})).catch(s)}));return u(o,n),o}function ke(e,t,n){return xe.apply(this,[e,t,n,1])}function Ie(e,t){var n=this;e=d(e);var r=new c((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){we(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Se(e){var t=this,n=new c((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){we(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Ee(e){var t=this,n=new c((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){we(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Te(e,t){var n=this,r=new c((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){we(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Ne(e){var t=this,n=new c((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){we(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Me(e){return new c((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],o=0;o<r.rows.length;o++)i.push(r.rows.item(o).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function $e(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return r=e.name?new c((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(Me(r))})).then((function(e){return new c((function(t,n){e.db.transaction((function(r){function i(e){return new c((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var o=[],s=0,a=e.storeNames.length;s<a;s++)o.push(i(e.storeNames[s]));c.all(o).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):c.reject("Invalid arguments"),u(r,t),r}var Re={_driver:"webSQLStorage",_initStorage:ye,_support:Y(),iterate:Ce,getItem:be,setItem:ke,removeItem:Ie,clear:Se,length:Ee,key:Te,keys:Ne,dropInstance:$e};function Pe(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Ae(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Le(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function Oe(){return!Le()||localStorage.length>0}function De(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=Ae(e,t._defaultConfig),Oe()?(t._dbInfo=n,n.serializer=_e,c.resolve()):c.reject()}function Fe(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return u(n,e),n}function qe(e,t){var n=this;e=d(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return u(r,t),r}function je(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,o=localStorage.length,s=1,a=0;a<o;a++){var l=localStorage.key(a);if(0===l.indexOf(r)){var c=localStorage.getItem(l);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,l.substring(i),s++)))return c}}}));return u(r,t),r}function ze(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return u(r,t),r}function Be(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var o=localStorage.key(i);0===o.indexOf(e.keyPrefix)&&r.push(o.substring(e.keyPrefix.length))}return r}));return u(n,e),n}function He(e){var t=this.keys().then((function(e){return e.length}));return u(t,e),t}function Ue(e,t){var n=this;e=d(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return u(r,t),r}function We(e,t,n){var r=this;e=d(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new c((function(i,o){var s=r._dbInfo;s.serializer.serialize(t,(function(t,r){if(r)o(r);else try{localStorage.setItem(s.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return u(i,n),i}function Ve(e,t){if(t=f.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return r=e.name?new c((function(t){e.storeName?t(Ae(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):c.reject("Invalid arguments"),u(r,t),r}var Ge={_driver:"localStorageWrapper",_initStorage:De,_support:Pe(),iterate:je,getItem:qe,setItem:We,removeItem:Ue,clear:Fe,length:He,key:ze,keys:Be,dropInstance:Ve},Ye=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Ke=function(e,t){for(var n=e.length,r=0;r<n;){if(Ye(e[r],t))return!0;r++}return!1},Ze=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Qe={},Xe={},Je={INDEXEDDB:G,WEBSQL:Re,LOCALSTORAGE:Ge},et=[Je.INDEXEDDB._driver,Je.WEBSQL._driver,Je.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),rt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function ot(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Ze(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var st=function(){function e(t){for(var n in i(this,e),Je)if(Je.hasOwnProperty(n)){var r=Je[n],o=r._driver;this[n]=o,Qe[o]||this.defineDriver(r)}this._defaultConfig=ot({},rt),this._config=ot({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new c((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var o=nt.concat("_initStorage"),s=0,a=o.length;s<a;s++){var l=o[s];if((!Ke(tt,l)||e[l])&&"function"!=typeof e[l])return void n(i)}var h=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=c.reject(t);return u(n,arguments[arguments.length-1]),n}},n=0,r=tt.length;n<r;n++){var i=tt[n];e[i]||(e[i]=t(i))}};h();var d=function(n){Qe[r]&&console.info("Redefining LocalForage driver: "+r),Qe[r]=e,Xe[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,n):d(!!e._support):d(!0)}catch(e){n(e)}}));return h(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=Qe[e]?c.resolve(Qe[e]):c.reject(new Error("Driver not found."));return h(r,t,n),r},e.prototype.getSerializer=function(e){var t=c.resolve(_e);return h(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return h(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;Ze(e)||(e=[e]);var i=this._getSupportedDrivers(e);function o(){r._config.driver=r.driver()}function s(e){return r._extend(e),o(),r._ready=r._initStorage(r._config),r._ready}function a(e){return function(){var t=0;function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(s).catch(n)}o();var a=new Error("No available storage method found.");return r._driverSet=c.reject(a),r._driverSet}return n()}}var l=null!==this._driverSet?this._driverSet.catch((function(){return c.resolve()})):c.resolve();return this._driverSet=l.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,o(),r._wrapLibraryMethodsWithReady(),r._initDriver=a(i)}))})).catch((function(){o();var e=new Error("No available storage method found.");return r._driverSet=c.reject(e),r._driverSet})),h(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Xe[e]},e.prototype._extend=function(e){ot(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=nt.length;e<t;e++)it(this,nt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),at=new st;t.exports=at},{3:3}]},{},[4])(4)},Af(Lf={exports:{}},Lf.exports),Lf.exports);async function Df(){let e=await document.querySelector("#webgazerVideoContainer");return await document.querySelector("body").append(e),await webgazer.pause(),await webgazer.showVideo(!1)}async function Ff(){if(webgazer.isReady()){console.log("gazer fully loaded"),webgazer.pause(),webgazer.setVideoViewerSize(300,300);let e=document.querySelector("#webgazerVideoContainer");document.querySelector(".container-body").append(e),Ze.set(!0),console.log("gazer initialized")}else await setTimeout(Ff,100)}function qf(){document.querySelector("#webgazerGazeDot").style.opacity=0}function jf(){webgazer.setGazeListener((function(e,t){if(null==e)return;let n=h(Ve);n.push({x:e.x,y:e.y}),Ve.set(n)})),setTimeout((()=>{webgazer.clearGazeListener(),function(){let e=document.querySelector(".center-dot").getBoundingClientRect(),t=0,n=h(Ve);n.map((n=>{let r=n.x-e.x+e.width/2,i=n.y-e.y+e.height/2,o=Math.sqrt(i*i+r*r);return t+=o,o}));let r=100*(1-t/n.length/(document.querySelector(".container-body").getBoundingClientRect().width/2));console.log(r),Of.setItem("calibrationPct",Math.round(r)),Je.set(Math.round(r))}()}),4e3)}function zf(){webgazer.removeMouseEventListeners()}function Bf(t){let n,r,i;return{c(){n=$("div"),n.innerHTML="<span>Close</span>",O(n,"class","clickable svelte-sx2tzr")},m(e,o){T(e,n,o),r||(i=L(n,"click",t[5]),r=!0)},p:e,d(e){e&&N(n),r=!1,i()}}}function Hf(t){let n,r,i;return{c(){n=$("div"),n.innerHTML='<span>Next</span> \n        <span class="material-icons-round svelte-sx2tzr">navigate_next</span>',O(n,"class","clickable svelte-sx2tzr")},m(e,o){T(e,n,o),r||(i=L(n,"click",t[4]),r=!0)},p:e,d(e){e&&N(n),r=!1,i()}}}function Uf(t){let n,r,i,o,s,a,l,c,u,h,d,f,p,g,m,_,v=t[2][t[0]]+"",y=t[0]+1+"",w=t[2].length+"";function b(e,t){return e[0]<e[2].length-1?Hf:Bf}let C=b(t),x=C(t);return{c(){n=$("div"),r=$("div"),i=$("p"),o=R(v),s=P(),a=$("nav"),l=$("div"),l.innerHTML='<span class="material-icons-round svelte-sx2tzr">navigate_before</span> \n      <span>Prev</span>',c=P(),u=$("div"),h=R("Tip "),d=R(y),f=R(" of "),p=R(w),g=P(),x.c(),O(r,"class","text-upper svelte-sx2tzr"),O(l,"class","clickable svelte-sx2tzr"),z(l,"disabled",0==t[0]),O(a,"class","svelte-sx2tzr"),O(n,"class","hint-holder svelte-sx2tzr"),q(n,"top",t[1][t[0]][1]+"px"),q(n,"left",t[1][t[0]][0]+"px"),z(n,"initPos",0==t[0])},m(e,v){T(e,n,v),I(n,r),I(r,i),I(i,o),I(n,s),I(n,a),I(a,l),I(a,c),I(a,u),I(u,h),I(u,d),I(u,f),I(u,p),I(a,g),x.m(a,null),m||(_=L(l,"click",t[3]),m=!0)},p(e,[t]){1&t&&v!==(v=e[2][e[0]]+"")&&D(o,v),1&t&&z(l,"disabled",0==e[0]),1&t&&y!==(y=e[0]+1+"")&&D(d,y),C===(C=b(e))&&x?x.p(e,t):(x.d(1),x=C(e),x&&(x.c(),x.m(a,null))),3&t&&q(n,"top",e[1][e[0]][1]+"px"),3&t&&q(n,"left",e[1][e[0]][0]+"px"),1&t&&z(n,"initPos",0==e[0])},i:e,o:e,d(e){e&&N(n),x.d(),m=!1,_()}}}function Wf(e,t,n){let{infoTipIndex:r}=t,{helperTextPositions:i}=t;return e.$$set=e=>{"infoTipIndex"in e&&n(0,r=e.infoTipIndex),"helperTextPositions"in e&&n(1,i=e.helperTextPositions)},[r,i,["Were currently visualizing a single gaze. Use the arrows or name to switch between different viewers' gazes.","Filter between different views above. The animate option allows you to play back a viewing session, while aggregate shows a single static summary. And lastly, original shows the original image, sans gaze.","Are you curious to see what your own gaze would look like? Contribute to the gallery and add your own gaze!"],()=>{n(0,r--,r)},()=>{n(0,r++,r)},()=>{n(0,r=-1)}]}class Vf extends Se{constructor(e){super(),Ie(this,e,Wf,Uf,a,{infoTipIndex:0,helperTextPositions:1})}}function Gf(e){let t;return{c(){t=$("span"),t.textContent="filter_alt",O(t,"class","material-icons-round"),q(t,"font-size","14px"),q(t,"color","gray"),q(t,"margin-right","10px")},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function Yf(e){let t,n,r;return{c(){t=$("span"),t.textContent="Pause",O(t,"class","play-toggle svelte-749sf0")},m(e,i){T(e,t,i),n||(r=L(t,"click",Jf),n=!0)},d(e){e&&N(t),n=!1,r()}}}function Kf(e){let t;return{c(){t=$("span"),t.textContent="Animate",O(t,"class","play-toggle svelte-749sf0")},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function Zf(e){let t,n,r;return{c(){t=$("div"),t.innerHTML="<span>Show Reactions</span>",O(t,"class","filter clickable svelte-749sf0"),q(t,"margin-left","25px"),q(t,"border-radius","5px"),z(t,"selected",e[5]),z(t,"disabled",!e[10])},m(i,o){T(i,t,o),n||(r=L(t,"click",e[17]),n=!0)},p(e,n){32&n&&z(t,"selected",e[5]),1024&n&&z(t,"disabled",!e[10])},d(e){e&&N(t),n=!1,r()}}}function Qf(e){let t,n,r,i,o;return{c(){t=$("div"),n=$("div"),r=$("div"),r.innerHTML="<span>Add Your Gaze</span>",O(r,"class","filter clickable add svelte-749sf0"),O(n,"class","filter-options svelte-749sf0"),O(t,"class","viewer-filter filter-group svelte-749sf0"),z(t,"info-highlight",2==e[8])},m(s,a){T(s,t,a),I(t,n),I(n,r),e[19](r),i||(o=L(r,"click",e[20]),i=!0)},p(e,n){256&n&&z(t,"info-highlight",2==e[8])},d(n){n&&N(t),e[19](null),i=!1,o()}}}function Xf(t){let n,r,i,s,a,l,c,u,h,d,f,p,g,m,_,v,y=t[11]<=800&&Gf();function w(e,t){return"pause"==e[3]?Kf:Yf}let b=w(t),C=b(t),x=t[11]>=800&&Zf(t),k=t[11]>950&&Qf(t);return{c(){n=$("div"),y&&y.c(),r=P(),i=$("div"),s=$("div"),C.c(),a=P(),l=$("span"),c=$("input"),u=P(),h=$("div"),h.innerHTML="<span>Aggregate</span>",d=P(),f=$("div"),f.innerHTML="<span>Original</span>",p=P(),x&&x.c(),g=P(),k&&k.c(),m=A(),O(c,"type","range"),O(c,"id","slider"),O(c,"name","slider"),O(c,"min","0"),O(c,"max",t[6]),O(c,"step","1"),O(c,"class","svelte-749sf0"),O(l,"id","slider-holder"),O(l,"class","svelte-749sf0"),O(s,"class","filter time clickable svelte-749sf0"),z(s,"selected","slice"==t[4]),O(h,"class","filter clickable svelte-749sf0"),z(h,"selected","aggregate"==t[4]),O(f,"class","filter clickable svelte-749sf0"),z(f,"selected","original"==t[4]),O(i,"class","filter-options svelte-749sf0"),O(n,"class","visual-filter filter-group svelte-749sf0"),z(n,"info-highlight",1==t[8])},m(e,o){T(e,n,o),y&&y.m(n,null),I(n,r),I(n,i),I(i,s),C.m(s,null),I(s,a),I(s,l),I(l,c),F(c,t[2]),I(i,u),I(i,h),I(i,d),I(i,f),I(n,p),x&&x.m(n,null),t[18](n),T(e,g,o),k&&k.m(e,o),T(e,m,o),_||(v=[L(c,"input",t[12]),L(c,"change",t[13]),L(c,"input",t[13]),L(s,"click",t[14]),L(h,"click",t[15]),L(f,"click",t[16])],_=!0)},p(e,[t]){e[11]<=800?y||(y=Gf(),y.c(),y.m(n,r)):y&&(y.d(1),y=null),b!==(b=w(e))&&(C.d(1),C=b(e),C&&(C.c(),C.m(s,a))),64&t&&O(c,"max",e[6]),4&t&&F(c,e[2]),16&t&&z(s,"selected","slice"==e[4]),16&t&&z(h,"selected","aggregate"==e[4]),16&t&&z(f,"selected","original"==e[4]),e[11]>=800?x?x.p(e,t):(x=Zf(e),x.c(),x.m(n,null)):x&&(x.d(1),x=null),256&t&&z(n,"info-highlight",1==e[8]),e[11]>950?k?k.p(e,t):(k=Qf(e),k.c(),k.m(m.parentNode,m)):k&&(k.d(1),k=null)},i:e,o:e,d(e){e&&N(n),y&&y.d(),C.d(),x&&x.d(),t[18](null),e&&N(g),k&&k.d(e),e&&N(m),_=!1,o(v)}}}const Jf=()=>{};function ep(e,t,n){let r;d(e,Re,(e=>n(11,r=e)));let{gazeBtn:i,visFilter:o}=t,{sessionSliderMax:s,sessionData:a}=t,{visCurrFrame:l,visPlayStatus:c,visViewMode:u}=t,{visViewReactions:h=!1}=t,{infoTipIndex:f,data:p}=t,{sessionReactions:g}=t;return e.$$set=e=>{"gazeBtn"in e&&n(0,i=e.gazeBtn),"visFilter"in e&&n(1,o=e.visFilter),"sessionSliderMax"in e&&n(6,s=e.sessionSliderMax),"sessionData"in e&&n(7,a=e.sessionData),"visCurrFrame"in e&&n(2,l=e.visCurrFrame),"visPlayStatus"in e&&n(3,c=e.visPlayStatus),"visViewMode"in e&&n(4,u=e.visViewMode),"visViewReactions"in e&&n(5,h=e.visViewReactions),"infoTipIndex"in e&&n(8,f=e.infoTipIndex),"data"in e&&n(9,p=e.data),"sessionReactions"in e&&n(10,g=e.sessionReactions)},[i,o,l,c,u,h,s,a,f,p,g,r,()=>{n(4,u="slice")},function(){var e;e=this.value,l=""===e?null:+e,n(2,l)},()=>{"pause"==c?(n(4,u="slice"),l!=a.length&&l!=a.length-1||n(2,l=0),n(3,c="play")):"slice"==u&&"pause"!==c&&n(3,c="pause")},()=>{n(3,c="pause"),n(4,u="aggregate")},()=>{n(4,u="original")},()=>{n(5,h=!h)},function(e){X[e?"unshift":"push"]((()=>{o=e,n(1,o)}))},function(e){X[e?"unshift":"push"]((()=>{i=e,n(0,i)}))},()=>{$e.set(p),Ne.set("record")}]}class tp extends Se{constructor(e){super(),Ie(this,e,ep,Xf,a,{gazeBtn:0,visFilter:1,sessionSliderMax:6,sessionData:7,visCurrFrame:2,visPlayStatus:3,visViewMode:4,visViewReactions:5,infoTipIndex:8,data:9,sessionReactions:10})}}function np(e,t,n){const r=e.slice();return r[13]=t[n],r[15]=n,r}function rp(e){let t;return{c(){t=$("span"),t.textContent="person",O(t,"class","material-icons-round"),q(t,"font-size","14px"),q(t,"color","gray"),q(t,"margin-right","10px")},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function ip(e){let t,n,r;return{c(){t=$("div"),t.innerHTML='<span class="material-icons-round md-18 nav" style="font-size: 26px">arrow_left</span>',O(t,"class","arrow-nav clickable svelte-llfvv3"),z(t,"disabled",0==e[1])},m(i,o){T(i,t,o),n||(r=L(t,"click",e[9]),n=!0)},p(e,n){2&n&&z(t,"disabled",0==e[1])},d(e){e&&N(t),n=!1,r()}}}function op(e){let t,n,r,i,o,s,a,l,c,u,h,d,f,p=e[4][e[13]].name+"",g=e[15]+1+"",m=e[3].length+"";return{c(){t=$("option"),n=$("span"),r=R(p),i=R("'s Gaze"),o=P(),s=$("span"),a=R("("),l=R(g),c=R(" of "),u=R(m),h=R(")"),d=P(),t.__value=f=e[13],t.value=t.__value,O(t,"class","svelte-llfvv3")},m(e,f){T(e,t,f),I(t,n),I(n,r),I(n,i),I(t,o),I(t,s),I(s,a),I(s,l),I(s,c),I(s,u),I(s,h),I(t,d)},p(e,n){24&n&&p!==(p=e[4][e[13]].name+"")&&D(r,p),8&n&&m!==(m=e[3].length+"")&&D(u,m),8&n&&f!==(f=e[13])&&(t.__value=f,t.value=t.__value)},d(e){e&&N(t)}}}function sp(e){let t,n,r;return{c(){t=$("div"),t.innerHTML='<span class="material-icons-round md-18 nav" style="font-size: 26px">arrow_right</span>',O(t,"class","clickable arrow-nav svelte-llfvv3"),z(t,"disabled",e[1]==e[3].length-1)},m(i,o){T(i,t,o),n||(r=L(t,"click",e[12]),n=!0)},p(e,n){10&n&&z(t,"disabled",e[1]==e[3].length-1)},d(e){e&&N(t),n=!1,r()}}}function ap(t){let n,r,i,o,s,a,l,c,u=t[7]&&rp(),h=t[7]&&ip(t),d=t[3],f=[];for(let e=0;e<d.length;e+=1)f[e]=op(np(t,d,e));let p=t[7]&&sp(t);return{c(){n=$("div"),u&&u.c(),r=P(),i=$("div"),h&&h.c(),o=P(),s=$("select");for(let e=0;e<f.length;e+=1)f[e].c();a=P(),p&&p.c(),O(s,"class","clickable svelte-llfvv3"),void 0===t[0]&&re((()=>t[10].call(s))),O(i,"class","filter person svelte-llfvv3"),z(i,"info-highlight",0==t[6]),z(i,"info-hide","original"==t[5]),O(n,"class","filter-group svelte-llfvv3")},m(e,d){T(e,n,d),u&&u.m(n,null),I(n,r),I(n,i),h&&h.m(i,null),I(i,o),I(i,s);for(let e=0;e<f.length;e+=1)f[e].m(s,null);j(s,t[0]),t[11](s),I(i,a),p&&p.m(i,null),l||(c=L(s,"change",t[10]),l=!0)},p(e,[t]){if(e[7]?u||(u=rp(),u.c(),u.m(n,r)):u&&(u.d(1),u=null),e[7]?h?h.p(e,t):(h=ip(e),h.c(),h.m(i,o)):h&&(h.d(1),h=null),24&t){let n;for(d=e[3],n=0;n<d.length;n+=1){const r=np(e,d,n);f[n]?f[n].p(r,t):(f[n]=op(r),f[n].c(),f[n].m(s,null))}for(;n<f.length;n+=1)f[n].d(1);f.length=d.length}1&t&&j(s,e[0]),e[7]?p?p.p(e,t):(p=sp(e),p.c(),p.m(i,null)):p&&(p.d(1),p=null),64&t&&z(i,"info-highlight",0==e[6]),32&t&&z(i,"info-hide","original"==e[5])},i:e,o:e,d(e){e&&N(n),u&&u.d(),h&&h.d(),M(f,e),t[11](null),p&&p.d(),l=!1,c()}}}function lp(e,t,n){let r;d(e,Re,(e=>n(8,r=e)));let{cardSessionsArr:i,cardSessionsObj:o}=t,{sessionIndex:s,sessionKey:a}=t,{visViewMode:l}=t,{infoTipIndex:c}=t,{imgNav:u}=t,h=!1;return e.$$set=e=>{"cardSessionsArr"in e&&n(3,i=e.cardSessionsArr),"cardSessionsObj"in e&&n(4,o=e.cardSessionsObj),"sessionIndex"in e&&n(1,s=e.sessionIndex),"sessionKey"in e&&n(0,a=e.sessionKey),"visViewMode"in e&&n(5,l=e.visViewMode),"infoTipIndex"in e&&n(6,c=e.infoTipIndex),"imgNav"in e&&n(2,u=e.imgNav)},e.$$.update=()=>{256&e.$$.dirty&&r<=800&&n(7,h=!0),9&e.$$.dirty&&n(1,s=i.indexOf(a))},[a,s,u,i,o,l,c,h,r,()=>{n(1,s--,s)},function(){a=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),n(0,a)},function(e){X[e?"unshift":"push"]((()=>{u=e,n(2,u),n(3,i)}))},()=>{n(1,s++,s)}]}class cp extends Se{constructor(e){super(),Ie(this,e,lp,ap,a,{cardSessionsArr:3,cardSessionsObj:4,sessionIndex:1,sessionKey:0,visViewMode:5,infoTipIndex:6,imgNav:2})}}var up={$:e=>"string"==typeof e?document.querySelector(e):e,extend:(...e)=>Object.assign(...e),cumulativeOffset(e){let t=0,n=0;do{t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent}while(e);return{top:t,left:n}},directScroll:e=>e&&e!==document&&e!==document.body,scrollTop(e,t){let n=void 0!==t;return this.directScroll(e)?n?e.scrollTop=t:e.scrollTop:n?document.documentElement.scrollTop=document.body.scrollTop=t:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},scrollLeft(e,t){let n=void 0!==t;return this.directScroll(e)?n?e.scrollLeft=t:e.scrollLeft:n?document.documentElement.scrollLeft=document.body.scrollLeft=t:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0}};const hp={container:"body",duration:500,delay:0,offset:0,easing:function(e){return e<.5?4*e*e*e:.5*Math.pow(2*e-2,3)+1},onStart:e,onDone:e,onAborting:e,scrollX:!1,scrollY:!0},dp=e=>{let{offset:t,duration:n,delay:r,easing:i,x:o=0,y:s=0,scrollX:a,scrollY:l,onStart:c,onDone:u,container:h,onAborting:d,element:f}=e;"function"==typeof t&&(t=t());var p=up.cumulativeOffset(h),g=f?up.cumulativeOffset(f):{top:s,left:o},m=up.scrollLeft(h),_=up.scrollTop(h),v=g.left-p.left+t,y=g.top-p.top+t,b=v-m,C=y-_;let x=!0,I=!1,S=w()+r,E=S+n;function T(e){e||(I=!0,c(f,{x:o,y:s}))}function N(e){!function(e,t,n){a&&up.scrollLeft(e,n),l&&up.scrollTop(e,t)}(h,_+C*e,m+b*e)}function M(){x=!1}return k((e=>{if(!I&&e>=S&&T(!1),I&&e>=E&&(N(1),M(),u(f,{x:o,y:s})),!x)return d(f,{x:o,y:s}),!1;if(I){N(0+1*i((e-S)/n))}return!0})),T(r),N(0),M},fp=e=>dp((e=>{let t=up.extend({},hp,e);return t.container=up.$(t.container),t.element=up.$(t.element),t})(e));var pp;pp={offset:-5},up.extend(hp,pp||{});var gp=e=>{let t=document.querySelector("#"+e);fp({element:t})};function mp(e){let t,n,r,i,o,s,a,l,c,u,h,d,f,p,g,m,_,v,y,w,b,C,x,k,S,E,M,A,F,j,B,H,U,W=e[1].artist+"",V=e[1].title+"",G=e[25]&&_p(),Y=e[22]>=0&&vp(e),K=e[26]>=900&&yp(),Z=e[26]>=800&&wp(e),Q=e[26]<=800&&bp(e);function J(t){e[37](t)}function ee(t){e[38](t)}function te(t){e[39](t)}function ne(t){e[40](t)}function re(t){e[41](t)}function oe(t){e[42](t)}function se(t){e[43](t)}let ae={infoTipIndex:e[22],sessionData:e[7],data:e[1],sessionReactions:e[19]};void 0!==e[13]&&(ae.visFilter=e[13]),void 0!==e[14]&&(ae.gazeBtn=e[14]),void 0!==e[20]&&(ae.sessionSliderMax=e[20]),void 0!==e[9]&&(ae.visCurrFrame=e[9]),void 0!==e[8]&&(ae.visPlayStatus=e[8]),void 0!==e[0]&&(ae.visViewMode=e[0]),void 0!==e[21]&&(ae.visViewReactions=e[21]),b=new tp({props:ae}),X.push((()=>we(b,"visFilter",J))),X.push((()=>we(b,"gazeBtn",ee))),X.push((()=>we(b,"sessionSliderMax",te))),X.push((()=>we(b,"visCurrFrame",ne))),X.push((()=>we(b,"visPlayStatus",re))),X.push((()=>we(b,"visViewMode",oe))),X.push((()=>we(b,"visViewReactions",se)));let le=e[3]&&e[1].sessionData&&Cp(e);return{c(){G&&G.c(),t=P(),n=$("div"),Y&&Y.c(),r=P(),i=$("div"),o=$("div"),s=$("h2"),K&&K.c(),a=P(),l=$("a"),c=$("span"),u=R(W),h=R(", "),d=$("i"),f=R(V),p=P(),g=$("span"),g.textContent="open_in_new",_=P(),Z&&Z.c(),v=P(),y=$("div"),Q&&Q.c(),w=P(),be(b.$$.fragment),F=P(),le&&le.c(),O(d,"class","svelte-6p3wa5"),O(g,"class","material-icons-round svelte-6p3wa5"),q(g,"font-size","12px"),q(g,"margin-left","6px"),O(l,"class","clickable svelte-6p3wa5"),q(l,"display","flex"),q(l,"align-items","center"),O(l,"href",m=e[1].origLink),O(l,"target","_blank"),q(s,"display","flex"),q(s,"align-items","center"),O(s,"class","svelte-6p3wa5"),O(o,"class","card-header svelte-6p3wa5"),O(y,"class","card-filters svelte-6p3wa5"),O(i,"class","card-top svelte-6p3wa5"),O(n,"class","card-outer svelte-6p3wa5"),O(n,"id",j=e[1].key),z(n,"active",e[1].key==e[17])},m(m,C){G&&G.m(m,C),T(m,t,C),T(m,n,C),Y&&Y.m(n,null),I(n,r),I(n,i),I(i,o),I(o,s),K&&K.m(s,null),I(s,a),I(s,l),I(l,c),I(c,u),I(c,h),I(c,d),I(d,f),I(l,p),I(l,g),I(o,_),Z&&Z.m(o,null),I(i,v),I(i,y),Q&&Q.m(y,null),I(y,w),Ce(b,y,null),I(n,F),le&&le.m(n,null),e[53](n),B=!0,H||(U=L(i,"click",e[44]),H=!0)},p(e,i){e[25]?G?33554432&i[0]&&ge(G,1):(G=_p(),G.c(),ge(G,1),G.m(t.parentNode,t)):G&&(fe(),me(G,1,1,(()=>{G=null})),pe()),e[22]>=0?Y?(Y.p(e,i),4194304&i[0]&&ge(Y,1)):(Y=vp(e),Y.c(),ge(Y,1),Y.m(n,r)):Y&&(fe(),me(Y,1,1,(()=>{Y=null})),pe()),e[26]>=900?K||(K=yp(),K.c(),K.m(s,a)):K&&(K.d(1),K=null),(!B||2&i[0])&&W!==(W=e[1].artist+"")&&D(u,W),(!B||2&i[0])&&V!==(V=e[1].title+"")&&D(f,V),(!B||2&i[0]&&m!==(m=e[1].origLink))&&O(l,"href",m),e[26]>=800?Z?Z.p(e,i):(Z=wp(e),Z.c(),Z.m(o,null)):Z&&(Z.d(1),Z=null),e[26]<=800?Q?(Q.p(e,i),67108864&i[0]&&ge(Q,1)):(Q=bp(e),Q.c(),ge(Q,1),Q.m(y,w)):Q&&(fe(),me(Q,1,1,(()=>{Q=null})),pe());const c={};4194304&i[0]&&(c.infoTipIndex=e[22]),128&i[0]&&(c.sessionData=e[7]),2&i[0]&&(c.data=e[1]),524288&i[0]&&(c.sessionReactions=e[19]),!C&&8192&i[0]&&(C=!0,c.visFilter=e[13],ie((()=>C=!1))),!x&&16384&i[0]&&(x=!0,c.gazeBtn=e[14],ie((()=>x=!1))),!k&&1048576&i[0]&&(k=!0,c.sessionSliderMax=e[20],ie((()=>k=!1))),!S&&512&i[0]&&(S=!0,c.visCurrFrame=e[9],ie((()=>S=!1))),!E&&256&i[0]&&(E=!0,c.visPlayStatus=e[8],ie((()=>E=!1))),!M&&1&i[0]&&(M=!0,c.visViewMode=e[0],ie((()=>M=!1))),!A&&2097152&i[0]&&(A=!0,c.visViewReactions=e[21],ie((()=>A=!1))),b.$set(c),e[3]&&e[1].sessionData?le?(le.p(e,i),10&i[0]&&ge(le,1)):(le=Cp(e),le.c(),ge(le,1),le.m(n,null)):le&&(fe(),me(le,1,1,(()=>{le=null})),pe()),(!B||2&i[0]&&j!==(j=e[1].key))&&O(n,"id",j),131074&i[0]&&z(n,"active",e[1].key==e[17])},i(e){B||(ge(G),ge(Y),ge(Q),ge(b.$$.fragment,e),ge(le),B=!0)},o(e){me(G),me(Y),me(Q),me(b.$$.fragment,e),me(le),B=!1},d(r){G&&G.d(r),r&&N(t),r&&N(n),Y&&Y.d(),K&&K.d(),Z&&Z.d(),Q&&Q.d(),xe(b),le&&le.d(),e[53](null),H=!1,U()}}}function _p(e){let t,n,r,i;return n=new hf({}),{c(){t=$("div"),be(n.$$.fragment)},m(e,r){T(e,t,r),Ce(n,t,null),i=!0},i(e){i||(ge(n.$$.fragment,e),re((()=>{r||(r=ve(t,lt,{duration:100},!0)),r.run(1)})),i=!0)},o(e){me(n.$$.fragment,e),r||(r=ve(t,lt,{duration:100},!1)),r.run(0),i=!1},d(e){e&&N(t),xe(n),e&&r&&r.end()}}}function vp(e){let t,n,r;function i(t){e[33](t)}let o={helperTextPositions:e[27]};return void 0!==e[22]&&(o.infoTipIndex=e[22]),t=new Vf({props:o}),X.push((()=>we(t,"infoTipIndex",i))),{c(){be(t.$$.fragment)},m(e,n){Ce(t,e,n),r=!0},p(e,r){const i={};!n&&4194304&r[0]&&(n=!0,i.infoTipIndex=e[22],ie((()=>n=!1))),t.$set(i)},i(e){r||(ge(t.$$.fragment,e),r=!0)},o(e){me(t.$$.fragment,e),r=!1},d(e){xe(t,e)}}}function yp(e){let t;return{c(){t=$("div"),t.textContent="Gaze Collection",q(t,"color","rgb(126 123 123)"),q(t,"margin-right","15px")},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function wp(t){let n,r,i;return{c(){n=$("div"),n.innerHTML='<span class="material-icons-round md-14 svelte-6p3wa5" style="color: #bfb9b9">info</span>',O(n,"class","clickable svelte-6p3wa5")},m(e,o){T(e,n,o),r||(i=L(n,"click",t[34]),r=!0)},p:e,d(e){e&&N(n),r=!1,i()}}}function bp(e){let t,n,r,i;function o(t){e[35](t)}function s(t){e[36](t)}let a={sessionKey:e[6],cardSessionsArr:e[4],cardSessionsObj:e[18],visViewMode:e[0],infoTipIndex:e[22]};return void 0!==e[12]&&(a.imgNav=e[12]),void 0!==e[5]&&(a.sessionIndex=e[5]),t=new cp({props:a}),X.push((()=>we(t,"imgNav",o))),X.push((()=>we(t,"sessionIndex",s))),{c(){be(t.$$.fragment)},m(e,n){Ce(t,e,n),i=!0},p(e,i){const o={};64&i[0]&&(o.sessionKey=e[6]),16&i[0]&&(o.cardSessionsArr=e[4]),262144&i[0]&&(o.cardSessionsObj=e[18]),1&i[0]&&(o.visViewMode=e[0]),4194304&i[0]&&(o.infoTipIndex=e[22]),!n&&4096&i[0]&&(n=!0,o.imgNav=e[12],ie((()=>n=!1))),!r&&32&i[0]&&(r=!0,o.sessionIndex=e[5],ie((()=>r=!1))),t.$set(o)},i(e){i||(ge(t.$$.fragment,e),i=!0)},o(e){me(t.$$.fragment,e),i=!1},d(e){xe(t,e)}}}function Cp(e){let t,n,r,i,o,s,a,l,c;function u(t){e[45](t)}function h(t){e[46](t)}function d(t){e[47](t)}function f(t){e[48](t)}function p(t){e[49](t)}let g={personLength:e[4].length,data:e[1],visViewMode:e[0],visViewReactions:e[21],sessionReactions:e[19],clips:e[23],imgFrame:e[24]};void 0!==e[16]&&(g.clipHolder=e[16]),void 0!==e[5]&&(g.sessionIndex=e[5]),void 0!==e[10]&&(g.imgHolder=e[10]),void 0!==e[11]&&(g.svgHolder=e[11]),void 0!==e[2]&&(g.imgLoaded=e[2]),n=new $f({props:g}),X.push((()=>we(n,"clipHolder",u))),X.push((()=>we(n,"sessionIndex",h))),X.push((()=>we(n,"imgHolder",d))),X.push((()=>we(n,"svgHolder",f))),X.push((()=>we(n,"imgLoaded",p)));let m=e[26]>800&&xp(e);return{c(){t=$("div"),be(n.$$.fragment),l=P(),m&&m.c(),O(t,"class","center svelte-6p3wa5")},m(r,i){T(r,t,i),Ce(n,t,null),I(t,l),m&&m.m(t,null),e[52](t),c=!0},p(e,l){const c={};16&l[0]&&(c.personLength=e[4].length),2&l[0]&&(c.data=e[1]),1&l[0]&&(c.visViewMode=e[0]),2097152&l[0]&&(c.visViewReactions=e[21]),524288&l[0]&&(c.sessionReactions=e[19]),8388608&l[0]&&(c.clips=e[23]),16777216&l[0]&&(c.imgFrame=e[24]),!r&&65536&l[0]&&(r=!0,c.clipHolder=e[16],ie((()=>r=!1))),!i&&32&l[0]&&(i=!0,c.sessionIndex=e[5],ie((()=>i=!1))),!o&&1024&l[0]&&(o=!0,c.imgHolder=e[10],ie((()=>o=!1))),!s&&2048&l[0]&&(s=!0,c.svgHolder=e[11],ie((()=>s=!1))),!a&&4&l[0]&&(a=!0,c.imgLoaded=e[2],ie((()=>a=!1))),n.$set(c),e[26]>800?m?(m.p(e,l),67108864&l[0]&&ge(m,1)):(m=xp(e),m.c(),ge(m,1),m.m(t,null)):m&&(fe(),me(m,1,1,(()=>{m=null})),pe())},i(e){c||(ge(n.$$.fragment,e),ge(m),c=!0)},o(e){me(n.$$.fragment,e),me(m),c=!1},d(r){r&&N(t),xe(n),m&&m.d(),e[52](null)}}}function xp(e){let t,n,r,i;function o(t){e[50](t)}function s(t){e[51](t)}let a={sessionKey:e[6],cardSessionsArr:e[4],cardSessionsObj:e[18],visViewMode:e[0],infoTipIndex:e[22]};return void 0!==e[12]&&(a.imgNav=e[12]),void 0!==e[5]&&(a.sessionIndex=e[5]),t=new cp({props:a}),X.push((()=>we(t,"imgNav",o))),X.push((()=>we(t,"sessionIndex",s))),{c(){be(t.$$.fragment)},m(e,n){Ce(t,e,n),i=!0},p(e,i){const o={};64&i[0]&&(o.sessionKey=e[6]),16&i[0]&&(o.cardSessionsArr=e[4]),262144&i[0]&&(o.cardSessionsObj=e[18]),1&i[0]&&(o.visViewMode=e[0]),4194304&i[0]&&(o.infoTipIndex=e[22]),!n&&4096&i[0]&&(n=!0,o.imgNav=e[12],ie((()=>n=!1))),!r&&32&i[0]&&(r=!0,o.sessionIndex=e[5],ie((()=>r=!1))),t.$set(o)},i(e){i||(ge(t.$$.fragment,e),i=!0)},o(e){me(t.$$.fragment,e),i=!1},d(e){xe(t,e)}}}function kp(e){let t,n,r=e[3]&&mp(e);return{c(){r&&r.c(),t=A()},m(e,i){r&&r.m(e,i),T(e,t,i),n=!0},p(e,n){e[3]?r?(r.p(e,n),8&n[0]&&ge(r,1)):(r=mp(e),r.c(),ge(r,1),r.m(t.parentNode,t)):r&&(fe(),me(r,1,1,(()=>{r=null})),pe())},i(e){n||(ge(r),n=!0)},o(e){me(r),n=!1},d(e){r&&r.d(e),e&&N(t)}}}function Ip(e,t,n){let r,i,o,s;d(e,Le,(e=>n(17,r=e))),d(e,Oe,(e=>n(32,i=e))),d(e,Be,(e=>n(25,o=e))),d(e,Re,(e=>n(26,s=e)));let a,l,c,u,h,{data:f}=t,p=!1,g=!1,m=!1,_=null,v=null,y=100,{visViewMode:w="slice"}=t,b=!1,C="pause",x=0,k=50,I=-1,S=[],E=null,T=null;Z((async()=>{await A(u),f.sessionData&&(n(18,a=f.sessionData),n(4,l=Object.keys(f.sessionData)),n(5,c=Math.max(l.length-2,0)),n(6,u=l[c.length-1])),n(3,g=!0)}));let N=[[0,0],[0,0],[0,0]],M=null,$=null,R=null,P=null;async function A(e){n(7,_=await Ia("sessionData/"+e)),_&&(n(29,k=2e4/_.length),n(20,y=_.length),n(28,m=!0),n(23,S=await async function(e,t){let n=[];for(let r=20;r>0;r--){let i=1*r+10,o=.5*r,s=.05*(20-r);n.push({class:"clip",r:i,ctrx:t[0].xPct,ctry:t[0].yPct,blur:o,opacity:s,src:e})}return n}(f.url,_)),n(9,x=0)),n(19,v=await Ia("reactions/"+e))}let L=null,O=null,D=!1;return e.$$set=e=>{"data"in e&&n(1,f=e.data),"visViewMode"in e&&n(0,w=e.visViewMode)},e.$$.update=()=>{if(122&e.$$.dirty[0]&&g&&f.sessionData&&(n(6,u=l[c]),A(u)),131078&e.$$.dirty[0]|3&e.$$.dirty[1]&&(i!=f.key||D||(n(0,w="aggregate"),n(31,D=!0)),r==f.key&&!D&&p&&(n(0,w="aggregate"),n(31,D=!0))),3211&e.$$.dirty[0]&&(g&&"aggregate"==w&&E&&T&&_?async function(e,t,n,r){let i,o,s=sc(t).node().getBoundingClientRect().width,a=.705*s,l=lf().domain([0,100]).range([30,s-30]),c=lf().domain([0,100]).range([30,a-30]);i=parseInt(.07*Math.min(s,a)),o=parseInt(1.5*i);let u=bh().x((e=>l(e.xPct))).y((e=>c(e.yPct))).size([s,a]).bandwidth(i).thresholds(o)(e),h=function(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}(u,(e=>e.value)),d=qa(u,(e=>e.value)),f=lf().domain([d,.5*d,h]).range([0,1,4]),p=lf().domain([d,h]).range([1,1]);const g=sc(n).attr("id");sc(n).selectAll(".clipPathGroup").data(u,(e=>e.coordinates[0])).join((e=>{let t=e.append("g").attr("class","clipPathGroup");t.append("clipPath").attr("id",((e,t)=>`path-${g}-${t}`)).append("path").attr("stroke-linejoin","round").attr("d",Yd()),t.append("image").attr("clip-path",((e,t)=>`url(#path-${g}-${t})`)).attr("width","100%").attr("height","100%").attr("xlink:href",r).style("filter",(e=>`opacity(${p(e.value)}) blur(${f(e.value)}px)`))}),(e=>{let t=e.selectAll(".clipPathGroup");t.select("clipPath").attr("d",Yd()),t.select("image").style("filter",(e=>`opacity(${p(e.value)}) blur(${f(e.value)}px)`))}),(e=>{e.remove()}))}(_,E,T,f.url):g&&"point"==w&&E&&T&&_&&async function(e,t,n,r){let i=sc(t).node().getBoundingClientRect().width,o=.705*i,s=lf().domain([0,100]).range([30,i-30]),a=lf().domain([0,100]).range([30,o-30]),l=sc(n).append("g").selectAll(".point").data(e,(e=>e.xPct+e.sessionID));console.log(e),l.join("circle").attr("cx",(e=>s(e.xPct))).attr("cy",(e=>a(e.yPct))).attr("r",2).attr("fill","black").attr("class","point").style("opacity","0.5").style("filter","blur(1px)")}(_,E,T,f.url)),61440&e.$$.dirty[0]&&M&&$&&R){[M,$,R].forEach(((e,t)=>{e&&function(e,t,n,r){let i,o;i=Math.min(t.x+t.width/4-n.x,n.width-450),o=t.y-n.y+50,r[e]=[i,o]}(t,e.getBoundingClientRect(),P.getBoundingClientRect(),N)}))}65536&e.$$.dirty[0]&&L&&n(30,O=L.childNodes),536871816&e.$$.dirty[0]&&g&&("play"==C&&x<_.length-1?setTimeout((()=>{n(9,x++,x)}),k):"play"==C&&x==_.length-1&&n(8,C="pause")),1342177929&e.$$.dirty[0]&&g&&m&&_&&x<_.length-1&&"slice"==w&&function(e,t,n){e.forEach((e=>{let r=e.style["clip-path"].split("at ")[0],i=`at ${t}% ${n}%)`;e.style["clip-path"]=r+i}))}(O,_[x].xPct,_[x].yPct)},[w,f,p,g,l,c,u,_,C,x,E,T,M,$,R,P,L,r,a,v,y,b,I,S,h,o,s,N,m,k,O,D,i,function(e){I=e,n(22,I)},()=>{n(22,I=0)},function(e){M=e,n(12,M)},function(e){c=e,n(5,c)},function(e){$=e,n(13,$)},function(e){R=e,n(14,R)},function(e){y=e,n(20,y)},function(e){x=e,n(9,x),n(3,g),n(8,C),n(7,_),n(29,k)},function(e){C=e,n(8,C),n(3,g),n(9,x),n(7,_),n(29,k)},function(e){w=e,n(0,w),n(32,i),n(1,f),n(31,D),n(17,r),n(2,p)},function(e){b=e,n(21,b)},()=>{f.key==r&&gp(f.key)},function(e){L=e,n(16,L)},function(e){c=e,n(5,c)},function(e){E=e,n(10,E)},function(e){T=e,n(11,T)},function(e){p=e,n(2,p)},function(e){M=e,n(12,M)},function(e){c=e,n(5,c)},function(e){X[e?"unshift":"push"]((()=>{h=e,n(24,h)}))},function(e){X[e?"unshift":"push"]((()=>{P=e,n(15,P)}))}]}class Sp extends Se{constructor(e){super(),Ie(this,e,Ip,kp,a,{data:1,visViewMode:0},null,[-1,-1])}}let Ep=Te({yusuf:{key:"yusuf",artist:"Behzd",title:"Yusuf and Zulaikha",url:"./assets/img/yusuf.jpg",sessionData:{},width:1046,height:1535,origLink:"https://en.wikipedia.org/wiki/Yusuf_and_Zulaikha"},hockney:{key:"hockney",artist:"David Hockney",title:"Ordinary Picture",url:"./assets/img/hockney.png",sessionData:{},width:1691,height:1704,origLink:"https://www.si.edu/object/ordinary-picture:hmsg_66.2472"},mehretuUntitled:{artist:"Julie Mehretu",title:"Local Calm",url:"./assets/img/mehretuCropped.png",sessionData:{},key:"mehretuUntitled",width:1745,height:1228,origLink:"https://americanart.si.edu/artwork/local-calm-76328"},magi:{artist:"Hieronymus Bosch",title:"The Adoration of the Magi",url:"./assets/img/magi.jpg",sessionData:{},key:"magi",width:3101,height:3875,origLink:"https://www.metmuseum.org/art/collection/search/435724"},utagawa:{key:"utagawa",artist:"Utagawa Toyokuni",title:"Fair Travellers Fording the River Oi",url:"./assets/img/utagawa.jpg",sessionData:{},width:4e3,height:1919,origLink:"https://www.metmuseum.org/art/collection/search/36679?ft=ukiyo-e&amp;offset=40&amp;rpp=40&amp;pos=60"},agnes:{key:"agnes",artist:"Agnes Denes",title:"Wheatfield",url:"./assets/img/agnes.png",sessionData:{},width:3331,height:1665,origLink:"http://www.agnesdenesstudio.com/works7.html"},lewitt:{key:"lewitt",artist:"Sol Lewitt",title:"Lines from Points to Points",url:"./assets/img/lewitt.png",sessionData:{},width:1722,height:1704,origLink:"https://www.si.edu/object/lines-points-points-portfolio-location-lines:saam_1990.60.2"},madonna:{key:"madonna",artist:"Carlo Crivelli",title:"Madonna and Child",url:"./assets/img/madonna.jpg",sessionData:{},width:2726,height:4e3,origLink:"https://www.metmuseum.org/art/collection/search/436052"},sakura:{key:"sakura",artist:"Kiyoshi Awazu",title:"A New Spirit",url:"./assets/img/kiyoshi.jpg",sessionData:{},width:736,height:1024,origLink:"https://www.cooperhewitt.org/2016/04/01/sensing-a-new-spirit-of-japan/"}}),Tp=Te(null),Np=Te(null);function Mp(e,t,n){const r=e.slice();return r[6]=t[n],r[8]=n,r}function $p(e){let t,n;return t=new Sp({props:{data:e[6],visViewMode:"slice"}}),{c(){be(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.data=e[6]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function Rp(e){let t,n,r,i,o=e[0],s=[];for(let t=0;t<o.length;t+=1)s[t]=$p(Mp(e,o,t));const a=e=>me(s[e],1,1,(()=>{s[e]=null}));return{c(){t=$("div"),n=$("div"),n.innerHTML='<h2 class="svelte-1rryqxm">How We Gaze: Gallery</h2> \n    <p>Welcome to the Gallery! Each collection below visualizes how individuals\n      gazed at a particular piece of artwork. Study the existing gazes in this\n      gallery, or add your own.</p> \n    <p>All works are sourced from the Smithsonian and Met Institute Open\n      Collections.</p>',r=P();for(let e=0;e<s.length;e+=1)s[e].c();O(n,"class","card-outer intro svelte-1rryqxm"),q(n,"font-size","16px"),q(n,"font-weight","400"),O(t,"class","card-holder svelte-1rryqxm")},m(e,o){T(e,t,o),I(t,n),I(t,r);for(let e=0;e<s.length;e+=1)s[e].m(t,null);i=!0},p(e,[n]){if(1&n){let r;for(o=e[0],r=0;r<o.length;r+=1){const i=Mp(e,o,r);s[r]?(s[r].p(i,n),ge(s[r],1)):(s[r]=$p(i),s[r].c(),ge(s[r],1),s[r].m(t,null))}for(fe(),r=o.length;r<s.length;r+=1)a(r);pe()}},i(e){if(!i){for(let e=0;e<o.length;e+=1)ge(s[e]);i=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)me(s[e]);i=!1},d(e){e&&N(t),M(s,e)}}}function Pp(e,t,n){let r,i;d(e,De,(e=>n(2,r=e))),d(e,Ep,(e=>n(3,i=e)));let o=[],s=[];return function(e){K().$$.after_update.push(e)}((()=>{if(r){new MutationObserver((e=>{e.length>10&&window.scrollTo({top:document.querySelector("#"+r).getBoundingClientRect().top})})).observe(document.querySelector(".card-holder"),{childList:!0,subtree:!1,characterDataOldValue:!0})}})),async function(){await async function(){let e=await fetch("./assets/data/offlineDb.json"),t=await e.json();return Ue.update((e=>t)),t}(),await async function(){let e=await Ia("works");if(e){let t={};for(let n in i)e.hasOwnProperty(n)?t[n]=e[n]:await Sa("works/"+n,i[n]);n(0,o=Object.values(t)),s=Object.keys(t)}Tp.set(s),Np.set(o),Le.set(s[0])}(),window.addEventListener("scroll",(e=>{window.scrollY>200?Fe.set(!0):Fe.set(!1);let t=window.innerHeight/2,n=document.querySelectorAll(".card-outer");n.forEach(((e,r)=>{let i=e.getBoundingClientRect();t>=i.top&&t<i.height+i.top&&(r<n.length-1&&Oe.set(n[r+1].id),Le.set(e.id))}))}))}(),[o]}class Ap extends Se{constructor(e){super(),Ie(this,e,Pp,Rp,a,{})}}function Lp(e){let t,n,r,i;return n=new hf({}),{c(){t=$("div"),be(n.$$.fragment)},m(e,r){T(e,t,r),Ce(n,t,null),i=!0},i(e){i||(ge(n.$$.fragment,e),re((()=>{r||(r=ve(t,lt,{duration:100},!0)),r.run(1)})),i=!0)},o(e){me(n.$$.fragment,e),r||(r=ve(t,lt,{duration:100},!1)),r.run(0),i=!1},d(e){e&&N(t),xe(n),e&&r&&r.end()}}}function Op(t){let n,r,i,s,a,l,c,u,h,d,f,p,g,m,_,v,y,w,b,C;return{c(){n=$("nav"),r=$("div"),i=$("div"),i.innerHTML='<span class="material-icons-round svelte-15q9ttb">info_outline</span>',a=P(),l=$("div"),l.innerHTML='<span class="material-icons-round svelte-15q9ttb">help_outline</span>',u=P(),h=$("div"),d=$("div"),d.innerHTML='<span class="material-icons-round svelte-15q9ttb">view_module</span>',f=P(),p=$("div"),g=$("span"),g.textContent="keyboard_arrow_up",m=P(),_=$("div"),v=$("span"),v.textContent="keyboard_arrow_down",O(i,"class","btn clickable active  svelte-15q9ttb"),O(l,"class","btn clickable active  svelte-15q9ttb"),O(r,"class","btn-group svelte-15q9ttb"),O(d,"class","btn svelte-15q9ttb"),O(g,"class","material-icons-round svelte-15q9ttb"),O(p,"class","btn svelte-15q9ttb"),O(v,"class","material-icons-round svelte-15q9ttb"),O(_,"class","btn svelte-15q9ttb"),O(h,"class","btn-group svelte-15q9ttb"),O(n,"class","vertical svelte-15q9ttb")},m(e,o){T(e,n,o),I(n,r),I(r,i),I(r,a),I(r,l),I(n,u),I(n,h),I(h,d),I(h,f),I(h,p),I(p,g),I(h,m),I(h,_),I(_,v),w=!0,b||(C=[L(i,"click",t[7]),L(l,"click",t[8]),L(d,"click",t[9]),L(g,"click",t[10]),L(v,"click",t[11])],b=!0)},p:e,i(e){w||(re((()=>{s||(s=ve(i,lt,{},!0)),s.run(1)})),re((()=>{c||(c=ve(l,lt,{},!0)),c.run(1)})),re((()=>{y||(y=ve(n,lt,{duration:100},!0)),y.run(1)})),w=!0)},o(e){s||(s=ve(i,lt,{},!1)),s.run(0),c||(c=ve(l,lt,{},!1)),c.run(0),y||(y=ve(n,lt,{duration:100},!1)),y.run(0),w=!1},d(e){e&&N(n),e&&s&&s.end(),e&&c&&c.end(),e&&y&&y.end(),b=!1,o(C)}}}function Dp(e){let t,n,r,i,o,s,a,l,c,u,h,d,f,p,g,m;function _(e,t){return"gallery"==e[2]?qp:Fp}let v=_(e),y=v(e);return{c(){t=$("header"),n=$("div"),r=$("div"),i=$("div"),o=$("span"),o.textContent="How We Gaze",s=P(),a=$("span"),a.textContent="-",l=P(),y.c(),c=P(),u=$("div"),h=$("div"),h.innerHTML='<span class="material-icons-round svelte-15q9ttb" style="color:var(--color-accent)">arrow_back</span> \n\n            <span>Back to Gallery</span>',O(a,"class","divider svelte-15q9ttb"),O(i,"class","header-left"),O(h,"class","btn clickable svelte-15q9ttb"),z(h,"active","record"===e[2]),O(u,"class","header-right svelte-15q9ttb"),O(r,"class","header-content svelte-15q9ttb"),O(n,"class","header-wrapper svelte-15q9ttb"),O(t,"class","svelte-15q9ttb")},m(d,f){T(d,t,f),I(t,n),I(n,r),I(r,i),I(i,o),I(i,s),I(i,a),I(i,l),y.m(i,null),I(r,c),I(r,u),I(u,h),p=!0,g||(m=L(h,"click",e[12]),g=!0)},p(e,t){v===(v=_(e))&&y?y.p(e,t):(y.d(1),y=v(e),y&&(y.c(),y.m(i,null))),4&t&&z(h,"active","record"===e[2])},i(e){p||(re((()=>{d||(d=ve(h,ct,{duration:500},!0)),d.run(1)})),re((()=>{f||(f=ve(t,lt,{duration:200},!0)),f.run(1)})),p=!0)},o(e){d||(d=ve(h,ct,{duration:500},!1)),d.run(0),f||(f=ve(t,lt,{duration:200},!1)),f.run(0),p=!1},d(e){e&&N(t),y.d(),e&&d&&d.end(),e&&f&&f.end(),g=!1,m()}}}function Fp(e){let t;return{c(){t=$("span"),t.textContent="Gaze",O(t,"class","header-sub accent svelte-15q9ttb"),z(t,"active","record"===e[2])},m(e,n){T(e,t,n)},p(e,n){4&n&&z(t,"active","record"===e[2])},d(e){e&&N(t)}}}function qp(e){let t;return{c(){t=$("span"),t.textContent="Gallery",O(t,"class","header-sub accent svelte-15q9ttb"),z(t,"active","gallery"===e[2])},m(e,n){T(e,t,n)},p(e,n){4&n&&z(t,"active","gallery"===e[2])},d(e){e&&N(t)}}}function jp(e){let t,n,r,i,o,s,a,l,c,u;function h(e,t){return"gallery"==e[2]?Bp:zp}let d=h(e),f=d(e),p="gallery"==e[2]&&Hp(e);return{c(){t=$("header"),n=$("div"),r=$("div"),i=$("div"),o=$("span"),o.textContent="How We Gaze",s=P(),a=$("span"),a.textContent="-",l=P(),f.c(),c=P(),u=$("div"),p&&p.c(),O(a,"class","divider svelte-15q9ttb"),O(i,"class","header-left"),O(u,"class","header-right svelte-15q9ttb"),O(r,"class","header-content svelte-15q9ttb"),O(n,"class","header-wrapper svelte-15q9ttb"),O(t,"class","svelte-15q9ttb")},m(e,h){T(e,t,h),I(t,n),I(n,r),I(r,i),I(i,o),I(i,s),I(i,a),I(i,l),f.m(i,null),I(r,c),I(r,u),p&&p.m(u,null)},p(e,t){d===(d=h(e))&&f?f.p(e,t):(f.d(1),f=d(e),f&&(f.c(),f.m(i,null))),"gallery"==e[2]?p?p.p(e,t):(p=Hp(e),p.c(),p.m(u,null)):p&&(p.d(1),p=null)},d(e){e&&N(t),f.d(),p&&p.d()}}}function zp(e){let t;return{c(){t=$("span"),t.textContent="Gaze",O(t,"class","header-sub accent svelte-15q9ttb"),z(t,"active","record"===e[2])},m(e,n){T(e,t,n)},p(e,n){4&n&&z(t,"active","record"===e[2])},d(e){e&&N(t)}}}function Bp(e){let t;return{c(){t=$("span"),t.textContent="Gallery",O(t,"class","header-sub accent svelte-15q9ttb"),z(t,"active","gallery"===e[2])},m(e,n){T(e,t,n)},p(e,n){4&n&&z(t,"active","gallery"===e[2])},d(e){e&&N(t)}}}function Hp(t){let n,r,i,s,a,l,c,u,h,d;return{c(){n=$("nav"),r=$("div"),i=$("span"),i.textContent="keyboard_arrow_up",s=P(),a=$("div"),l=$("span"),l.textContent="keyboard_arrow_down",c=P(),u=$("div"),u.innerHTML='<span class="material-icons-round svelte-15q9ttb">view_module</span>',O(i,"class","material-icons-round svelte-15q9ttb"),O(r,"class","svelte-15q9ttb"),O(l,"class","material-icons-round svelte-15q9ttb"),O(a,"class","svelte-15q9ttb"),O(u,"class","svelte-15q9ttb"),O(n,"class","svelte-15q9ttb")},m(e,o){T(e,n,o),I(n,r),I(r,i),I(n,s),I(n,a),I(a,l),I(n,c),I(n,u),h||(d=[L(i,"click",t[13]),L(l,"click",t[14]),L(u,"click",t[15])],h=!0)},p:e,d(e){e&&N(n),h=!1,o(d)}}}function Up(e){let t,n,r,i,o,s=e[0]&&Lp(),a=e[1]>=800&&"gallery"==e[2]&&Op(e),l="gallery"!==e[2]&&Dp(e),c=e[1]<800&&jp(e);return{c(){s&&s.c(),t=P(),a&&a.c(),n=P(),l&&l.c(),r=P(),c&&c.c(),i=A()},m(e,u){s&&s.m(e,u),T(e,t,u),a&&a.m(e,u),T(e,n,u),l&&l.m(e,u),T(e,r,u),c&&c.m(e,u),T(e,i,u),o=!0},p(e,[o]){e[0]?s?1&o&&ge(s,1):(s=Lp(),s.c(),ge(s,1),s.m(t.parentNode,t)):s&&(fe(),me(s,1,1,(()=>{s=null})),pe()),e[1]>=800&&"gallery"==e[2]?a?(a.p(e,o),6&o&&ge(a,1)):(a=Op(e),a.c(),ge(a,1),a.m(n.parentNode,n)):a&&(fe(),me(a,1,1,(()=>{a=null})),pe()),"gallery"!==e[2]?l?(l.p(e,o),4&o&&ge(l,1)):(l=Dp(e),l.c(),ge(l,1),l.m(r.parentNode,r)):l&&(fe(),me(l,1,1,(()=>{l=null})),pe()),e[1]<800?c?c.p(e,o):(c=jp(e),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},i(e){o||(ge(s),ge(a),ge(l),o=!0)},o(e){me(s),me(a),me(l),o=!1},d(e){s&&s.d(e),e&&N(t),a&&a.d(e),e&&N(n),l&&l.d(e),e&&N(r),c&&c.d(e),e&&N(i)}}}function Wp(e,t,n){let r,i,o,s,a,l,c,u;function h(e){let t=r.indexOf(i)+e;gp(`${r[t]}`)}d(e,Tp,(e=>n(16,r=e))),d(e,Le,(e=>n(17,i=e))),d(e,Be,(e=>n(0,o=e))),d(e,Re,(e=>n(1,s=e))),d(e,Ne,(e=>n(2,a=e))),d(e,Me,(e=>n(3,l=e))),d(e,Ze,(e=>n(4,c=e))),d(e,Qe,(e=>n(5,u=e)));return[o,s,a,l,c,u,h,()=>{v(Me,l="intro",l)},()=>{v(Me,l="about",l)},()=>{Me.set("nav")},()=>{h(-1)},()=>{h(1)},()=>{c&&u&&Df(),Ne.set("gallery")},()=>{h(-1)},()=>{h(1)},()=>{Me.set("nav")}]}class Vp extends Se{constructor(e){super(),Ie(this,e,Wp,Up,a,{})}}function Gp(t){let n,r,i,o,s,a,l,c,u,h;return{c(){n=$("p"),n.textContent="In order to generate a visualization of your viewing session, well ask you to\r\n  study a piece of artwork for 15 seconds with your webcam turned on.",r=P(),i=$("p"),i.innerHTML="<strong>No personal information will be recorded.</strong> The only information\n  that will be recorded is a series of points corresponding to your eye movement.\n  Please enable webcam permission to proceed!",o=P(),s=$("p"),s.innerHTML="This should take about 5 minutes total. Before we get started, <strong>please enter your name (or whichever name you&#39;d like to associate your\n    gaze).</strong>",a=P(),l=$("div"),c=$("input"),O(c,"placeholder","Enter name here"),O(c,"class","svelte-18tyie7"),O(l,"class","input-wrapper svelte-18tyie7")},m(e,d){T(e,n,d),T(e,r,d),T(e,i,d),T(e,o,d),T(e,s,d),T(e,a,d),T(e,l,d),I(l,c),F(c,t[0]),u||(h=L(c,"input",t[2]),u=!0)},p(e,[t]){1&t&&c.value!==e[0]&&F(c,e[0])},i:e,o:e,d(e){e&&N(n),e&&N(r),e&&N(i),e&&N(o),e&&N(s),e&&N(a),e&&N(l),u=!1,h()}}}function Yp(e,t,n){let r;d(e,rt,(e=>n(3,r=e)));let{userName:i=""}=t,{currSection:o}=t;return e.$$set=e=>{"userName"in e&&n(0,i=e.userName),"currSection"in e&&n(1,o=e.currSection)},e.$$.update=()=>{1&e.$$.dirty&&i.length>1&&(v(rt,r=i,r),n(1,o.disableNext=!1,o))},[i,o,function(){i=this.value,n(0,i)}]}class Kp extends Se{constructor(e){super(),Ie(this,e,Yp,Gp,a,{userName:0,currSection:1})}}function Zp(t){let n;return{c(){n=$("p"),n.textContent="Well need to first calibrate your webcam in order to proceed. Ensure that\r\n    your are in a well-lit environment, and that your face is in the green\r\n    section of the screen below.",O(n,"class","inst")},m(e,t){T(e,n,t)},p:e,d(e){e&&N(n)}}}function Qp(e){let t,n,r,i,o,s;return{c(){t=$("p"),n=R("Your webcam was already calibrated with an accuracy rate of "),r=$("strong"),i=R(e[2]),o=R("%"),s=R(". Please ensure your face is centered below, then click to proceed and view\r\n    art!"),O(t,"class","inst")},m(e,a){T(e,t,a),I(t,n),I(t,r),I(r,i),I(r,o),I(t,s)},p(e,t){4&t&&D(i,e[2])},d(e){e&&N(t)}}}function Xp(e){let t;return{c(){t=$("div"),t.innerHTML="<p>Initializing Video Stream...</p>",O(t,"class","video-wrapper glow svelte-10bw9l4")},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function Jp(t){let n,r;function i(e,t){return 1==e[0]?Qp:0==e[0]?Zp:void 0}let o=i(t),s=o&&o(t),a=!t[1]&&Xp();return{c(){s&&s.c(),n=P(),a&&a.c(),r=A()},m(e,t){s&&s.m(e,t),T(e,n,t),a&&a.m(e,t),T(e,r,t)},p(e,[t]){o===(o=i(e))&&s?s.p(e,t):(s&&s.d(1),s=o&&o(e),s&&(s.c(),s.m(n.parentNode,n))),e[1]?a&&(a.d(1),a=null):a||(a=Xp(),a.c(),a.m(r.parentNode,r))},i:e,o:e,d(e){s&&s.d(e),e&&N(n),a&&a.d(e),e&&N(r)}}}function eg(e,t,n){let r,i,o;d(e,Qe,(e=>n(1,r=e))),d(e,Ze,(e=>n(3,i=e))),d(e,Je,(e=>n(2,o=e)));let{calibrated:s}=t;return e.$$set=e=>{"calibrated"in e&&n(0,s=e.calibrated)},e.$$.update=()=>{10&e.$$.dirty&&i&&(r?async function(){let e=document.querySelector("#webgazerVideoContainer");document.querySelector(".container-body").append(e),await webgazer.resume(),qf(),zf()}():setTimeout((()=>{!async function(){console.log("gazer video init"),await webgazer.resume(),qf(),zf(),Qe.set(!0),console.log("video done init")}()}),200))},[s,r,o,i]}class tg extends Se{constructor(e){super(),Ie(this,e,eg,Jp,a,{calibrated:0})}}function ng(e,t,n){const r=e.slice();return r[10]=t[n],r}function rg(e){let t;function n(e,t){return e[1]>e[3]||1==e[4]?ag:sg}let r=n(e),i=r(e);return{c(){i.c(),t=A()},m(e,n){i.m(e,n),T(e,t,n)},p(e,o){r===(r=n(e))&&i?i.p(e,o):(i.d(1),i=r(e),i&&(i.c(),i.m(t.parentNode,t)))},d(e){i.d(e),e&&N(t)}}}function ig(e){let t,n,r,i,o,s,a;return{c(){t=$("p"),t.textContent="Great work! Now stare at the dot at the center of the screen for 5 seconds\r\n    so we can calculate your accuracy rate!",n=P(),r=$("div"),r.textContent="Start staring!",i=P(),o=$("div"),O(t,"class","svelte-19g2675"),O(r,"class","clickable btn btn-stare accent svelte-19g2675"),z(r,"disabled",e[2]),O(o,"class","center-dot svelte-19g2675")},m(l,c){T(l,t,c),T(l,n,c),T(l,r,c),T(l,i,c),T(l,o,c),s||(a=L(r,"click",e[7]),s=!0)},p(e,t){4&t&&z(r,"disabled",e[2])},d(e){e&&N(t),e&&N(n),e&&N(r),e&&N(i),e&&N(o),s=!1,a()}}}function og(e){let t,n=e[5],r=[];for(let t=0;t<n.length;t+=1)r[t]=lg(ng(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=A()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);T(e,t,n)},p(e,i){if(96&i){let o;for(n=e[5],o=0;o<n.length;o+=1){const s=ng(e,n,o);r[o]?r[o].p(s,i):(r[o]=lg(s),r[o].c(),r[o].m(t.parentNode,t))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(e){M(r,e),e&&N(t)}}}function sg(e){let t,n,r,i,o,s,a,l,c,u,h;return{c(){t=$("p"),n=R("Your calculated accuracy is "),r=$("strong"),i=R(e[1]),o=R("%"),s=R("."),a=P(),l=$("p"),c=R("Unfortunately we require an accuracy rate of "),u=R(e[3]),h=R("% or\r\n      higher to proceed! Please re-do your calibration, or exit to gallery."),q(t,"color","var(--color-neg)"),O(t,"class","svelte-19g2675"),O(l,"class","svelte-19g2675")},m(e,d){T(e,t,d),I(t,n),I(t,r),I(r,i),I(r,o),I(t,s),T(e,a,d),T(e,l,d),I(l,c),I(l,u),I(l,h)},p(e,t){2&t&&D(i,e[1]),8&t&&D(u,e[3])},d(e){e&&N(t),e&&N(a),e&&N(l)}}}function ag(e){let t,n,r,i,o,s,a,l,c,u,h,d,f,p=100-e[1]+"";return{c(){t=$("p"),n=R("Your calculated accuracy is "),r=$("strong"),i=R(e[1]),o=R("%"),s=R("!"),a=P(),l=$("p"),c=R("This means that the eye tracker can detect your eye movements with a\r\n      margin of error of "),u=R(p),h=R("% of the size of the container\r\n      that holds this text."),d=P(),f=$("p"),f.textContent="Not perfect, but good enough to deduce patterns in how you look at art!\r\n      Lastly, please look at the selected piece of artwork (full-screen) for 20\r\n      seconds, and well generate a custom visual summarizing how you viewed the\r\n      painting.",q(t,"color","var(--color-pos)"),O(t,"class","svelte-19g2675"),O(l,"class","svelte-19g2675"),O(f,"class","svelte-19g2675")},m(e,p){T(e,t,p),I(t,n),I(t,r),I(r,i),I(r,o),I(t,s),T(e,a,p),T(e,l,p),I(l,c),I(l,u),I(l,h),T(e,d,p),T(e,f,p)},p(e,t){2&t&&D(i,e[1]),2&t&&p!==(p=100-e[1]+"")&&D(u,p)},d(e){e&&N(t),e&&N(a),e&&N(l),e&&N(d),e&&N(f)}}}function lg(t){let n,r,i;return{c(){n=$("div"),O(n,"class","calibration-pt svelte-19g2675"),q(n,"top",t[10].top),q(n,"right",t[10].right),O(n,"numclicks","0")},m(e,o){T(e,n,o),r||(i=L(n,"click",t[6]),r=!0)},p:e,d(e){e&&N(n),r=!1,i()}}}function cg(t){let n;function r(e,t){return"dots"==e[0]?og:"stare"==e[0]?ig:"done"==e[0]?rg:void 0}let i=r(t),o=i&&i(t);return{c(){o&&o.c(),n=A()},m(e,t){o&&o.m(e,t),T(e,n,t)},p(e,[t]){i===(i=r(e))&&o?o.p(e,t):(o&&o.d(1),o=i&&i(e),o&&(o.c(),o.m(n.parentNode,n)))},i:e,o:e,d(e){o&&o.d(e),e&&N(n)}}}function ug(e,t,n){let r,i,o;d(e,Je,(e=>n(1,r=e))),d(e,et,(e=>n(3,i=e))),d(e,it,(e=>n(4,o=e)));let s="dots";!async function(){webgazer.addMouseEventListeners()}();let a=4,l=4;1==o&&(a=1,l=1),o&&v(et,i=-50,i);let c,u=[];for(let e=0;e<a;e++){let t=7,n=5,r=n+(95-n)/(a-1)*e,i=(93-t)/(l-1);for(let e=0;e<l;e++){let n=t+i*e;u.push({top:`${r}%`,right:`${n}%`,numClicks:0})}}return e.$$.update=()=>{3&e.$$.dirty&&("stare"==s&&zf(),r&&n(0,s="done")),e.$$.dirty},[s,r,c,i,o,u,function(e){let t=parseInt(this.getAttribute("numclicks"))+1;this.setAttribute("numclicks",t),this.style.opacity=1-t*(1/3),3==t&&function(){let e=document.querySelectorAll(".calibration-pt"),t=!0;return e.forEach((e=>{parseInt(e.getAttribute("numclicks"))<3&&(t=!1)})),t}()&&n(0,s="stare")},()=>{n(2,c=!0),jf()}]}class hg extends Se{constructor(e){super(),Ie(this,e,ug,cg,a,{})}}function dg(t){let n,r,i;return{c(){n=$("p"),n.textContent="Great! Your face calibration will be displayed on the right for reference.\r\n  Next, well calibrate your eye tracking movement on the screen. Remember these\r\n  two rules!",r=P(),i=$("div"),i.innerHTML='<div class="svelte-1i27hj5"><p class="svelte-1i27hj5">#1: Eyes on cursor at all times</p> \n    <img src="./assets/img/explain-eye.svg"/></div> \n  <div class="svelte-1i27hj5"><p class="svelte-1i27hj5">#2: Move cursor to each red dot, and click on dot until it disappears</p> \n    <img src="./assets/img/explain-cursor.svg"/></div>',O(n,"class","instr svelte-1i27hj5"),O(i,"class","explain svelte-1i27hj5")},m(e,t){T(e,n,t),T(e,r,t),T(e,i,t)},p:e,i:e,o:e,d(e){e&&N(n),e&&N(r),e&&N(i)}}}class fg extends Se{constructor(e){super(),Ie(this,e,null,dg,a,{})}}function pg(t){let n,r,i,o,s,a;return{c(){n=$("div"),r=$("div"),i=$("img"),s=P(),a=$("p"),a.textContent="Please look at the following image for 20 seconds",O(i,"id","artView"),c(i.src,o=t[1].url)||O(i,"src",o),O(i,"class","svelte-1iaoraq"),z(i,"inactive",1==t[0]),O(a,"class","svelte-1iaoraq"),z(a,"inactive",0==t[0]),O(r,"class","img-holder svelte-1iaoraq"),O(n,"class","wrapper-full svelte-1iaoraq")},m(e,t){T(e,n,t),I(n,r),I(r,i),I(r,s),I(r,a)},p(e,[t]){2&t&&!c(i.src,o=e[1].url)&&O(i,"src",o),1&t&&z(i,"inactive",1==e[0]),1&t&&z(a,"inactive",0==e[0])},i:e,o:e,d(e){e&&N(n)}}}function gg(e,t,n){let r;d(e,$e,(e=>n(1,r=e)));let i=!0;return setTimeout((()=>{n(0,i=!1),async function(){let e,t=document.querySelector("#artView").getBoundingClientRect();webgazer.setGazeListener((function(e,n){if(null==e)return;let r={time:n,x:e.x-t.x,y:e.y-t.y,xPct:100*(e.x-t.x)/t.width,yPct:100*(e.y-t.y)/t.height,xMin:t.left,xMax:t.right,yMin:t.top,yMax:t.bottom,sessionID:h(nt),work:h(selectedImage).key,calibrationPct:h(Je)},i=h(Ge);i.push(r),Ge.set(i)})),e=1==h(it)?1e3:2e4,setTimeout((()=>{webgazer.clearGazeListener(),console.log("session data",h(Ge)),Xe.set(h(Xe)+1)}),e)}()}),3e3),[i,r]}class mg extends Se{constructor(e){super(),Ie(this,e,gg,pg,a,{})}}function _g(e,t,n){const r=e.slice();return r[47]=t[n],r}function vg(e,t,n){const r=e.slice();return r[14]=t[n],r}function yg(e){let t,n,r,i;return n=new hf({}),{c(){t=$("div"),be(n.$$.fragment)},m(e,r){T(e,t,r),Ce(n,t,null),i=!0},i(e){i||(ge(n.$$.fragment,e),re((()=>{r||(r=ve(t,lt,{duration:100},!0)),r.run(1)})),i=!0)},o(e){me(n.$$.fragment,e),r||(r=ve(t,lt,{duration:100},!1)),r.run(0),i=!1},d(e){e&&N(t),xe(n),e&&r&&r.end()}}}function wg(e){let t,n,r,i,s,a;function l(...t){return e[27](e[14],...t)}return{c(){t=$("div"),n=$("div"),n.innerHTML='<span class="material-icons-round md-18 nav" style="font-size: 20px; color: white">edit_location</span>',O(n,"class","reaction-pin-inner"),O(t,"class","reaction-pin"),q(t,"left",e[17]("x",e[14].xPct)+"px"),q(t,"top",e[17]("y",e[14].yPct)+"px")},m(r,o){T(r,t,o),I(t,n),i=!0,s||(a=[L(t,"click",l),L(t,"mouseover",e[28]),L(t,"mousemove",e[29]),L(t,"mouseleave",e[30])],s=!0)},p(n,r){e=n,(!i||1&r[0])&&q(t,"left",e[17]("x",e[14].xPct)+"px"),(!i||1&r[0])&&q(t,"top",e[17]("y",e[14].yPct)+"px")},i(e){i||(re((()=>{r||(r=ve(t,lt,{duration:300},!0)),r.run(1)})),i=!0)},o(e){r||(r=ve(t,lt,{duration:300},!1)),r.run(0),i=!1},d(e){e&&N(t),e&&r&&r.end(),s=!1,o(a)}}}function bg(e){let t,n,r,i,s,a,l,c,u,h,d,f,p,g,m,_,v,y,w,b,C,x,k;function S(e,t){return"edit"==e[11]?xg:Cg}let E=S(e),R=E(e),A=e[15],D=[];for(let t=0;t<A.length;t+=1)D[t]=kg(_g(e,A,t));let j="edit"==e[11]&&Ig(e);function B(e,t){return"edit"==e[11]?Eg:Sg}let H=B(e),U=H(e);return{c(){t=$("div"),n=$("div"),r=$("p"),R.c(),i=P(),s=$("div"),a=$("p"),a.textContent="Emoji",l=P(),c=$("p"),c.textContent="Text",u=P(),h=$("div"),d=$("textarea"),f=P(),p=$("div");for(let e=0;e<D.length;e+=1)D[e].c();g=P(),m=$("div"),j&&j.c(),_=P(),v=$("p"),v.textContent="Cancel",y=P(),w=$("p"),U.c(),q(r,"font-weight","600"),q(r,"font-size","16px"),O(a,"class","clickable svelte-tm2jen"),z(a,"selected","emoji"==e[8]),O(c,"class","clickable svelte-tm2jen"),z(c,"selected","text"==e[8]),O(s,"class","emoji-mode svelte-tm2jen"),O(n,"class","overlay-header svelte-tm2jen"),O(d,"id","story"),O(d,"name","story"),O(d,"placeholder","Enter your thoughts below"),O(d,"class","svelte-tm2jen"),z(d,"hidden","emoji"==e[8]),O(p,"class","emoji-holder svelte-tm2jen"),z(p,"hidden","text"==e[8]),O(h,"class","overlay-body svelte-tm2jen"),O(v,"class","clickable action cancel btn-light svelte-tm2jen"),O(w,"class","clickable action submit svelte-tm2jen"),O(m,"class","overlay-footer svelte-tm2jen"),O(t,"class","overlay svelte-tm2jen"),q(t,"left",e[9]+"px"),q(t,"top",e[10]+"px")},m(o,b){T(o,t,b),I(t,n),I(n,r),R.m(r,null),I(n,i),I(n,s),I(s,a),I(s,l),I(s,c),I(t,u),I(t,h),I(h,d),F(d,e[2]),I(h,f),I(h,p);for(let e=0;e<D.length;e+=1)D[e].m(p,null);I(t,g),I(t,m),j&&j.m(m,null),I(m,_),I(m,v),I(m,y),I(m,w),U.m(w,null),C=!0,x||(k=[L(a,"click",e[31]),L(c,"click",e[32]),L(d,"input",e[33]),L(v,"click",e[19]),L(w,"click",e[21])],x=!0)},p(e,n){if(E!==(E=S(e))&&(R.d(1),R=E(e),R&&(R.c(),R.m(r,null))),256&n[0]&&z(a,"selected","emoji"==e[8]),256&n[0]&&z(c,"selected","text"==e[8]),4&n[0]&&F(d,e[2]),256&n[0]&&z(d,"hidden","emoji"==e[8]),49152&n[0]){let t;for(A=e[15],t=0;t<A.length;t+=1){const r=_g(e,A,t);D[t]?D[t].p(r,n):(D[t]=kg(r),D[t].c(),D[t].m(p,null))}for(;t<D.length;t+=1)D[t].d(1);D.length=A.length}256&n[0]&&z(p,"hidden","text"==e[8]),"edit"==e[11]?j?j.p(e,n):(j=Ig(e),j.c(),j.m(m,_)):j&&(j.d(1),j=null),H!==(H=B(e))&&(U.d(1),U=H(e),U&&(U.c(),U.m(w,null))),(!C||512&n[0])&&q(t,"left",e[9]+"px"),(!C||1024&n[0])&&q(t,"top",e[10]+"px")},i(e){C||(re((()=>{b||(b=ve(t,lt,{duration:150},!0)),b.run(1)})),C=!0)},o(e){b||(b=ve(t,lt,{duration:150},!1)),b.run(0),C=!1},d(e){e&&N(t),R.d(),M(D,e),j&&j.d(),U.d(),e&&b&&b.end(),x=!1,o(k)}}}function Cg(e){let t;return{c(){t=R("Add Reaction")},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function xg(e){let t;return{c(){t=R("Edit Reaction")},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function kg(e){let t,n,r,i,o,s=e[47]+"";function a(...t){return e[34](e[47],...t)}return{c(){t=$("div"),n=R(s),r=P(),O(t,"class","emoji svelte-tm2jen"),z(t,"selected",e[14].emoji.includes(e[47]))},m(e,s){T(e,t,s),I(t,n),I(t,r),i||(o=L(t,"click",a),i=!0)},p(n,r){e=n,49152&r[0]&&z(t,"selected",e[14].emoji.includes(e[47]))},d(e){e&&N(t),i=!1,o()}}}function Ig(t){let n,r,i;return{c(){n=$("p"),n.textContent="Delete",O(n,"class","clickable action delete svelte-tm2jen")},m(e,o){T(e,n,o),r||(i=L(n,"click",t[22]),r=!0)},p:e,d(e){e&&N(n),r=!1,i()}}}function Sg(e){let t;return{c(){t=R("Add Reaction")},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function Eg(e){let t;return{c(){t=R("Submit Edit")},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function Tg(e){let t,n,r,i,s,a,l,u,h,d,f,p,g,m,_,v,y,w,b=e[0].length+"",C=e[13]&&yg(),x=e[0],k=[];for(let t=0;t<x.length;t+=1)k[t]=wg(vg(e,x,t));const S=e=>me(k[e],1,1,(()=>{k[e]=null}));let E=e[7]&&bg(e);return{c(){t=$("p"),t.innerHTML="We&#39;re almost done here! As a last step, please <strong>share how viewing this artwork made you feel</strong>. Click on any place in the image to add an emoji or text reaction! Add as\n  many as you like.",n=P(),C&&C.c(),r=P(),i=$("div"),s=$("img"),l=P();for(let e=0;e<k.length;e+=1)k[e].c();u=P(),h=$("div"),d=$("span"),d.textContent="add_location",f=P(),E&&E.c(),p=P(),g=$("div"),m=R(b),_=R(" reactions added"),c(s.src,a=e[12].url)||O(s,"src",a),O(s,"class","svelte-tm2jen"),O(d,"class","material-icons-round md-18 nav"),q(d,"font-size","20px"),q(d,"color","black"),O(h,"class","hoverEffect svelte-tm2jen"),q(h,"left",e[3]+"px"),q(h,"top",e[4]+"px"),z(h,"show",e[5]),O(i,"class","img-holder svelte-tm2jen"),O(g,"class","reaction-count svelte-tm2jen")},m(o,a){T(o,t,a),T(o,n,a),C&&C.m(o,a),T(o,r,a),T(o,i,a),I(i,s),e[23](s),I(i,l);for(let e=0;e<k.length;e+=1)k[e].m(i,null);I(i,u),I(i,h),I(h,d),I(i,f),E&&E.m(i,null),e[35](i),T(o,p,a),T(o,g,a),I(g,m),I(g,_),v=!0,y||(w=[L(s,"click",e[24]),L(s,"mousemove",e[25]),L(s,"mouseleave",e[26])],y=!0)},p(e,t){if(e[13]?C?8192&t[0]&&ge(C,1):(C=yg(),C.c(),ge(C,1),C.m(r.parentNode,r)):C&&(fe(),me(C,1,1,(()=>{C=null})),pe()),(!v||4096&t[0]&&!c(s.src,a=e[12].url))&&O(s,"src",a),1179681&t[0]){let n;for(x=e[0],n=0;n<x.length;n+=1){const r=vg(e,x,n);k[n]?(k[n].p(r,t),ge(k[n],1)):(k[n]=wg(r),k[n].c(),ge(k[n],1),k[n].m(i,u))}for(fe(),n=x.length;n<k.length;n+=1)S(n);pe()}(!v||8&t[0])&&q(h,"left",e[3]+"px"),(!v||16&t[0])&&q(h,"top",e[4]+"px"),32&t[0]&&z(h,"show",e[5]),e[7]?E?(E.p(e,t),128&t[0]&&ge(E,1)):(E=bg(e),E.c(),ge(E,1),E.m(i,null)):E&&(fe(),me(E,1,1,(()=>{E=null})),pe()),(!v||1&t[0])&&b!==(b=e[0].length+"")&&D(m,b)},i(e){if(!v){ge(C);for(let e=0;e<x.length;e+=1)ge(k[e]);ge(E),v=!0}},o(e){me(C),k=k.filter(Boolean);for(let e=0;e<k.length;e+=1)me(k[e]);me(E),v=!1},d(s){s&&N(t),s&&N(n),C&&C.d(s),s&&N(r),s&&N(i),e[23](null),M(k,s),E&&E.d(),e[35](null),s&&N(p),s&&N(g),y=!1,o(w)}}}function Ng(e,t,n){let r,i,o,s,a,l,c;d(e,it,(e=>n(39,r=e))),d(e,Ge,(e=>n(40,i=e))),d(e,nt,(e=>n(41,o=e))),d(e,rt,(e=>n(42,s=e))),d(e,$e,(e=>n(12,a=e))),d(e,Ye,(e=>n(43,l=e))),d(e,Be,(e=>n(13,c=e)));let u,h,f,p,g,m,_,y,w={},b=[],C=1;function x(){n(14,w={id:C,xPct:null,yPct:null,emoji:[],text:null}),n(3,h=3e4),n(4,f=4e4),n(2,u="")}x();let k,I,S,E=!1,T="emoji";function N(e){E||(n(3,h=e.clientX-m.left),n(4,f=e.layerY))}function M(e,t){return"x"==e?_.left+_.width*t-m.left:"y"==e?_.height*t:void 0}function $(e){n(11,S="add"),_=y.getBoundingClientRect(),n(14,w.xPct=(e.clientX-_.left)/_.width,w),n(14,w.yPct=e.layerY/_.height,w),n(9,k=M("x",w.xPct)),n(10,I=M("y",w.yPct)),n(7,E=!0)}function R(e,t){console.log("edit called"),n(11,S="edit"),t.text?n(8,T="text"):n(8,T="emoji"),n(14,w=t),n(2,u=t.text),n(9,k=M("x",t.xPct)),n(10,I=M("y",t.yPct)),n(7,E=!0)}0==r&&(console.log("writing now"),async function(){await Sa("sessionData/"+o,i),await Sa("sessionData/"+o,i)}(),async function(){await Ia("works/"+a.key)||await Sa("works/"+a.key,a),await Sa("works/"+a.key+"/sessionData/"+o,{name:s})}());return e.$$.update=()=>{2&e.$$.dirty[0]&&g&&(m=g.getBoundingClientRect()),1&e.$$.dirty[0]&&v(Ye,l=b,l)},[b,g,u,h,f,p,y,E,T,k,I,S,a,c,w,["","","","","","","","","","","","","","","","","","","","",""],N,M,$,function(){x(),n(7,E=!1)},R,function(){"text"==T?(n(14,w.emoji=[],w),n(14,w.text=u,w)):n(14,w.text=null,w),"add"==S&&(n(0,b=[...b,w]),C++),x(),n(7,E=!1)},function(){n(0,b=b.filter((e=>e!==w))),x(),n(7,E=!1)},function(e){X[e?"unshift":"push"]((()=>{y=e,n(6,y)}))},e=>$(e),e=>{N(e),n(5,p=!0)},()=>{0==E&&n(5,p=!1)},(e,t)=>{R(0,e)},e=>{n(5,p=!1),df(e.x,e.y,"Edit or delete reaction")},e=>{df(e.x,e.y)},e=>{df()},()=>n(8,T="emoji"),()=>n(8,T="text"),function(){u=this.value,n(2,u)},(e,t)=>{w.emoji.includes(e)?(n(14,w.emoji=w.emoji.filter((t=>t!==e)),w),t.target.classList.remove("selected")):(w.emoji.push(e),t.target.classList.add("selected"))},function(e){X[e?"unshift":"push"]((()=>{g=e,n(1,g)}))}]}class Mg extends Se{constructor(e){super(),Ie(this,e,Ng,Tg,a,{},null,[-1,-1])}}function $g(e,t,n){const r=e.slice();return r[27]=t[n],r}function Rg(e){let t;return{c(){t=$("div"),O(t,"class","nav-dot svelte-1ah7k67"),z(t,"active",e[0][e[3]]===e[27])},m(e,n){T(e,t,n)},p(e,n){9&n&&z(t,"active",e[0][e[3]]===e[27])},d(e){e&&N(t)}}}function Pg(t){let n,r;return n=new Mg({}),{c(){be(n.$$.fragment)},m(e,t){Ce(n,e,t),r=!0},p:e,i(e){r||(ge(n.$$.fragment,e),r=!0)},o(e){me(n.$$.fragment,e),r=!1},d(e){xe(n,e)}}}function Ag(t){let n,r;return n=new mg({}),{c(){be(n.$$.fragment)},m(e,t){Ce(n,e,t),r=!0},p:e,i(e){r||(ge(n.$$.fragment,e),r=!0)},o(e){me(n.$$.fragment,e),r=!1},d(e){xe(n,e)}}}function Lg(t){let n,r;return n=new hg({}),{c(){be(n.$$.fragment)},m(e,t){Ce(n,e,t),r=!0},p:e,i(e){r||(ge(n.$$.fragment,e),r=!0)},o(e){me(n.$$.fragment,e),r=!1},d(e){xe(n,e)}}}function Og(t){let n,r;return n=new fg({}),{c(){be(n.$$.fragment)},m(e,t){Ce(n,e,t),r=!0},p:e,i(e){r||(ge(n.$$.fragment,e),r=!0)},o(e){me(n.$$.fragment,e),r=!1},d(e){xe(n,e)}}}function Dg(e){let t,n;return t=new tg({props:{calibrated:e[7]}}),{c(){be(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},p(e,n){const r={};128&n&&(r.calibrated=e[7]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function Fg(e){let t,n,r,i;function o(t){e[15](t)}let s={};return void 0!==e[1]&&(s.currSection=e[1]),n=new Kp({props:s}),X.push((()=>we(n,"currSection",o))),{c(){t=$("div"),be(n.$$.fragment)},m(e,r){T(e,t,r),Ce(n,t,null),i=!0},p(e,t){const i={};!r&&2&t&&(r=!0,i.currSection=e[1],ie((()=>r=!1))),n.$set(i)},i(e){i||(ge(n.$$.fragment,e),i=!0)},o(e){me(n.$$.fragment,e),i=!1},d(e){e&&N(t),xe(n)}}}function qg(e){let t,n,r,i,o=e[0][e[3]].btnBackLabel+"";return{c(){t=$("div"),n=R(o),O(t,"class","btn-prev btn disabled btn-light svelte-1ah7k67"),z(t,"accent",e[2]&&e[2]<70&&1!==e[8]),z(t,"disabled",1==e[4])},m(o,s){T(o,t,s),I(t,n),r||(i=L(t,"click",e[16]),r=!0)},p(e,r){9&r&&o!==(o=e[0][e[3]].btnBackLabel+"")&&D(n,o),260&r&&z(t,"accent",e[2]&&e[2]<70&&1!==e[8]),16&r&&z(t,"disabled",1==e[4])},d(e){e&&N(t),r=!1,i()}}}function jg(e){let t,n,r;return{c(){t=$("div"),t.textContent="Re-Calibrate",O(t,"class","btn clickable btn-light re-cal clickable svelte-1ah7k67"),z(t,"disabled",0==e[7])},m(i,o){T(i,t,o),n||(r=L(t,"click",e[10]),n=!0)},p(e,n){128&n&&z(t,"disabled",0==e[7])},d(e){e&&N(t),n=!1,r()}}}function zg(e){let t,n,r;function i(e,t){return e[9]?Hg:Bg}let o=i(e),s=o(e);return{c(){t=$("div"),s.c(),O(t,"class","btn-next btn accent clickable svelte-1ah7k67"),z(t,"disabled",e[9]||e[5]),z(t,"glow",e[9])},m(i,o){T(i,t,o),s.m(t,null),n||(r=L(t,"click",e[17]),n=!0)},p(e,n){o===(o=i(e))&&s?s.p(e,n):(s.d(1),s=o(e),s&&(s.c(),s.m(t,null))),544&n&&z(t,"disabled",e[9]||e[5]),512&n&&z(t,"glow",e[9])},d(e){e&&N(t),s.d(),n=!1,r()}}}function Bg(e){let t,n=e[0][e[3]].btnLabel+"";return{c(){t=R(n)},m(e,n){T(e,t,n)},p(e,r){9&r&&n!==(n=e[0][e[3]].btnLabel+"")&&D(t,n)},d(e){e&&N(t)}}}function Hg(t){let n;return{c(){n=R("Loading...")},m(e,t){T(e,n,t)},p:e,d(e){e&&N(n)}}}function Ug(e){let t,n,r,i,o,s,a,l,c,u,h,d,f,p,g=e[1].sectionLabel+"",m=e[0],_=[];for(let t=0;t<m.length;t+=1)_[t]=Rg($g(e,m,t));const v=[Fg,Dg,Og,Lg,Ag,Pg],y=[];function w(e,t){return"overview"==e[0][e[3]].sectionName?0:"calibrate-vid"==e[0][e[3]].sectionName?1:"calibrate-instructions"==e[0][e[3]].sectionName?2:"calibrate-exercise"==e[0][e[3]].sectionName?3:"view"==e[0][e[3]].sectionName?4:"log"==e[0][e[3]].sectionName?5:-1}function b(e,t){return e[7]&&e[3]!==e[0].length-1?jg:qg}~(c=w(e))&&(u=y[c]=v[c](e));let C=b(e),x=C(e),k=!e[6]&&zg(e);return{c(){t=$("section"),n=$("div"),r=$("div"),i=R(g),o=P(),s=$("div");for(let e=0;e<_.length;e+=1)_[e].c();a=P(),l=$("div"),u&&u.c(),h=P(),d=$("div"),x.c(),f=P(),k&&k.c(),O(r,"class","current-selection svelte-1ah7k67"),O(s,"class","nav-ind svelte-1ah7k67"),O(n,"class","container-header svelte-1ah7k67"),O(l,"class","container-body svelte-1ah7k67"),O(d,"class","container-footer svelte-1ah7k67"),O(t,"class","experiment-container svelte-1ah7k67")},m(e,u){T(e,t,u),I(t,n),I(n,r),I(r,i),I(n,o),I(n,s);for(let e=0;e<_.length;e+=1)_[e].m(s,null);I(t,a),I(t,l),~c&&y[c].m(l,null),I(t,h),I(t,d),x.m(d,null),I(d,f),k&&k.m(d,null),p=!0},p(e,[t]){if((!p||2&t)&&g!==(g=e[1].sectionLabel+"")&&D(i,g),9&t){let n;for(m=e[0],n=0;n<m.length;n+=1){const r=$g(e,m,n);_[n]?_[n].p(r,t):(_[n]=Rg(r),_[n].c(),_[n].m(s,null))}for(;n<_.length;n+=1)_[n].d(1);_.length=m.length}let n=c;c=w(e),c===n?~c&&y[c].p(e,t):(u&&(fe(),me(y[n],1,1,(()=>{y[n]=null})),pe()),~c?(u=y[c],u?u.p(e,t):(u=y[c]=v[c](e),u.c()),ge(u,1),u.m(l,null)):u=null),C===(C=b(e))&&x?x.p(e,t):(x.d(1),x=C(e),x&&(x.c(),x.m(d,f))),e[6]?k&&(k.d(1),k=null):k?k.p(e,t):(k=zg(e),k.c(),k.m(d,null))},i(e){p||(ge(u),p=!0)},o(e){me(u),p=!1},d(e){e&&N(t),M(_,e),~c&&y[c].d(),x.d(),k&&k.d()}}}function Wg(e,t,n){let r,i,o,s,a,l,c,u,h,f,p;d(e,et,(e=>n(12,r=e))),d(e,Je,(e=>n(2,i=e))),d(e,Qe,(e=>n(13,o=e))),d(e,Ze,(e=>n(14,s=e))),d(e,Xe,(e=>n(3,a=e))),d(e,Ye,(e=>n(20,l=e))),d(e,$e,(e=>n(21,c=e))),d(e,nt,(e=>n(22,u=e))),d(e,rt,(e=>n(23,h=e))),d(e,it,(e=>n(8,f=e))),d(e,tt,(e=>n(9,p=e)));let g,m=!1,_=!1,y=!1,w=!1,b=[{sectionName:"overview",sectionLabel:"Overview",videoShown:!1,btnLabel:"Start!",disableBack:!0,showLoader:!0,btnBackLabel:"Back to Overview",disableNext:!0},{sectionName:"calibrate-vid",sectionLabel:"Calibration - Align Face",videoShown:!0,videoPos:"middle",disableBack:!1,disableNext:!1,btnBackLabel:"Back to Overview",btnLabel:"Got It - Face is Aligned",showLoader:!0},{sectionName:"calibrate-instructions",sectionLabel:"Calibration - Instructions",videoShown:!0,videoPos:"top",btnBackLabel:"Back to Video Alignment",btnLabel:"Got It - Proceed"},{sectionName:"calibrate-exercise",sectionLabel:"Calibration - Exercise",videoShown:!0,videoPos:"top",disableNext:!0,btnBackLabel:"Restart Eye Calibration",btnLabel:"Proceed to View Art",gazerRecording:!0},{sectionName:"view",sectionLabel:"View",videoShown:!1,btnLabel:"Proceed",disableNext:!1,btnBackLabel:"Back to Calibration",showLoader:!0},{sectionName:"log",sectionLabel:"Add Reaction",videoShown:!1,btnLabel:"Submit Reactions and View Gaze",disableBack:!0,hideNext:!1,btnBackLabel:"Back to Results"}],C=[{sectionLabel:"Calibration - Align Face",sectionName:"calibrate-vid",videoShown:!0,videoPos:"middle",disableBack:!0,disableNext:!1,btnBackLabel:"Back to Overview",btnLabel:"Got It - Face is Aligned",showLoader:!0},b[4],b[5]],x=b;async function k(){0==f&&(await Sa("works/"+c.key+"/sessionData/"+u+"/name",h),console.log("session written to db"),await Sa("reactions/"+u,l),console.log("reaction written to db")),new MutationObserver((e=>{e[0].removedNodes.length>0&&(De.set(c.key),Ne.set("gallery"))})).observe(document.querySelector(".container-body"),{childList:!0,subtree:!1,characterDataOldValue:!0}),Df(),v(Ye,l=[],l)}!async function(){let e=await Of.getItem("webgazerGlobalData"),t=await Of.getItem("calibrationPct");Je.set(t),e&&(e.length>20&&t>r?(n(0,x=C),n(7,w=!0)):n(0,x=b))}(),Z((()=>{Xe.set(0),u||nt.set((new Date).getTime()),s||(console.log("gazer first init"),webgazer.showVideo(!1),webgazer.begin(),Ff()),document.querySelector("body").className="gaze"}));return e.$$.update=()=>{11&e.$$.dirty&&(n(1,g=x[a]),g.disableBack?n(4,m=!0):n(4,m=!1),g.disableNext?n(5,_=!0):n(5,_=!1),g.hideNext?n(6,y=!0):n(6,y=!1)),8194&e.$$.dirty&&(1==g.videoShown&&1==o?(webgazer.showVideo(!0),function(e){let t=document.querySelector("#webgazerVideoContainer"),n=320;"top"==e?(n=110,webgazer.setVideoViewerSize(n,n),t.style.top="0%",t.style.left="90%",t.style.width=`${n}px`,t.style.height="auto"):"middle"==e&&(webgazer.setVideoViewerSize(n,n),t.style.width=`${n}px`,t.style.height="auto",t.style.position="absolute",t.style.left="50%",t.style.top="30%",t.style.transform="translate(-50%, -50%)")}(g.videoPos)):webgazer.showVideo(!1)),24578&e.$$.dirty&&(b[0].loadingVar=s,b[1].loadingVar=o,C[0].loadingVar=o,g&&(1!=g.showLoader||g.loadingVar?tt.set(!1):tt.set(!0))),4100&e.$$.dirty&&i>r&&n(5,_=!1)},[x,g,i,a,m,_,y,w,f,p,function(){n(7,w=!1),n(0,x=b),Je.set(null),webgazer.clearData()},k,r,o,s,function(e){g=e,n(1,g),n(0,x),n(3,a)},()=>{"calibrate-exercise"==x[a].sectionName&&(console.log("uh restarting i guess"),Je.set(null)),v(Xe,a--,a)},()=>{a<x.length-2?v(Xe,a++,a):k()}]}class Vg extends Se{constructor(e){super(),Ie(this,e,Wg,Ug,a,{})}}function Gg(e){let t,n,r;const i=e[2].default,o=f(i,e,e[1],null);return{c(){t=$("main"),o&&o.c(),O(t,"id","modal"),O(t,"class","svelte-li4y8f")},m(e,n){T(e,t,n),o&&o.m(t,null),r=!0},p(e,[t]){o&&o.p&&(!r||2&t)&&m(o,i,e,e[1],r?g(i,e[1],t,null):_(e[1]),null)},i(i){r||(ge(o,i),re((()=>{n||(n=ve(t,e[0],{duration:300},!0)),n.run(1)})),r=!0)},o(i){me(o,i),n||(n=ve(t,e[0],{duration:300},!1)),n.run(0),r=!1},d(e){e&&N(t),o&&o.d(e),e&&n&&n.end()}}}function Yg(e,t,n){let{$$slots:r={},$$scope:i}=t;return e.$$set=e=>{"$$scope"in e&&n(1,i=e.$$scope)},[function(e,t){const n=ct(e,t);return{duration:t.duration,css:e=>`\n\t\t\t\t${n.css(e)}\n\t\t\t\topacity: ${e};\n\t\t\t`}},i,r]}class Kg extends Se{constructor(e){super(),Ie(this,e,Yg,Gg,a,{})}}function Zg(e,t,n){const r=e.slice();return r[5]=t[n],r}function Qg(e){let t,n,r,i,o,s,a,l,u,h,d,f,p,g,m,_=e[5].title+"",v=e[5].artist+"";function y(){return e[3](e[5])}return{c(){t=$("div"),n=$("div"),r=$("img"),o=P(),s=$("div"),a=$("p"),l=$("strong"),u=R(_),h=P(),d=$("p"),f=R(v),p=P(),c(r.src,i=em(e[5].url))||O(r,"src",i),O(r,"class","svelte-qtkwvv"),O(n,"class","img-holder svelte-qtkwvv"),O(a,"class","svelte-qtkwvv"),O(d,"class","svelte-qtkwvv"),O(s,"class","txt-holder svelte-qtkwvv"),O(t,"class","artwork-holder clickable svelte-qtkwvv")},m(e,i){T(e,t,i),I(t,n),I(n,r),I(t,o),I(t,s),I(s,a),I(a,l),I(l,u),I(s,h),I(s,d),I(d,f),I(t,p),g||(m=L(t,"click",y),g=!0)},p(t,n){e=t,1&n&&!c(r.src,i=em(e[5].url))&&O(r,"src",i),1&n&&_!==(_=e[5].title+"")&&D(u,_),1&n&&v!==(v=e[5].artist+"")&&D(f,v)},d(e){e&&N(t),g=!1,m()}}}function Xg(e){let t,n,r,i,o,s,a,l,c,u=e[0],h=[];for(let t=0;t<u.length;t+=1)h[t]=Qg(Zg(e,u,t));return{c(){t=$("div"),n=$("div"),r=$("h1"),r.textContent="Navigate Artworks",i=P(),o=$("div"),o.innerHTML='<span class="material-icons-round">close</span>',s=P(),a=$("div");for(let e=0;e<h.length;e+=1)h[e].c();O(o,"class","btn clickable svelte-qtkwvv"),O(n,"class","cont-header svelte-qtkwvv"),O(a,"class","artwork-container svelte-qtkwvv"),O(t,"class","container svelte-qtkwvv")},m(u,d){T(u,t,d),I(t,n),I(n,r),I(n,i),I(n,o),I(t,s),I(t,a);for(let e=0;e<h.length;e+=1)h[e].m(a,null);l||(c=L(o,"click",e[2]),l=!0)},p(e,t){if(3&t){let n;for(u=e[0],n=0;n<u.length;n+=1){const r=Zg(e,u,n);h[n]?h[n].p(r,t):(h[n]=Qg(r),h[n].c(),h[n].m(a,null))}for(;n<h.length;n+=1)h[n].d(1);h.length=u.length}},d(e){e&&N(t),M(h,e),l=!1,c()}}}function Jg(e){let t,n;return t=new Kg({props:{$$slots:{default:[Xg]},$$scope:{ctx:e}}}),{c(){be(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},p(e,[n]){const r={};257&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function em(e){let t=e.lastIndexOf("/");return e.substring(0,t)+"/lowres/"+e.substring(t+1)}function tm(e,t,n){let r;function i(e){gp(`${e.key}`),Me.set(null)}d(e,Np,(e=>n(0,r=e)));return[r,i,()=>{Me.set(null)},e=>{i(e)}]}class nm extends Se{constructor(e){super(),Ie(this,e,tm,Jg,a,{})}}function rm(e){let t,n,r;return{c(){t=$("div"),t.innerHTML='<svg width="1135" height="1068" viewBox="0 0 1135 1068" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-1tulok6"><g id="Group 93" class="svelte-1tulok6"><g id="squiggles" class="svelte-1tulok6"><path id="Fill-3" fill-rule="evenodd" clip-rule="evenodd" d="M516.161 286.709C520.795 296.401 523.546 305.412 508.536 302.95C499.477 315.551 499.403 345.362 477.296 341.14C466.301 341.849 438.449 321.246 437.196 339.271C445.814 421.444 391.321 358.677 379.947 378.142C374.798 391.851 378.297 409.153 368.53 420.605C341.658 428.571 349.401 386.074 352.378 370.503C370.466 312.153 407.45 366.12 412.634 347.575C411.33 332.52 416.502 318.678 426.729 307.801C440.304 295.556 458.808 315.057 474.773 314.201C489.121 316.514 490.762 246.88 516.161 286.709Z" fill="#3BC5FF"></path><path id="Fill-5" fill-rule="evenodd" clip-rule="evenodd" d="M528.019 512.029C532.961 508.26 540.046 508.008 547.334 510.173C575.345 521.452 546.284 482.436 581.43 468.96C605.364 460.983 602.722 482.338 624.783 456.446C647.558 446.125 639.754 514.404 598.8 492.076C577.702 489.063 598.504 531.458 579.174 538.855C570.751 545.393 560.237 541.083 550.834 539.742C528.056 536.863 532.552 573.937 518.389 585.414C514.24 590.856 508.592 590.338 503.607 587.799C477.169 575.258 509.13 522.676 528.019 512.029Z" fill="#3BC5FF"></path><path id="Fill-7" fill-rule="evenodd" clip-rule="evenodd" d="M450.918 438.19C464.202 431.183 498.007 455.28 494.226 441.41C493.508 433.101 496.268 425.544 498.942 418.139C509.65 385.634 544.388 415.135 551.628 401.02C554.125 388.767 559.542 387.803 569.329 392.656C572.977 394.227 578.643 400.719 573.883 403.523C568.086 406.663 567.66 411.759 566.91 417.256C562.144 444.374 520.366 409.519 516.671 437.54C522.69 513.002 467.767 448.34 462.23 475.511C456.134 488.761 460.024 515.086 439.402 512.191C411.124 514.978 439.356 447.269 450.918 438.19Z" fill="#3BC5FF"></path></g><g id="mag" class="svelte-1tulok6"><path id="Fill-1" fill-rule="evenodd" clip-rule="evenodd" d="M677 176.148C676.343 206.467 685.438 235.224 707.618 256.675C723.726 274.829 731.615 302.171 758.184 307.789C840.706 342.894 960.776 300.08 979.167 206.586C992.238 162.603 956.138 131.695 931.18 101.377C908.197 71.1915 870.93 61.9675 835.603 55.3765C819.622 57.1235 798.984 57.3565 786.188 67.7255C783.54 71.0315 779.553 72.1205 776.528 69.8175C766.465 63.5735 757.297 74.9115 748.004 77.8955C710.256 97.0415 674.875 130.726 677 176.148ZM645.049 188.624C642.911 108.153 697.352 61.2565 771.249 46.0145C811.485 17.6275 873.754 28.1615 917.073 49.0055C937.108 60.4135 955.269 74.6225 966.622 95.1035C976.237 109.927 991.291 121.187 995.572 139.13C1026.38 213.231 971.294 300.112 898.668 324.066C853.109 345.509 802.283 346.667 754.484 332.835C733.536 328.803 710.559 321.397 698.995 302.148C669.271 257.233 645.906 248.125 645.049 188.624Z" fill="#FF3C54"></path><path id="Fill-9" fill-rule="evenodd" clip-rule="evenodd" d="M1034.13 477.48C1036.5 456.135 1063.61 421.762 1087.36 439.377C1096.63 444.45 1067 491.951 1057.74 489.268C1056.25 489.201 1054.43 490.76 1053.18 491.99C1044.03 500.499 1029.42 488.459 1034.13 477.48Z" fill="#3BC5FF"></path><path id="Fill-12" fill-rule="evenodd" clip-rule="evenodd" d="M987.923 323.592C984.091 341.573 970.714 362.391 950.541 363.713C930.627 364.131 939.179 337.082 943.503 325.701C945.928 307.227 990.658 301.49 987.923 323.592Z" fill="#3BC5FF"></path><path id="Fill-14" fill-rule="evenodd" clip-rule="evenodd" d="M983.181 409.437C981.119 395.317 999.293 391.604 1007.38 383.387C1016.08 376.397 1025.18 379.201 1034.29 381.65C1047.29 397.813 1019.45 416.732 1009.73 428.749C999.612 435.937 980.323 422.77 983.181 409.437Z" fill="#3BC5FF"></path><path id="Fill-1_2" fill-rule="evenodd" clip-rule="evenodd" d="M1046.09 488.494C1051.03 472.003 1062.36 462.001 1079.08 458.747C1086.62 456.254 1073.72 438.609 1068.25 445.141C1058.56 453.158 1024.69 478.453 1046.09 488.494ZM962.567 355.661C966.586 350.466 988.211 341.095 984.529 335.646C977.533 329.612 965.796 313.204 956.635 323.746C955.453 326.766 961.776 328.319 956.061 329.857C943.66 333.381 943.533 333.475 950.688 343.726C954.214 347.849 957.467 353.473 962.567 355.661ZM1005.75 424.242C1013.98 414.924 1021.27 404.78 1033 399.275C1035.59 397.897 1037.04 395.615 1034.86 393.29C1030.31 389.404 1026.38 378.311 1019.39 384.254C1005.25 393.414 983.142 410.932 1005.75 424.242ZM1103.04 496.607C1099.8 487.876 1095.99 471.038 1083.3 477.907C1072.35 484.256 1057.24 495.519 1058.92 509.399C1060.84 513.8 1065.24 510.783 1068.07 509.181C1078.5 501.646 1092.67 501.965 1103.04 496.607ZM1015.92 371.47C1011.68 365.65 1000.55 345.821 992.529 352.564C986.28 359.948 966.786 365.95 973.563 377.478C977.056 382.305 981.355 397.89 988.662 390.587C995.866 381.724 1010.21 380.471 1015.92 371.47ZM1028.96 462.467C1057.36 422.321 1077.8 440.263 1050.12 410.925C1042.1 402.249 1029.91 425.389 1022.62 429.593C1019.03 433.872 1011.47 438.351 1015.17 444.747C1019.32 450.816 1021 460.428 1028.96 462.467ZM965.057 175.469C968.46 136.981 941.143 102.311 913.908 77.8206C877.43 49.4836 823.105 47.3416 781.176 64.7096C706.618 91.3166 654.677 173.475 696.724 248.46C711.846 286.446 745.924 305.412 783.745 315.226C884.266 337.843 964.344 280.402 965.057 175.469ZM931.272 325.231C925.921 320.504 923.298 307.915 915.412 310.611C873.031 334.252 820.269 339.545 774.151 324.327C684.58 303.029 644.351 188.978 693.968 113.269C747.77 20.7046 903.514 3.72462 960.298 101.889C1003.44 158.087 981.249 241.129 938.356 291.17C932.983 295.422 933.837 300.199 937.853 305.155C947.754 326.878 955.044 279.607 990.517 315.295C1003.84 327.702 1015.5 341.669 1025.51 356.883C1044.84 387.812 1072.51 412.309 1090.06 444.415C1093.23 456.691 1118.59 465.918 1109.81 472.706C1104.7 479.458 1113.45 487.49 1114.8 494.606C1117.28 501.144 1125.7 500.981 1130.48 505.233C1147.01 525.077 1106.46 542.409 1089.68 539.842C1080.24 537.786 1067.9 542.824 1060.42 535.442C1037.21 503.47 1015.6 469.937 993.495 436.845C978.708 414.832 960.517 395.4 947.77 371.996C942.297 357.905 914.864 338.881 931.272 325.231Z" fill="black"></path><path id="Fill-4" fill-rule="evenodd" clip-rule="evenodd" d="M601.704 343.088C596.306 327.925 662.534 265.25 660.892 297.079C652.774 304.53 608.343 365.187 601.704 343.088Z" fill="black"></path><path id="Fill-6" fill-rule="evenodd" clip-rule="evenodd" d="M608.742 182.968C642.295 189.259 548.364 224.547 538.762 222.635C520.581 210.313 597.685 182.415 608.742 182.968Z" fill="black"></path><path id="Fill-8" fill-rule="evenodd" clip-rule="evenodd" d="M1035.7 0.000475329C1028.73 21.188 994.945 54.534 972.503 56.375C955.347 43.468 1022.9 -0.166047 1035.7 0.000475329Z" fill="black"></path><path id="Fill-10" fill-rule="evenodd" clip-rule="evenodd" d="M883.384 381.29C882.67 396.051 880.537 437.486 862.065 407.368C847.488 365.17 881.737 333.868 883.384 381.29Z" fill="black"></path><path id="Fill-12_2" fill-rule="evenodd" clip-rule="evenodd" d="M567.212 60.5762C583.412 63.3622 598.276 73.4532 611.045 83.5522C619.424 87.8472 625.694 106.782 610.793 103.026C600.012 96.4232 589.445 89.4762 578.745 82.7452C572.594 78.9232 566.307 75.4222 559.138 73.7302C547.755 66.7612 556.931 59.7292 567.212 60.5762Z" fill="black"></path><path id="Fill-14_2" fill-rule="evenodd" clip-rule="evenodd" d="M746.547 368.305C741.858 383.387 730.854 407.841 714.628 411.937C698.469 407.601 739.626 334.02 746.547 368.305Z" fill="black"></path><path id="Fill-16" fill-rule="evenodd" clip-rule="evenodd" d="M701.6 49.3603C675.742 52.6903 660.651 -14.2307 690.823 7.41534C698.721 18.0763 696.967 33.3963 705.883 42.9393C710.159 46.1713 704.938 49.6373 701.6 49.3603Z" fill="black"></path><path id="Fill-20" fill-rule="evenodd" clip-rule="evenodd" d="M1089.3 251.633C1087.88 253.065 1086.82 255.739 1084.5 255.305C1073.56 251.887 1062.3 254.16 1051.22 253.568C1005.57 243.83 1059.47 219.109 1089.3 251.633Z" fill="black"></path><path id="Fill-22" fill-rule="evenodd" clip-rule="evenodd" d="M1055.44 153.097C1048.6 154.848 1032.67 146.27 1044.32 141.276C1059.66 139.553 1079.1 139.799 1092.49 146.077C1081.04 150.387 1067.58 150.366 1055.44 153.097Z" fill="black"></path><path id="Fill-26" fill-rule="evenodd" clip-rule="evenodd" d="M821.249 205.719C783.631 164.203 796.358 130.682 776.015 153.253C761.685 171.204 758.371 194.331 753.257 216.063C750.784 230.711 814.495 211.797 821.249 205.719ZM860.375 182.584C883.551 169.369 901.021 141.914 897.238 114.771C877.832 103.26 846.583 110.219 825.481 118.659C822.229 119.98 822.091 121.812 825.035 124.294C843.151 139.605 853.23 160.297 860.375 182.584ZM760.716 233.469C736.555 236.999 745.741 224.484 745.627 207.297C747.519 195.848 731.023 202.704 725.228 197.238C718.282 188.844 734.424 186.241 740.215 186.618C748.366 186.965 749.993 186.193 751.737 177.258C753.207 171.943 756.596 166.018 756.256 160.615C754.249 155.577 742.637 152.23 737.711 148.246C733.447 146.212 735.991 139.864 740.072 139.611C749.29 138.421 753.991 147.642 762.054 149.734C775.596 129.446 793.096 134.315 773.819 110.108C770.386 105.884 774.318 102.391 778.298 99.8992C785.484 99.4842 787.755 110.007 792.444 114.353C799.123 121.2 809.69 108.177 817.134 106.109C826.483 101.757 806.783 81.5652 818.19 79.0442C835.59 79.7762 826.712 98.2472 838.354 98.9782C845.696 95.9992 869.176 99.4562 869.725 90.8412C867.971 83.1942 864.435 74.5322 871.095 68.2782C873.038 65.9592 877.011 66.6062 878.25 69.4692C878.705 74.7212 884.041 77.7162 883.197 83.2822C872.431 105.469 902.703 91.0172 913.084 99.5512C922.68 105.883 905.52 109.371 910.816 117.434C918.598 188.049 821.668 235.956 760.716 233.469Z" fill="black"></path></g><g id="bigshape" class="svelte-1tulok6"><g id="square" class="svelte-1tulok6"><path id="Fill-3_2" fill-rule="evenodd" clip-rule="evenodd" d="M277.163 510.107C275.226 506.711 271.19 502.97 267.432 504.489C264.03 507.84 275.285 519.88 277.163 510.107ZM172.126 622.729C148.723 610.983 138.735 579.615 124.757 558.131C110.755 530.753 88.5797 509.197 68.9507 485.619C67.0477 482.88 65.2337 480.296 61.3117 480.329C51.2287 475.074 61.7207 457.016 70.5617 454.085C107.964 436.868 133.5 400.061 177.003 395.454C210.995 379.068 246.558 483.482 260.881 482.084C288.94 480.037 305.934 503.884 288.166 527.83C280.435 537.448 297.946 550.738 284.634 558.274C242.192 571.319 213.323 608.947 172.126 622.729Z" fill="#FFC43C"></path><g id="Mask Group" class="svelte-1tulok6"><mask id="mask0_1264_696" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="345" width="351" height="278"><rect id="Rectangle 9" y="345.709" width="351" height="277" fill="#C4C4C4"></rect></mask><g mask="url(#mask0_1264_696)" class="svelte-1tulok6"><path id="Fill-1_3" fill-rule="evenodd" clip-rule="evenodd" d="M173.704 386.905C152.704 403.306 130.548 417.831 108.036 432.131C92.8788 442.654 75.5578 450.419 61.9768 463.02C54.4588 470.354 68.0618 475.892 71.6068 481.509C109.039 525.905 146.145 570.503 183.537 614.847C185.876 617.916 188.631 615.457 190.529 613.037C219.099 579.118 253.675 550.647 281.25 516.024C292.63 509.045 246.744 474.089 240.874 465.272C213.546 443.46 197.162 411.97 173.704 386.905ZM168.497 638.956C86.6758 632.661 58.5298 722.839 104.23 780.879C110.61 792.542 164.527 817.937 176.508 813.043C186.561 809.066 191.587 824.182 201.714 822.456C329.936 818.737 305.209 634.633 168.497 638.956ZM181.199 1039.63C213.726 1039.82 267.889 1040.05 305.825 1037.57C308.629 1037.46 309.663 1035.5 308.199 1033.15C292.105 1008.99 279.625 982.389 262.128 959.173C234.823 919.726 204.586 882.56 179.219 841.827C173.479 834.547 155.477 866.498 149.142 870.547C106.057 921.519 71.9558 979.612 35.8348 1035.6C32.7428 1039.65 37.0198 1041.88 40.8948 1041.39C90.4688 1042.33 125.315 1040.79 181.199 1039.63ZM295.335 525.196C266.474 555.949 236.186 585.307 207.012 615.926C201.532 620.926 198.884 625.396 208.233 627.157C324.078 652.398 330.366 826.824 204.778 837.092C222.216 873.321 251.936 902.37 271.163 937.87C295.379 968.994 308.236 1008.75 332.706 1038.73C335.347 1039.42 335.095 1043.15 334.382 1045.39C338.215 1052.84 329.972 1057.11 323.612 1056.05C289.005 1056.23 254.064 1055.67 219.482 1058.08C163.804 1057.13 107.752 1060.57 51.9398 1056.25C42.3278 1053.47 11.2948 1058.78 14.1898 1043.95C47.8968 965.112 105.058 899.453 157.039 832.6C164.771 820.207 98.6648 816.29 84.0588 777.322C44.3148 705.513 73.9388 624.135 162.896 622.77C175.228 620.928 126.058 576.969 121.179 571.575C95.6208 544.278 75.1038 512.668 48.8508 485.903C23.9378 462.971 61.2028 441.674 79.6118 430.965C109.941 412.403 141.23 395.36 170.819 375.644C174.228 373.349 184.326 366.669 184.273 374.175C183.286 376.975 183.497 379.059 185.728 380.947C198.056 391.381 206.619 405.057 216.723 417.376C238.862 442.89 265.15 464.162 286.974 489.92C297.636 500.298 311.186 513.957 312.605 528.917C309.091 540.278 299.329 531.71 295.335 525.196Z" fill="black"></path></g></g></g><g id="circle" class="svelte-1tulok6"><path id="Fill-12_3" fill-rule="evenodd" clip-rule="evenodd" d="M128.269 807.26C86.6911 794.651 231.093 690.871 248.143 678.086C254.179 673.175 262.356 679.773 259.455 686.856C251.829 706.393 231.341 716.792 217.376 731.489C187.739 755.275 162.248 791.48 128.269 807.26Z" fill="#3BC5FF"></path><path id="Fill-14_3" fill-rule="evenodd" clip-rule="evenodd" d="M102.538 779.237C76.6116 772.939 122.398 732.464 130.059 722.355C153.649 690.315 303.838 601.611 196.632 692.008C182.93 703.339 168.618 714.007 155.629 726.1C136.679 741.854 124.121 767.342 102.538 779.237Z" fill="#3BC5FF"></path><path id="Fill-16_2" fill-rule="evenodd" clip-rule="evenodd" d="M173.416 831.726C98.2007 852.525 258.209 729.201 269.046 718.639C314.734 716.231 179.977 816.86 173.416 831.726Z" fill="#3BC5FF"></path><path id="Fill-18" fill-rule="evenodd" clip-rule="evenodd" d="M176.334 637.041C197.005 640.907 145.508 679.333 139.846 687.074C124.19 700.172 113.87 718.238 99.6747 732.378C94.4287 736.903 85.1377 728.841 88.3637 722.659C108.885 687.234 143.726 660.515 176.334 637.041Z" fill="#3BC5FF"></path><g id="Mask Group_2" class="svelte-1tulok6"><mask id="mask1_1264_696" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="5" y="622" width="351" height="214"><rect id="Rectangle 11" x="5" y="622.709" width="351" height="213" fill="#C4C4C4"></rect></mask><g mask="url(#mask1_1264_696)" class="svelte-1tulok6"><path id="Fill-1_4" fill-rule="evenodd" clip-rule="evenodd" d="M178.704 386.905C157.704 403.306 135.548 417.831 113.036 432.131C97.8788 442.654 80.5578 450.419 66.9768 463.02C59.4588 470.354 73.0618 475.892 76.6068 481.509C114.039 525.905 151.145 570.503 188.537 614.847C190.876 617.916 193.631 615.457 195.529 613.037C224.099 579.118 258.675 550.647 286.25 516.024C297.63 509.045 251.744 474.089 245.874 465.272C218.546 443.46 202.162 411.97 178.704 386.905ZM173.497 638.956C91.6758 632.661 63.5298 722.839 109.23 780.879C115.61 792.542 169.527 817.937 181.508 813.043C191.561 809.066 196.587 824.182 206.714 822.456C334.936 818.737 310.209 634.633 173.497 638.956ZM186.199 1039.63C218.726 1039.82 272.889 1040.05 310.825 1037.57C313.629 1037.46 314.663 1035.5 313.199 1033.15C297.105 1008.99 284.625 982.389 267.128 959.173C239.823 919.726 209.586 882.56 184.219 841.827C178.479 834.547 160.477 866.498 154.142 870.547C111.057 921.519 76.9558 979.612 40.8348 1035.6C37.7428 1039.65 42.0198 1041.88 45.8948 1041.39C95.4688 1042.33 130.315 1040.79 186.199 1039.63ZM300.335 525.196C271.474 555.949 241.186 585.307 212.012 615.926C206.532 620.926 203.884 625.396 213.233 627.157C329.078 652.398 335.366 826.824 209.778 837.092C227.216 873.321 256.936 902.37 276.163 937.87C300.379 968.994 313.236 1008.75 337.706 1038.73C340.347 1039.42 340.095 1043.15 339.382 1045.39C343.215 1052.84 334.972 1057.11 328.612 1056.05C294.005 1056.23 259.064 1055.67 224.482 1058.08C168.804 1057.13 112.752 1060.57 56.9398 1056.25C47.3278 1053.47 16.2948 1058.78 19.1898 1043.95C52.8968 965.112 110.058 899.453 162.039 832.6C169.771 820.207 103.665 816.29 89.0588 777.322C49.3148 705.513 78.9388 624.135 167.896 622.77C180.228 620.928 131.058 576.969 126.179 571.575C100.621 544.278 80.1038 512.668 53.8508 485.903C28.9378 462.971 66.2028 441.674 84.6118 430.965C114.941 412.403 146.23 395.36 175.819 375.644C179.228 373.349 189.326 366.669 189.273 374.175C188.286 376.975 188.497 379.059 190.728 380.947C203.056 391.381 211.619 405.057 221.723 417.376C243.862 442.89 270.15 464.162 291.974 489.92C302.636 500.298 316.186 513.957 317.605 528.917C314.091 540.278 304.329 531.71 300.335 525.196Z" fill="black"></path></g></g></g><g id="triange" class="svelte-1tulok6"><path id="Fill-1_5" fill-rule="evenodd" clip-rule="evenodd" d="M189.415 833.709C204.676 843.168 211.534 862.28 223.374 875.507C247.464 903.883 256.324 942.462 279.322 970.842C292.774 978.583 297.254 995.034 308.008 1005.73C314.013 1012.8 347.076 1055.29 331.486 1058.98C315.425 1067.98 301.923 1050.53 286.841 1047.76C246.537 1048.43 206.451 1042.65 166.138 1043.23C131.227 1042.74 97.2151 1050.79 62.5621 1054.23C12.7251 1055.67 86.3511 1005.76 71.3601 987.215C53.5511 952.353 128.11 920.826 142.912 894.158C149.445 877.028 169.891 865.868 172.711 848.395C171.376 839.147 183.787 838.285 189.415 833.709Z" fill="#FF3B53"></path><g id="Mask Group_3" class="svelte-1tulok6"><mask id="mask2_1264_696" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="14" y="835" width="351" height="233"><rect id="Rectangle 13" x="14" y="835.709" width="351" height="232" fill="#C4C4C4"></rect></mask><g mask="url(#mask2_1264_696)" class="svelte-1tulok6"><path id="Fill-1_6" fill-rule="evenodd" clip-rule="evenodd" d="M187.704 386.905C166.704 403.306 144.548 417.831 122.036 432.131C106.879 442.654 89.5578 450.419 75.9768 463.02C68.4588 470.354 82.0618 475.892 85.6068 481.509C123.039 525.905 160.145 570.503 197.537 614.847C199.876 617.916 202.631 615.457 204.529 613.037C233.099 579.118 267.675 550.647 295.25 516.024C306.63 509.045 260.744 474.089 254.874 465.272C227.546 443.46 211.162 411.97 187.704 386.905ZM182.497 638.956C100.676 632.661 72.5298 722.839 118.23 780.879C124.61 792.542 178.527 817.937 190.508 813.043C200.561 809.066 205.587 824.182 215.714 822.456C343.936 818.737 319.209 634.633 182.497 638.956ZM195.199 1039.63C227.726 1039.82 281.889 1040.05 319.825 1037.57C322.629 1037.46 323.663 1035.5 322.199 1033.15C306.105 1008.99 293.625 982.389 276.128 959.173C248.823 919.726 218.586 882.56 193.219 841.827C187.479 834.547 169.477 866.498 163.142 870.547C120.057 921.519 85.9558 979.612 49.8348 1035.6C46.7428 1039.65 51.0198 1041.88 54.8948 1041.39C104.469 1042.33 139.315 1040.79 195.199 1039.63ZM309.335 525.196C280.474 555.949 250.186 585.307 221.012 615.926C215.532 620.926 212.884 625.396 222.233 627.157C338.078 652.398 344.366 826.824 218.778 837.092C236.216 873.321 265.936 902.37 285.163 937.87C309.379 968.994 322.236 1008.75 346.706 1038.73C349.347 1039.42 349.095 1043.15 348.382 1045.39C352.215 1052.84 343.972 1057.11 337.612 1056.05C303.005 1056.23 268.064 1055.67 233.482 1058.08C177.804 1057.13 121.752 1060.57 65.9398 1056.25C56.3278 1053.47 25.2948 1058.78 28.1898 1043.95C61.8968 965.112 119.058 899.453 171.039 832.6C178.771 820.207 112.665 816.29 98.0588 777.322C58.3148 705.513 87.9388 624.135 176.896 622.77C189.228 620.928 140.058 576.969 135.179 571.575C109.621 544.278 89.1038 512.668 62.8508 485.903C37.9378 462.971 75.2028 441.674 93.6118 430.965C123.941 412.403 155.23 395.36 184.819 375.644C188.228 373.349 198.326 366.669 198.273 374.175C197.286 376.975 197.497 379.059 199.728 380.947C212.056 391.381 220.619 405.057 230.723 417.376C252.862 442.89 279.15 464.162 300.974 489.92C311.636 500.298 325.186 513.957 326.605 528.917C323.091 540.278 313.329 531.71 309.335 525.196Z" fill="black"></path></g></g></g></g></g></svg>',O(t,"class","svg-holder svelte-1tulok6"),z(t,"animate",e[1]),z(t,"blur",e[2]),z(t,"iso",e[3])},m(e,n){T(e,t,n),r=!0},p(e,n){2&n&&z(t,"animate",e[1]),4&n&&z(t,"blur",e[2]),8&n&&z(t,"iso",e[3])},i(e){r||(re((()=>{n||(n=ve(t,lt,{delay:500},!0)),n.run(1)})),r=!0)},o(e){n||(n=ve(t,lt,{delay:500},!1)),n.run(0),r=!1},d(e){e&&N(t),e&&n&&n.end()}}}function im(e){let t,n,r,i,s,a,l,c,u,h,d,f,p,g,m,_,v,y,w,b,C,x,k,S=e[0]&&rm(e);return{c(){t=$("div"),t.textContent="Skip Intro",n=P(),r=$("section"),r.innerHTML='<h1 class="svelte-1tulok6">How We Gaze</h1>',i=P(),s=$("section"),s.innerHTML='<p class="svelte-1tulok6">Imagine a piece of art that you love. How do you look at it?</p>',a=P(),l=$("section"),l.innerHTML='<p class="svelte-1tulok6">Do you study the work bit-by-bit?</p>',c=P(),u=$("section"),u.innerHTML='<p class="svelte-1tulok6">Or do you take it in as a whole?</p>',h=P(),d=$("section"),d.innerHTML='<p class="svelte-1tulok6">How would someone else look at the same work?</p>',f=P(),p=$("section"),p.innerHTML='<p class="svelte-1tulok6">What might we learn about someone by seeing how they see?</p>',g=P(),m=$("section"),m.innerHTML='<p class="svelte-1tulok6">How We Gaze is a <strong>meta-gallery</strong> that shows how individuals\n      gaze at pieces of artwork. <br/><br/>Crowdsourced eye-tracking sessions\n      are used to study and visualize individuals&#39; gazes.</p>',_=P(),v=$("section"),y=$("div"),y.innerHTML='<span>Enter Gallery</span> \n\n      <span class="material-icons-round" style="font-size: 40px;margin-left: 10px">auto_awesome</span>',w=P(),S&&S.c(),b=A(),O(t,"class","btn-close clickable svelte-1tulok6"),O(r,"class","introbg svelte-1tulok6"),O(s,"class","scroll svelte-1tulok6"),O(l,"class","scroll svelte-1tulok6"),O(l,"data-effect","animate"),O(u,"class","scroll svelte-1tulok6"),O(u,"data-effect","blur"),O(d,"class","scroll svelte-1tulok6"),O(d,"data-effect","iso"),O(p,"class","scroll svelte-1tulok6"),O(m,"class","scroll svelte-1tulok6"),O(y,"class","btn svelte-1tulok6"),O(v,"class","scroll svelte-1tulok6")},m(o,E){T(o,t,E),T(o,n,E),T(o,r,E),T(o,i,E),T(o,s,E),T(o,a,E),T(o,l,E),T(o,c,E),T(o,u,E),T(o,h,E),T(o,d,E),T(o,f,E),T(o,p,E),T(o,g,E),T(o,m,E),T(o,_,E),T(o,v,E),I(v,y),T(o,w,E),S&&S.m(o,E),T(o,b,E),C=!0,x||(k=[L(t,"click",e[5]),L(y,"click",e[6])],x=!0)},p(e,t){e[0]?S?(S.p(e,t),1&t&&ge(S,1)):(S=rm(e),S.c(),ge(S,1),S.m(b.parentNode,b)):S&&(fe(),me(S,1,1,(()=>{S=null})),pe())},i(e){C||(ge(S),C=!0)},o(e){me(S),C=!1},d(e){e&&N(t),e&&N(n),e&&N(r),e&&N(i),e&&N(s),e&&N(a),e&&N(l),e&&N(c),e&&N(u),e&&N(h),e&&N(d),e&&N(f),e&&N(p),e&&N(g),e&&N(m),e&&N(_),e&&N(v),e&&N(w),S&&S.d(e),e&&N(b),x=!1,o(k)}}}function om(e){let t,n;return t=new Kg({props:{$$slots:{default:[im]},$$scope:{ctx:e}}}),{c(){be(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},p(e,[n]){const r={};1039&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function sm(e,t,n){let r;d(e,Me,(e=>n(7,r=e)));let i=!1,o=!1,s=!1,a=!1;function l(){document.querySelector("#modal").addEventListener("scroll",(e=>{let t=window.innerHeight/2;document.querySelectorAll(".scroll").forEach((e=>{let r=e.getBoundingClientRect();var l;t>=r.top&&t<r.height+r.top&&(e.style.opacity=1,(l=e).dataset.effect?"animate"==l.dataset.effect?(n(0,i=!0),n(1,o=!0),n(2,s=!1),n(3,a=!1)):"blur"==l.dataset.effect?(n(1,o=!1),n(0,i=!0),n(2,s=!0),n(3,a=!1)):"iso"==l.dataset.effect&&(n(1,o=!1),n(0,i=!0),n(2,s=!1),n(3,a=!0)):(n(0,i=!1),n(1,o=!1),n(2,s=!1)))}))}))}function c(){Of.setItem("visited",!0),v(Me,r=null,r)}Z((()=>{l()}));return[i,o,s,a,c,()=>{c()},()=>{c()}]}class am extends Se{constructor(e){super(),Ie(this,e,sm,om,a,{})}}function lm(e){let t,n,r;const i=e[7].default,o=f(i,e,e[6],null);return{c(){t=$("div"),o&&o.c()},m(e,n){T(e,t,n),o&&o.m(t,null),r=!0},p(e,t){o&&o.p&&(!r||64&t)&&m(o,i,e,e[6],r?g(i,e[6],t,null):_(e[6]),null)},i(e){r||(ge(o,e),re((()=>{n||(n=ve(t,ct,{duration:150},!0)),n.run(1)})),r=!0)},o(e){me(o,e),n||(n=ve(t,ct,{duration:150},!1)),n.run(0),r=!1},d(e){e&&N(t),o&&o.d(e),e&&n&&n.end()}}}function cm(e){let t,n,r,i,o,s,a,l,c,u,h,d,f,p,g,m,_,v=e[4]&&lm(e);return{c(){t=$("div"),n=$("div"),r=$("div"),i=$("p"),o=R(e[0]),s=P(),a=$("div"),l=$("div"),c=R(e[1]),u=P(),h=$("div"),d=$("span"),d.textContent="expand_more",f=P(),p=$("div"),v&&v.c(),O(l,"class","chip svelte-xjm11e"),O(d,"class","material-icons-round svelte-xjm11e"),z(d,"rotate",e[2]&&e[3]==e[2]),O(h,"class","expand svelte-xjm11e"),q(a,"display","flex"),q(a,"align-items","center"),O(n,"class","question svelte-xjm11e"),O(p,"class","answer"),z(p,"show",e[3]==e[2]),O(t,"class","question-cont svelte-xjm11e")},m(y,w){T(y,t,w),I(t,n),I(n,r),I(r,i),I(i,o),I(n,s),I(n,a),I(a,l),I(l,c),I(a,u),I(a,h),I(h,d),I(t,f),I(t,p),v&&v.m(p,null),e[8](t),g=!0,m||(_=L(t,"click",e[9]),m=!0)},p(e,[t]){(!g||1&t)&&D(o,e[0]),(!g||2&t)&&D(c,e[1]),12&t&&z(d,"rotate",e[2]&&e[3]==e[2]),e[4]?v?(v.p(e,t),16&t&&ge(v,1)):(v=lm(e),v.c(),ge(v,1),v.m(p,null)):v&&(fe(),me(v,1,1,(()=>{v=null})),pe()),12&t&&z(p,"show",e[3]==e[2])},i(e){g||(ge(v),g=!0)},o(e){me(v),g=!1},d(n){n&&N(t),v&&v.d(),e[8](null),m=!1,_()}}}function um(e,t,n){let r;d(e,We,(e=>n(3,r=e)));let i,{$$slots:o={},$$scope:s}=t,{questionText:a,chipText:l}=t,c=!1,u=9e3;return e.$$set=e=>{"questionText"in e&&n(0,a=e.questionText),"chipText"in e&&n(1,l=e.chipText),"$$scope"in e&&n(6,s=e.$$scope)},e.$$.update=()=>{12&e.$$.dirty&&n(4,c=r==u)},[a,l,u,r,c,i,s,o,function(e){X[e?"unshift":"push"]((()=>{i=e,n(5,i)}))},()=>{let e=document.querySelectorAll(".question-cont");n(2,u=Array.from(e).indexOf(i)),v(We,r=r!==u?u:null,r)}]}class hm extends Se{constructor(e){super(),Ie(this,e,um,cm,a,{questionText:0,chipText:1})}}function dm(e){let t,n,r,i,o;return{c(){t=$("p"),t.textContent="Broadly, my work as both a practioner and educator focuses on using\r\n          data and technology to augment communication and perception.",n=P(),r=$("p"),r.textContent="For this project in particular, I was tasked with visualizing data\r\n          from the Smithsonian Museum Open Access Collection (as part of my\r\n          coursework at Parsons). Browsing through the collection, I found that\r\n          the context accompanying a piece of artwork was not always enough to\r\n          help me understand and connect with it. Viewing art is a visceral\r\n          experience - it is difficult to put into words. I wondered - could I\r\n          create a tool that enables me to see how others are looking at\r\n          artwork? With this question in mind, I underwent a series of\r\n          explorations that led me to develop the concept of using eye-tracking\r\n          to visualize gazes.",i=P(),o=$("p")},m(e,s){T(e,t,s),T(e,n,s),T(e,r,s),T(e,i,s),T(e,o,s)},d(e){e&&N(t),e&&N(n),e&&N(r),e&&N(i),e&&N(o)}}}function fm(e){let t,n,r,i,o,s,a,l,c;return{c(){t=$("p"),t.textContent="Each gaze session is recorded as a series of points, so a series of x\r\n          and y coordinates was my starting point for creating visualization.",n=P(),r=$("p"),r.textContent="I first experimented with abstract visualizations of these points -\r\n          like dots, heatmaps or contours overlayed onto the original image. The\r\n          result was unsatisfying. In seeing quantitative data, I found that\r\n          viewers would draw clear-cut conclusions about a given gaze, rather\r\n          than imagine how someone else would study it.",i=P(),o=$("div"),o.innerHTML='<img style="width: 45%" src="./assets/img/process/pointmaphiresNocont.png" class="svelte-nbqm0b"/> \n          <img style="width: 45%" src="./assets/img/process/contourmap.png" class="svelte-nbqm0b"/>',s=P(),a=$("p"),a.textContent="I wanted to create a visual that would guide the viewer empathize and\r\n          imagine how someone else might look at a given artwork. In order to\r\n          so, I needed to tie the gaze to the original artwork, and make it feel\r\n          like a cohesive work that can be examined. I experimented with a\r\n          number of different forms that blend in with the original artwork. The\r\n          'aggregate blur' was most effective to me - it retained the integrity\r\n          of the artwork, but also clearly delineated the viewer's gaze.",l=P(),c=$("div"),c.innerHTML='<img src="./assets/img/process/blurmap.png" class="svelte-nbqm0b"/>',O(o,"class","img-holder svelte-nbqm0b"),O(c,"class","img-holder svelte-nbqm0b")},m(e,u){T(e,t,u),T(e,n,u),T(e,r,u),T(e,i,u),T(e,o,u),T(e,s,u),T(e,a,u),T(e,l,u),T(e,c,u)},d(e){e&&N(t),e&&N(n),e&&N(r),e&&N(i),e&&N(o),e&&N(s),e&&N(a),e&&N(l),e&&N(c)}}}function pm(e){let t;return{c(){t=$("p"),t.innerHTML='I would love to take suggestions on what to include in the gallery!\n          Please fill out this <a href="https://docs.google.com/forms/d/e/1FAIpQLSd8ALICBzpHRIgFI8BHoQekxhPbEPxabOzPr3H_DS8y_VT56Q/viewform">form</a> if you&#39;re interested in suggesting a work!'},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function gm(e){let t;return{c(){t=$("p"),t.textContent="I sought to include a variety of artwork - both in style and time\r\n          period - in the gallery. Because I wanted to include high resolution\r\n          digital images, the works included are fairly modern (1400s or so).\r\n          Shoutout to my friend Rayyan Mikati for helping me select the works in\r\n          this gallery!"},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function mm(e){let t,n,r,i,o,s,a,l,c,u,h;return{c(){t=$("p"),t.textContent="In order to create the 'aggregate' blur visual used to represent each\r\n          gaze, I mapped each gaze to a set of density contours, and translated\r\n          the contours to a blurred out portion of the image. Let's break this\r\n          down step by step. Each gaze recording session is recorded as a series\r\n          of points, so that was my starting point.",n=P(),r=$("div"),r.innerHTML='<img style="width: 100%" src="./assets/img/process/visExplain1.svg" class="svelte-nbqm0b"/>',i=P(),o=$("p"),o.innerHTML='Using the marching squares algorithm (built into <a href="https://github.com/d3/d3-contour">d3 contour</a>), I grouped all recorded points into into contours. Note that points\n          on the bottom right are not dense enough to be grouped into a contour\n          - a minimum threshold of points needs to be met.',s=P(),a=$("div"),a.innerHTML='<img style="width: 100%" src="./assets/img/process/visExplain2.svg" class="svelte-nbqm0b"/>',l=P(),c=$("p"),c.textContent="Next, I overlay the corresponding piece of the image onto the contour\r\n          using SVG clip-path. I then add a blur effect based on the number of\r\n          points in the contour: contours with higher point density have lower\r\n          point density, and vice-versa. Note that the images in the gallery\r\n          appear 'smoother' because there are more contours and points to draw\r\n          from (typically 4000 points, and 30 contours).",u=P(),h=$("div"),h.innerHTML='<img style="width: 100%" src="./assets/img/process/visExplain3.svg" class="svelte-nbqm0b"/>',O(r,"class","img-holder small svelte-nbqm0b"),q(r,"flex-direction","column"),O(a,"class","img-holder small svelte-nbqm0b"),q(a,"flex-direction","column"),O(h,"class","img-holder small svelte-nbqm0b"),q(h,"flex-direction","column")},m(e,d){T(e,t,d),T(e,n,d),T(e,r,d),T(e,i,d),T(e,o,d),T(e,s,d),T(e,a,d),T(e,l,d),T(e,c,d),T(e,u,d),T(e,h,d)},d(e){e&&N(t),e&&N(n),e&&N(r),e&&N(i),e&&N(o),e&&N(s),e&&N(a),e&&N(l),e&&N(c),e&&N(u),e&&N(h)}}}function _m(e){let t,n,r,i,o,s,a;return{c(){t=$("p"),t.textContent="Gazes can submitted to the gallery only after a webcam is calibrated\r\n          with an accuracy rate of 75% or higher. Generally, accuracy for\r\n          submitted gazes ranges from 75% to 85%. This means that the margin of\r\n          error ranges from 12.5% to 7.5% of the container width used to\r\n          calibrate the eye tracker (pictured below).",n=P(),r=$("p"),r.textContent="Given the substantial margin of error, a single point is not very\r\n          accurate. However, each 20 second viewing session includes roughly\r\n          4000 points. A combination all of these points will shows clear\r\n          trends.",i=P(),o=$("p"),o.textContent="Screen size, lighting, and webcam quality affect accuracy. Generally,\r\n          eye-tracking experiments in psychology research are done using\r\n          accurate, high-cost eye-tracking devices that resemble bulky goggles.\r\n          I prioritized accessibility rather than accuracy for this project, and\r\n          thus decided used the webcam.",s=P(),a=$("div"),a.innerHTML='<img style="width: 100%" src="./assets/img/process/accuracy.png" class="svelte-nbqm0b"/>',O(a,"class","img-holder svelte-nbqm0b")},m(e,l){T(e,t,l),T(e,n,l),T(e,r,l),T(e,i,l),T(e,o,l),T(e,s,l),T(e,a,l)},d(e){e&&N(t),e&&N(n),e&&N(r),e&&N(i),e&&N(o),e&&N(s),e&&N(a)}}}function vm(e){let t,n,r;return{c(){t=$("p"),t.textContent="I used an existing open-source library - webgazer.js - for\r\n          eye-tracking. Out of the box, webgazer allows you to use the webcam to\r\n          detect the location of a viewer's eyes as coordinates on a screen. In\r\n          order to incorporate eye-tracking into my project, I added the ability\r\n          to calibrate webgazer's eye-tracker to ensure accuracy (pictured\r\n          below). I also built out a method to retain calibration across\r\n          sessions so that users don't have to re-calibrate each time they add a\r\n          gaze (using localStorage).",n=P(),r=$("div"),r.innerHTML='<img style="width: 100%" src="./assets/img/process/calibrateProcess.png" class="noStyle svelte-nbqm0b"/>',O(r,"class","img-holder small svelte-nbqm0b")},m(e,i){T(e,t,i),T(e,n,i),T(e,r,i)},d(e){e&&N(t),e&&N(n),e&&N(r)}}}function ym(e){let t;return{c(){t=$("p"),t.innerHTML='This project was built using open-source web libraries. I used Svelte\n          as framework, d3.js for generating visualizations, Firebase to store\n          data in real-time, and webgazer.js for recording webcam viewing\n          sessions. I also used Observable to process data and explore\n          visualizations, and Figma to design the interface. See my <a href="https://github.com/omar-nema/how-we-gaze/">code here</a>.'},m(e,n){T(e,t,n)},d(e){e&&N(t)}}}function wm(e){let t,n,r,i,o,s,a,l,c,u,h,d,f,p,g,m,_,v,y,w,b,C,x,k,S;return l=new hm({props:{questionText:"How did you come up with the idea for this project?",chipText:"Inspiration",$$slots:{default:[dm]},$$scope:{ctx:e}}}),u=new hm({props:{questionText:"How did you come up with the visual form used to represent gazes?",chipText:"Inspiration",$$slots:{default:[fm]},$$scope:{ctx:e}}}),d=new hm({props:{questionText:"Can I add artwork to the gallery?",chipText:"Curation",$$slots:{default:[pm]},$$scope:{ctx:e}}}),p=new hm({props:{questionText:"Why did you select these particular images for the gallery?",chipText:"Curation",$$slots:{default:[gm]},$$scope:{ctx:e}}}),m=new hm({props:{questionText:"How did you make the 'aggregate' visuals for this project?",chipText:"Technical",$$slots:{default:[mm]},$$scope:{ctx:e}}}),v=new hm({props:{questionText:"How accurate are the gaze representations in your gallery?",chipText:"Technical",$$slots:{default:[_m]},$$scope:{ctx:e}}}),w=new hm({props:{questionText:"How does the whole eye tracking thing work?",chipText:"Technical",$$slots:{default:[vm]},$$scope:{ctx:e}}}),C=new hm({props:{questionText:"What sort of technology and tools did you use to make this?",chipText:"Technical",$$slots:{default:[ym]},$$scope:{ctx:e}}}),{c(){t=$("div"),n=$("div"),r=$("h1"),r.textContent="Methods & Process",i=P(),o=$("div"),o.innerHTML='<span class="material-icons-round">close</span>',s=P(),a=$("div"),be(l.$$.fragment),c=P(),be(u.$$.fragment),h=P(),be(d.$$.fragment),f=P(),be(p.$$.fragment),g=P(),be(m.$$.fragment),_=P(),be(v.$$.fragment),y=P(),be(w.$$.fragment),b=P(),be(C.$$.fragment),O(o,"class","clickable btn close"),O(n,"class","cont-header"),O(a,"class","cont-body svelte-nbqm0b"),O(t,"class","inner svelte-nbqm0b")},m(E,N){T(E,t,N),I(t,n),I(n,r),I(n,i),I(n,o),I(t,s),I(t,a),Ce(l,a,null),I(a,c),Ce(u,a,null),I(a,h),Ce(d,a,null),I(a,f),Ce(p,a,null),I(a,g),Ce(m,a,null),I(a,_),Ce(v,a,null),I(a,y),Ce(w,a,null),I(a,b),Ce(C,a,null),x=!0,k||(S=L(o,"click",e[0]),k=!0)},p(e,t){const n={};2&t&&(n.$$scope={dirty:t,ctx:e}),l.$set(n);const r={};2&t&&(r.$$scope={dirty:t,ctx:e}),u.$set(r);const i={};2&t&&(i.$$scope={dirty:t,ctx:e}),d.$set(i);const o={};2&t&&(o.$$scope={dirty:t,ctx:e}),p.$set(o);const s={};2&t&&(s.$$scope={dirty:t,ctx:e}),m.$set(s);const a={};2&t&&(a.$$scope={dirty:t,ctx:e}),v.$set(a);const c={};2&t&&(c.$$scope={dirty:t,ctx:e}),w.$set(c);const h={};2&t&&(h.$$scope={dirty:t,ctx:e}),C.$set(h)},i(e){x||(ge(l.$$.fragment,e),ge(u.$$.fragment,e),ge(d.$$.fragment,e),ge(p.$$.fragment,e),ge(m.$$.fragment,e),ge(v.$$.fragment,e),ge(w.$$.fragment,e),ge(C.$$.fragment,e),x=!0)},o(e){me(l.$$.fragment,e),me(u.$$.fragment,e),me(d.$$.fragment,e),me(p.$$.fragment,e),me(m.$$.fragment,e),me(v.$$.fragment,e),me(w.$$.fragment,e),me(C.$$.fragment,e),x=!1},d(e){e&&N(t),xe(l),xe(u),xe(d),xe(p),xe(m),xe(v),xe(w),xe(C),k=!1,S()}}}function bm(e){let t,n;return t=new Kg({props:{$$slots:{default:[wm]},$$scope:{ctx:e}}}),{c(){be(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},p(e,[n]){const r={};2&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function Cm(e){return[()=>{Me.set(null)}]}class xm extends Se{constructor(e){super(),Ie(this,e,Cm,bm,a,{})}}function km(t){let n,r,i,o,s,a,l,c,u;return{c(){n=$("div"),r=$("div"),i=$("p"),i.textContent="This project runs smoother on Google Chrome or Edge - please switch over\r\n        for the best experience!",o=P(),s=$("div"),s.innerHTML='<span class="material-icons-round" style="font-size: 14px; color: white; margin-right: 5px;">close</span> \n        <div>Dismiss</div>',O(s,"class","btn-close clickable svelte-1fg1zzb"),O(r,"class","inner svelte-1fg1zzb"),O(n,"class","banner svelte-1fg1zzb")},m(e,a){T(e,n,a),I(n,r),I(r,i),I(r,o),I(r,s),l=!0,c||(u=L(s,"click",t[1]),c=!0)},p:e,i(e){l||(re((()=>{a||(a=ve(n,ct,{duration:150},!0)),a.run(1)})),l=!0)},o(e){a||(a=ve(n,ct,{duration:150},!1)),a.run(0),l=!1},d(e){e&&N(n),e&&a&&a.end(),c=!1,u()}}}function Im(e){let t,n,r=e[0]&&km(e);return{c(){r&&r.c(),t=A()},m(e,i){r&&r.m(e,i),T(e,t,i),n=!0},p(e,[n]){e[0]?r?(r.p(e,n),1&n&&ge(r,1)):(r=km(e),r.c(),ge(r,1),r.m(t.parentNode,t)):r&&(fe(),me(r,1,1,(()=>{r=null})),pe())},i(e){n||(ge(r),n=!0)},o(e){me(r),n=!1},d(e){r&&r.d(e),e&&N(t)}}}function Sm(e,t,n){let r=!0;return[r,()=>{n(0,r=!1)}]}class Em extends Se{constructor(e){super(),Ie(this,e,Sm,Im,a,{})}}const{document:Tm}=ye;function Nm(e){let t,n;return t=new xm({}),{c(){be(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function Mm(e){let t,n;return t=new am({}),{c(){be(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function $m(e){let t,n;return t=new nm({}),{c(){be(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}function Rm(e){let t,n,r,i;return n=new Vg({}),{c(){t=$("div"),be(n.$$.fragment),q(t,"height","auto"),q(t,"width","auto")},m(e,r){T(e,t,r),Ce(n,t,null),i=!0},i(e){i||(ge(n.$$.fragment,e),re((()=>{r||(r=ve(t,lt,{},!0)),r.run(1)})),i=!0)},o(e){me(n.$$.fragment,e),r||(r=ve(t,lt,{},!1)),r.run(0),i=!1},d(e){e&&N(t),xe(n),e&&r&&r.end()}}}function Pm(e){let t,n,r,i;return n=new Ap({}),{c(){t=$("div"),be(n.$$.fragment),q(t,"height","auto"),q(t,"width","auto")},m(e,r){T(e,t,r),Ce(n,t,null),i=!0},i(e){i||(ge(n.$$.fragment,e),re((()=>{r||(r=ve(t,lt,{},!0)),r.run(1)})),i=!0)},o(e){me(n.$$.fragment,e),r||(r=ve(t,lt,{},!1)),r.run(0),i=!1},d(e){e&&N(t),xe(n),e&&r&&r.end()}}}function Am(e){let t,n,r,i,o,s,a,l,u,h,d,f,p,g,m,_,v,y;const w=[Mm,Nm],b=[];function C(e,t){return"intro"==e[0]?0:"about"==e[0]?1:-1}~(t=C(e))&&(n=b[t]=w[t](e));let x="Google Chrome"!==e[2]&&"Microsoft Edge"!==e[2]&&function(e){let t,n;return t=new Em({}),{c(){be(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){me(t.$$.fragment,e),n=!1},d(e){xe(t,e)}}}();s=new Vp({});let k="nav"==e[0]&&$m();const S=[Pm,Rm],E=[];function M(e,t){return"gallery"==e[1]?0:"record"==e[1]?1:-1}return~(h=M(e))&&(d=E[h]=S[h](e)),{c(){n&&n.c(),r=P(),i=$("main"),x&&x.c(),o=P(),be(s.$$.fragment),a=P(),l=$("div"),k&&k.c(),u=P(),d&&d.c(),f=P(),p=$("html"),g=$("script"),O(l,"class","container svelte-n0zdxj"),Tm.title="How We Gaze",O(p,"lang","en"),c(g.src,m="./assets/webgazer.min.js")||O(g,"src","./assets/webgazer.min.js")},m(n,c){~t&&b[t].m(n,c),T(n,r,c),T(n,i,c),x&&x.m(i,null),I(i,o),Ce(s,i,null),I(i,a),I(i,l),k&&k.m(l,null),I(l,u),~h&&E[h].m(l,null),T(n,f,c),I(Tm.head,p),I(Tm.head,g),_=!0,v||(y=L(g,"load",e[4]),v=!0)},p(e,[i]){let o=t;t=C(e),t!==o&&(n&&(fe(),me(b[o],1,1,(()=>{b[o]=null})),pe()),~t?(n=b[t],n||(n=b[t]=w[t](e),n.c()),ge(n,1),n.m(r.parentNode,r)):n=null),"nav"==e[0]?k?1&i&&ge(k,1):(k=$m(),k.c(),ge(k,1),k.m(l,u)):k&&(fe(),me(k,1,1,(()=>{k=null})),pe());let s=h;h=M(e),h!==s&&(d&&(fe(),me(E[s],1,1,(()=>{E[s]=null})),pe()),~h?(d=E[h],d||(d=E[h]=S[h](e),d.c()),ge(d,1),d.m(l,null)):d=null)},i(e){_||(ge(n),ge(x),ge(s.$$.fragment,e),ge(k),ge(d),_=!0)},o(e){me(n),me(x),me(s.$$.fragment,e),me(k),me(d),_=!1},d(e){~t&&b[t].d(e),e&&N(r),e&&N(i),x&&x.d(),xe(s),k&&k.d(),~h&&E[h].d(),e&&N(f),N(p),N(g),v=!1,y()}}}function Lm(e,t,n){let r,i;function o(){let e=ot().windowW;Re.set(e),Pe.set(ot().windowH),e<800?Ae.set("mobile"):Ae.set("desktop")}d(e,Me,(e=>n(0,r=e))),d(e,Ne,(e=>n(1,i=e))),ut({duration:1500,easing:at}),Z((()=>{o()})),window.onresize=function(){o()};let s=!1;!async function(){n(3,s=await Of.getItem("visited"))}();var a=function(){var e=function(e){return e.test(window.navigator.userAgent)};switch(!0){case e(/edg/i):return"Microsoft Edge";case e(/trident/i):return"Microsoft Internet Explorer";case e(/firefox|fxios/i):return"Mozilla Firefox";case e(/opr\//i):return"Opera";case e(/ucbrowser/i):return"UC Browser";case e(/samsungbrowser/i):return"Samsung Browser";case e(/chrome|chromium|crios/i):return"Google Chrome";case e(/safari/i):return"Apple Safari";default:return"Other"}}();return e.$$.update=()=>{8&e.$$.dirty&&s&&v(Me,r=null,r),1&e.$$.dirty&&(document.querySelector("body").style.overflow=r?"hidden":"auto")},[r,i,a,s,()=>{Ke.set(!0)}]}const Om=new class extends Se{constructor(e){super(),Ie(this,e,Lm,Am,a,{})}}({target:document.body});return Om}();
//# sourceMappingURL=bundle.js.map
